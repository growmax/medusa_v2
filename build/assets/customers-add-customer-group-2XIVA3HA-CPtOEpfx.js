import{u as A,a as z,b as E}from"./chunk-APWN266K-BhXvr4m7.js";import{u as D,c as F}from"./chunk-YVTBRLIE-C161Iqr5.js";import{v as H,j as e,u as x,r as d,p as I,q,t as B,x as M}from"./index-7A3rjJyE.js";import{u as N,D as O}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{R as l,u as Q}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as K,H as L}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as V}from"./zod-DRKIF09R.js";import{o as $,a as Z,s as J}from"./index-yuYasa5Y.js";import{B as y}from"./label-DDCdtDlT.js";import{C as S}from"./checkbox-BD385cy_.js";import{c as U}from"./index-DL2eSRCZ.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-IQRVIEMV-JX6w9umB.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./chunk-RYVWLLZ2-BlkKIhzO.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./x-mark-mini-Di7jARRp.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";var W=$({customer_group_ids:Z(J()).min(1)}),p=10,X=({customerId:a})=>{const{t:c}=x(),{handleSuccess:g}=Q(),[r,i]=d.useState(!1),u=K({defaultValues:{customer_group_ids:[]},resolver:V(W)}),{setValue:n}=u,[o,C]=d.useState({});d.useEffect(()=>{n("customer_group_ids",Object.keys(o).filter(s=>o[s]),{shouldDirty:!0,shouldTouch:!0})},[o,n]);const{searchParams:j,raw:_}=A({pageSize:p}),b=z(),{customer_groups:v,count:h,isPending:P,isError:T,error:w}=D({fields:"*customers",...j}),R=s=>{const t=typeof s=="function"?s(o):s,m=Object.keys(t);n("customer_group_ids",m,{shouldDirty:!0,shouldTouch:!0}),C(t)},f=ee(),{table:G}=N({data:v??[],columns:f,count:h,enablePagination:!0,enableRowSelection:s=>{var t;return!((t=s.original.customers)!=null&&t.map(m=>m.id).includes(a))},getRowId:s=>s.id,pageSize:p,rowSelection:{state:o,updater:R}}),k=u.handleSubmit(async s=>{i(!0);try{const t=s.customer_group_ids.map(m=>I.customerGroups.addCustomers(m,{customer_ids:[a]}));await Promise.all(t),await q.invalidateQueries({queryKey:F.lists()}),g(`/customers/${a}`)}catch(t){B.error(t.message)}finally{i(!1)}});if(T)throw w;return e.jsx(l.Form,{form:u,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:k,children:[e.jsx(l.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[u.formState.errors.customer_group_ids&&e.jsx(L,{variant:"error",children:u.formState.errors.customer_group_ids.message}),e.jsx(l.Close,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"small",children:c("actions.cancel")})}),e.jsx(y,{type:"submit",variant:"primary",size:"small",isLoading:r,children:c("actions.save")})]})}),e.jsx(l.Body,{className:"size-full overflow-hidden",children:e.jsx(O,{table:G,columns:f,pageSize:p,count:h,filters:b,orderBy:["name","created_at","updated_at"],isLoading:P,layout:"fill",search:!0,queryObject:_,noRecords:{message:c("customers.groups.add.list.noRecordsMessage")}})})]})})},Y=U(),ee=()=>{const{t:a}=x(),c=E();return d.useMemo(()=>[Y.display({id:"select",header:({table:r})=>e.jsx(S,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:i=>r.toggleAllPageRowsSelected(!!i)}),cell:({row:r})=>{const i=!r.getCanSelect(),u=r.getIsSelected()||i,n=e.jsx(S,{checked:u,disabled:i,onCheckedChange:o=>r.toggleSelected(!!o),onClick:o=>{o.stopPropagation()}});return i?e.jsx(M,{content:a("customers.groups.alreadyAddedTooltip"),side:"right",children:n}):n}}),...c],[a,c])},Ee=()=>{const{id:a}=H();return e.jsx(l,{children:e.jsx(X,{customerId:a})})};export{Ee as Component};
