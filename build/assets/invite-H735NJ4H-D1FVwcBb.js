import{u as E}from"./chunk-GKWRHYJ2-DkmNb6N7.js";import{L as F}from"./chunk-6M6I2YQR-BGhNhkr8.js";import{i as P,d as M,r as y,j as e,u as h,H as v,T as j,e as H,t as V,f as z,I as d,L as b}from"./index-7A3rjJyE.js";import{u as B,F as r}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as U}from"./zod-DRKIF09R.js";import{o as N,s as m,Z as R,n as g}from"./index-yuYasa5Y.js";import{A as Z}from"./index-Cy4zQj6C.js";import{m as p}from"./motion-UqVoX3oU.js";import{T as D}from"./Trans-Cyi6soNY.js";import{A as J}from"./alert-Db7IDcs0.js";import{B as A}from"./label-DDCdtDlT.js";import"./x-mark-mini-Di7jARRp.js";for(var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=new Map,x=0;x<w.length;x++){var f=x.toString(2);f="0".repeat(6-f.length)+f,C.set(w.charCodeAt(x),f)}function K(n){try{if(typeof n!="string"||n.split(".").length!==3)return null;var o=function(s){for(var t,c="",i=s.length,a=0;a<i;a++)t=s[a],c+=String.fromCodePoint(t>251&&t<254&&a+5<i?1073741824*(t-252)+(s[++a]-128<<24)+(s[++a]-128<<18)+(s[++a]-128<<12)+(s[++a]-128<<6)+s[++a]-128:t>247&&t<252&&a+4<i?(t-248<<24)+(s[++a]-128<<18)+(s[++a]-128<<12)+(s[++a]-128<<6)+s[++a]-128:t>239&&t<248&&a+3<i?(t-240<<18)+(s[++a]-128<<12)+(s[++a]-128<<6)+s[++a]-128:t>223&&t<240&&a+2<i?(t-224<<12)+(s[++a]-128<<6)+s[++a]-128:t>191&&t<224&&a+1<i?(t-192<<6)+s[++a]-128:t);return c}(function(s){for(var t="",c=0;c<s.length;c++)t+=C.get(s.charCodeAt(c));t=t.slice(0,t.length-t.length%8);for(var i=[],a=0;a<t.length/8;a++)i.push(t.slice(8*a,8*a+8));return i}(n.split(".")[1].replaceAll("=","").replaceAll("-","+").replaceAll("_","/")).map(function(s){return parseInt(s,2)}));return JSON.parse(o)}catch(s){return console.error("There was an error decoding token: ",s),null}}var O=N({email:m().email(),first_name:m().min(1),last_name:m().min(1),password:m().min(1),repeat_password:m().min(1)}).superRefine(({password:n,repeat_password:o},s)=>{n!==o&&s.addIssue({code:R.custom,message:P.t("invite.passwordMismatch"),path:["repeat_password"]})}),me=()=>{const[n]=M(),[o,s]=y.useState(!1),t=n.get("token"),c=t?K(t):null,i=c&&X(c);return e.jsx("div",{className:"bg-ui-bg-base relative flex min-h-dvh w-dvw items-center justify-center p-4",children:e.jsxs("div",{className:"flex w-full max-w-[300px] flex-col items-center",children:[e.jsx(F,{className:"mb-4",checked:o,containerTransition:{duration:1.2,delay:.8,ease:[0,.71,.2,1.01]},pathTransition:{duration:1.3,delay:1.1,bounce:.6,ease:[.1,.8,.2,1.01]}}),e.jsx("div",{className:"max-h-[557px] w-full will-change-contents",children:i?e.jsx(Z,{children:o?e.jsx(p.div,{initial:{opacity:0,scale:.4},animate:{opacity:1,scale:1},transition:{duration:1,delay:.6,ease:[0,.71,.2,1.01]},className:"w-full",children:e.jsx(Q,{})},"success-view"):e.jsx(p.div,{initial:!1,animate:{height:"557px",y:0},exit:{height:0,y:40},transition:{duration:.8,delay:.6,ease:[0,.71,.2,1.01]},className:"w-full will-change-transform",children:e.jsx(p.div,{initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:.7},transition:{duration:.6,delay:0,ease:[0,.71,.2,1.01]},children:e.jsx(G,{onSuccess:()=>s(!0),token:t,invite:c})},"inner-create-account")},"create-account")}):e.jsx(q,{})})]})})},I=()=>{const{t:n}=h();return e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsx("div",{className:"my-6 h-px w-full border-b border-dotted"}),e.jsx("span",{className:"text-ui-fg-subtle txt-small",children:e.jsx(D,{t:n,i18nKey:"invite.alreadyHaveAccount",components:[e.jsx(b,{to:"/login",className:"text-ui-fg-interactive transition-fg hover:text-ui-fg-interactive-hover focus-visible:text-ui-fg-interactive-hover outline-none"},"login-link")]})})]})},q=()=>{const{t:n}=h();return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-y-1",children:[e.jsx(v,{children:n("invite.invalidTokenTitle")}),e.jsx(j,{size:"small",className:"text-ui-fg-subtle text-center",children:n("invite.invalidTokenHint")})]}),e.jsx(I,{})]})},G=({onSuccess:n,token:o})=>{const{t:s}=h(),[t,c]=y.useState(!1),i=B({resolver:U(O),defaultValues:{email:"",first_name:"",last_name:"",password:"",repeat_password:""}}),{mutateAsync:a,isPending:S}=H(),{mutateAsync:T,isPending:_}=E(o),k=i.handleSubmit(async l=>{try{const{token:u}=await a({email:l.email,password:l.password}),L={email:l.email,first_name:l.first_name,last_name:l.last_name};await T({...L,auth_token:u}),V.success(s("invite.toast.accepted")),n()}catch(u){if(z(u)&&u.status===400){i.setError("root",{type:"manual",message:s("invite.invalidInvite")}),c(!0);return}i.setError("root",{type:"manual",message:s("errors.serverError")})}});return e.jsxs("div",{className:"flex w-full flex-col items-center",children:[e.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[e.jsx(v,{children:s("invite.title")}),e.jsx(j,{size:"small",className:"text-ui-fg-subtle text-center",children:s("invite.hint")})]}),e.jsx(r,{...i,children:e.jsxs("form",{onSubmit:k,className:"flex w-full flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:i.control,name:"email",render:({field:l})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.email")}),e.jsx(r.Control,{children:e.jsx(d,{autoComplete:"off",...l})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:i.control,name:"first_name",render:({field:l})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.firstName")}),e.jsx(r.Control,{children:e.jsx(d,{autoComplete:"given-name",...l})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:i.control,name:"last_name",render:({field:l})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.lastName")}),e.jsx(r.Control,{children:e.jsx(d,{autoComplete:"family-name",...l})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:i.control,name:"password",render:({field:l})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.password")}),e.jsx(r.Control,{children:e.jsx(d,{autoComplete:"new-password",type:"password",...l})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:i.control,name:"repeat_password",render:({field:l})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.repeatPassword")}),e.jsx(r.Control,{children:e.jsx(d,{autoComplete:"off",type:"password",...l})}),e.jsx(r.ErrorMessage,{})]})}),i.formState.errors.root&&e.jsx(J,{variant:"error",dismissible:!1,className:"text-balance",children:i.formState.errors.root.message})]}),e.jsx(A,{className:"w-full",type:"submit",isLoading:S||_,disabled:t,children:s("invite.createAccount")})]})}),e.jsx(I,{})]})},Q=()=>{const{t:n}=h();return e.jsxs("div",{className:"flex w-full flex-col items-center gap-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-y-1",children:[e.jsx(v,{children:n("invite.successTitle")}),e.jsx(j,{size:"small",className:"text-ui-fg-subtle text-center",children:n("invite.successHint")})]}),e.jsx(A,{variant:"secondary",asChild:!0,className:"w-full",children:e.jsx(b,{to:"/login",replace:!0,children:n("invite.successAction")})})]})},W=N({id:m(),jti:m(),exp:g(),iat:g()}),X=n=>W.safeParse(n).success;export{me as Component};
