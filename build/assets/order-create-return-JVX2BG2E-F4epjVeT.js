import{a as Ve,b as $e,c as Be,d as Ue,e as Ge,f as Qe,g as Xe,h as Je,i as Ke,j as We,k as Ye,D as Ze}from"./chunk-K5B2ALQT-CSHvLWgD.js";import{M as et}from"./chunk-LHJ6JQGA-DwzzZUWf.js";import{a as D}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{u as tt}from"./chunk-MWKG2EGE-VcYUZG_Z.js";import{a as nt}from"./chunk-OIW3F4EQ-D8V0uZdG.js";import{r as p,v as st,$ as rt,b$ as it,j as e,u as J,t as at,H as re,T as G,n as te,I as ie,bG as ae,s as he,X as ot,Y as lt}from"./index-7A3rjJyE.js";import{P as dt,a as ct}from"./chunk-6XHB4MRO-DKQXmGFz.js";import{T as ut}from"./chunk-PHMALPVO-EKeNghx2.js";import{A as mt}from"./chunk-WRXTMI2J-CygmDunM.js";import{C as ne}from"./chunk-UY4EBCIZ-D3QWhMGG.js";import{c as ft}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{u as pt,D as ht}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import{u as xt}from"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{R as A,u as gt,b as _t,S as H}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as vt,b as bt,F as m}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as jt}from"./zod-DRKIF09R.js";import{z as w}from"./index-yuYasa5Y.js";import{P as yt}from"./pencil-square-mUSTT5rR.js";import{C as Nt}from"./currency-input-IPBZedwF.js";import{X as It}from"./x-circle-DWGyIDW-.js";import{B as U}from"./label-DDCdtDlT.js";import{A as Rt}from"./alert-Db7IDcs0.js";import{S as wt}from"./switch-DDIyRuzh.js";import{C as oe}from"./checkbox-BD385cy_.js";import{c as St}from"./index-DL2eSRCZ.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./x-mark-mini-Di7jARRp.js";import"./triangles-mini-JWkpofVU.js";import"./plus-mini-BHxdUq8n.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./prompt-KZNvJYzq.js";import"./index.esm-L0DzsZPB.js";import"./index-dBm6oMZZ.js";var Ct=Object.defineProperty,Q=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable,le=(t,r,s)=>r in t?Ct(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,qt=(t,r)=>{for(var s in r||(r={}))xe.call(r,s)&&le(t,s,r[s]);if(Q)for(var s of Q(r))ge.call(r,s)&&le(t,s,r[s]);return t},Pt=(t,r)=>{var s={};for(var n in t)xe.call(t,n)&&r.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&Q)for(var n of Q(t))r.indexOf(n)<0&&ge.call(t,n)&&(s[n]=t[n]);return s};const _e=p.forwardRef((t,r)=>{var s=t,{color:n="currentColor"}=s,d=Pt(s,["color"]);return p.createElement("svg",qt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},d),p.createElement("g",{clipPath:"url(#a)"},p.createElement("path",{fill:n,fillRule:"evenodd",d:"M2.833.75A2.53 2.53 0 0 0 .306 3.278V9.5a2.53 2.53 0 0 0 2.527 2.528h1.028v1.916a.75.75 0 0 0 1.219.586l3.128-2.502h3.959A2.53 2.53 0 0 0 14.695 9.5V3.278A2.53 2.53 0 0 0 12.167.75zM1.806 3.278c0-.568.46-1.028 1.027-1.028h9.334c.568 0 1.028.46 1.028 1.028V9.5c0 .567-.46 1.028-1.028 1.028H7.945a.75.75 0 0 0-.469.164l-2.115 1.692v-1.106a.75.75 0 0 0-.75-.75H2.833c-.567 0-1.027-.46-1.027-1.028zm4.805 3.11a.89.89 0 0 0 1.778 0 .89.89 0 0 0-1.778 0m-2.222.89a.89.89 0 0 1 0-1.778.89.89 0 0 1 0 1.778m5.333-.89a.89.89 0 0 0 1.778 0 .89.89 0 0 0-1.778 0",clipRule:"evenodd"})),p.createElement("defs",null,p.createElement("clipPath",{id:"a"},p.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});_e.displayName="ChatBubble";var Et=Object.defineProperty,X=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,de=(t,r,s)=>r in t?Et(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,kt=(t,r)=>{for(var s in r||(r={}))ve.call(r,s)&&de(t,s,r[s]);if(X)for(var s of X(r))be.call(r,s)&&de(t,s,r[s]);return t},At=(t,r)=>{var s={};for(var n in t)ve.call(t,n)&&r.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&X)for(var n of X(t))r.indexOf(n)<0&&be.call(t,n)&&(s[n]=t[n]);return s};const je=p.forwardRef((t,r)=>{var s=t,{color:n="currentColor"}=s,d=At(s,["color"]);return p.createElement("svg",kt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},d),p.createElement("path",{stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.611 5.5H6.39M4.611 8.167h5.778M4.611 10.833h5.778M1.944 12.167V2.833c0-.982.796-1.777 1.778-1.777h4.966c.235 0 .462.093.628.26l3.48 3.48c.166.166.26.392.26.628v6.743c0 .982-.796 1.778-1.778 1.778H3.722a1.777 1.777 0 0 1-1.778-1.778"}),p.createElement("path",{stroke:n,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12.976 5.056H9.944a.89.89 0 0 1-.888-.89v-3.02"}))});je.displayName="DocumentText";var Mt=w.object({items:w.array(w.object({item_id:w.string(),quantity:w.number(),reason_id:w.string().optional().nullable(),note:w.string().optional().nullable()})),location_id:w.string().optional(),option_id:w.string(),send_notification:w.boolean().optional(),receive_now:w.boolean().optional()});function ye(t){const{shipped_quantity:r,return_received_quantity:s,return_dismissed_quantity:n,return_requested_quantity:d}=t.detail;return r-(s+d)}var T=St(),Ot=t=>{const{t:r}=J();return p.useMemo(()=>[T.display({id:"select",header:({table:s})=>e.jsx(oe,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:n=>s.toggleAllPageRowsSelected(!!n)}),cell:({row:s})=>{const n=s.getCanSelect();return e.jsx(oe,{disabled:!n,checked:s.getIsSelected(),onCheckedChange:d=>s.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),T.display({id:"product",header:()=>e.jsx(dt,{}),cell:({row:s})=>e.jsx(ct,{product:s.original.variant.product})}),T.accessor("variant.sku",{header:r("fields.sku"),cell:({getValue:s})=>s()||"-"}),T.accessor("variant.title",{header:r("fields.variant")}),T.accessor("quantity",{header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:r("fields.quantity")})}),cell:({getValue:s,row:n})=>ye(n.original)}),T.accessor("refundable_total",{header:()=>e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:r("fields.price")})}),cell:({getValue:s})=>{const n=s()||0,d=D(n,t);return e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:d})})}})],[r,t])},Tt=()=>{const{t}=J();return[{key:"returnable_quantity",label:t("orders.returns.returnableQuantityLabel"),type:"number"},{key:"refundable_amount",label:t("orders.returns.refundableAmountLabel"),type:"number"},{key:"created_at",label:t("fields.createdAt"),type:"date"},{key:"updated_at",label:t("fields.updatedAt"),type:"date"}]},Ht=({pageSize:t=50,prefix:r})=>{const s=xt(["q","offset","order","created_at","updated_at","returnable_quantity","refundable_amount"],r),{offset:n,created_at:d,updated_at:f,refundable_amount:c,returnable_quantity:x,...v}=s;return{searchParams:{...v,limit:t,offset:n?Number(n):0,created_at:d?JSON.parse(d):void 0,updated_at:f?JSON.parse(f):void 0,refundable_amount:c?JSON.parse(c):void 0,returnable_quantity:x?JSON.parse(x):void 0},raw:s}},Y=50,ce="rit",Dt=({onSelectionChange:t,selectedItems:r,items:s,currencyCode:n})=>{const[d,f]=p.useState(r.reduce((u,b)=>(u[b]=!0,u),{})),c=u=>{const b=typeof u=="function"?u(d):u;f(b),t(Object.keys(b))},{searchParams:x,raw:v}=Ht({pageSize:Y,prefix:ce}),h=p.useMemo(()=>{const{order:u,offset:b,limit:q,q:N,created_at:L,updated_at:F,refundable_amount:z,returnable_quantity:V}=x;let j=s;if(N&&(j=j.filter(E=>{var M;return E.variant.product.title.toLowerCase().includes(N.toLowerCase())||E.variant.title.toLowerCase().includes(N.toLowerCase())||((M=E.variant.sku)==null?void 0:M.toLowerCase().includes(N.toLowerCase()))})),u){const E=u[0]==="-"?"desc":"asc",M=u.replace("-","");j=Lt(j,M,E)}return L&&(j=ue(j,L,"created_at")),F&&(j=ue(j,F,"updated_at")),V&&(j=fe(j,V,"returnable_quantity",n)),z&&(j=fe(j,z,"refundable_amount",n)),j.slice(b,b+q)},[s,n,x]),S=Ot(n),P=Tt(),{table:y}=pt({data:h,columns:S,count:h.length,enablePagination:!0,getRowId:u=>u.id,pageSize:Y,enableRowSelection:u=>ye(u.original)>0,rowSelection:{state:d,updater:c}});return e.jsx("div",{className:"flex size-full flex-col overflow-hidden",children:e.jsx(ht,{table:y,columns:S,pageSize:Y,count:h.length,filters:P,pagination:!0,layout:"fill",search:!0,orderBy:["product_title","variant_title","sku","returnable_quantity","refundable_amount"],prefix:ce,queryObject:v})})},Lt=(t,r,s)=>t.sort((n,d)=>{let f,c;return r==="product_title"?(f=n.variant.product.title,c=d.variant.product.title):r==="variant_title"?(f=n.variant.title,c=d.variant.title):r==="sku"?(f=n.variant.sku,c=d.variant.sku):r==="returnable_quantity"?(f=n.quantity-(n.returned_quantity||0),c=d.quantity-(d.returned_quantity||0)):r==="refundable_amount"&&(f=n.refundable||0,c=d.refundable||0),f<c?s==="asc"?-1:1:f>c?s==="asc"?1:-1:0}),ue=(t,r,s)=>{const{gt:n,gte:d,lt:f,lte:c}=r;return t.filter(x=>{const v=new Date(x[s]);let h=!0;return n&&(h=h&&v>new Date(n)),d&&(h=h&&v>=new Date(d)),f&&(h=h&&v<new Date(f)),c&&(h=h&&v<=new Date(c)),h})},me={eq:void 0,gt:void 0,gte:void 0,lt:void 0,lte:void 0},fe=(t,r,s,n)=>{const{eq:d,gt:f,lt:c,gte:x,lte:v}=typeof r=="object"?{...me,...r}:{...me,eq:r};return t.filter(h=>{const S=h.quantity-(h.returned_quantity||0),P=D(h.refundable||0,n),y=s==="returnable_quantity"?S:P;if(d)return y===d;let u=!0;return f&&(u=u&&y>f),x&&(u=u&&y>=x),c&&(u=u&&y<c),v&&(u=u&&y<=v),u})},Ft="return_reasons",zt=lt(Ft),Vt=(t,r)=>{const{data:s,...n}=ot({queryFn:()=>he.admin.returnReason.list(t),queryKey:zt.list(t),...r});return{...s,...n}};function $t({item:t,previewItem:r,currencyCode:s,form:n,onRemove:d,onUpdate:f,index:c}){const{t:x}=J(),{return_reasons:v=[]}=Vt({fields:"+label"}),h=n.watch(`items.${c}`),S=typeof h.reason_id=="string",P=typeof h.note=="string";return e.jsxs("div",{className:"bg-ui-bg-subtle shadow-elevation-card-rest my-2 rounded-xl ",children:[e.jsxs("div",{className:"flex flex-col items-center gap-x-2 gap-y-2 border-b p-3 text-sm md:flex-row",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-x-3",children:[e.jsx(ut,{src:t.thumbnail}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsxs(G,{className:"txt-small",as:"span",weight:"plus",children:[t.title," "]}),t.variant.sku&&e.jsxs("span",{children:["(",t.variant.sku,")"]})]}),e.jsx(G,{as:"div",className:"text-ui-fg-subtle txt-small",children:t.variant.product.title})]})]}),e.jsxs("div",{className:"flex flex-1 justify-between",children:[e.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[e.jsx(m.Field,{control:n.control,name:`items.${c}.quantity`,render:({field:y})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(ie,{className:"bg-ui-bg-base txt-small w-[67px] rounded-lg",min:1,max:t.quantity,type:"number",...y,onChange:u=>{const b=u.target.value,q=b===""?null:Number(b);y.onChange(q),q&&f({quantity:q})}})}),e.jsx(m.ErrorMessage,{})]})}),e.jsx(G,{className:"txt-small text-ui-fg-subtle",children:x("fields.qty")})]}),e.jsx("div",{className:"text-ui-fg-subtle txt-small mr-2 flex flex-shrink-0",children:e.jsx(et,{currencyCode:s,amount:r.return_requested_total})}),e.jsx(mt,{groups:[{actions:[!S&&{label:x("actions.addReason"),onClick:()=>n.setValue(`items.${c}.reason_id`,""),icon:e.jsx(_e,{})},!P&&{label:x("actions.addNote"),onClick:()=>n.setValue(`items.${c}.note`,""),icon:e.jsx(je,{})},{label:x("actions.remove"),onClick:d,icon:e.jsx(It,{})}].filter(Boolean)}]})]})]}),e.jsxs(e.Fragment,{children:[S&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:x("orders.returns.reason")}),e.jsx(m.Hint,{className:"!mt-1",children:x("orders.returns.reasonHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:n.control,name:`items.${c}.reason_id`,render:({field:{ref:y,value:u,onChange:b,...q}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(ne,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",value:u,onChange:N=>{f({reason_id:N}),b(N)},...q,options:v.map(N=>({label:N.label,value:N.id}))})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(te,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{f({reason_id:null}),n.setValue(`items.${c}.reason_id`,"")},children:e.jsx(ae,{className:"text-ui-fg-muted"})})]})]}),P&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:x("orders.returns.note")}),e.jsx(m.Hint,{className:"!mt-1",children:x("orders.returns.noteHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:n.control,name:`items.${c}.note`,render:({field:{ref:y,onChange:u,...b}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(ie,{onChange:u,...b,onBlur:()=>f({internal_note:b.value}),className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover"})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(te,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{n.setValue(`items.${c}.note`,{shouldDirty:!0,shouldTouch:!0}),f({internal_note:null})},children:e.jsx(ae,{className:"text-ui-fg-muted"})})]})]})]})]})}var pe=[],Z=!1,Bt=({order:t,preview:r,activeReturn:s})=>{const{t:n}=J(),{handleSuccess:d}=gt(),{setIsOpen:f}=_t(),[c,x]=p.useState(!1),[v,h]=p.useState(0),[S,P]=p.useState({}),{stock_locations:y=[]}=nt({limit:999}),{shipping_options:u=[]}=tt({limit:999,fields:"*prices,+service_zone.fulfillment_set.location.id"}),{mutateAsync:b,isPending:q}=Be(s.id,t.id),{mutateAsync:N,isPending:L}=Ue(s.id,t.id),{mutateAsync:F,isPending:z}=Ge(s.id,t.id),{mutateAsync:V,isPending:j}=Qe(s.id,t.id),{mutateAsync:E,isPending:M}=Xe(s.id,t.id),{mutateAsync:Ne,isPending:Ie}=Je(s.id,t.id),{mutateAsync:Re,isPending:we}=Ke(s.id,t.id),{mutateAsync:Se,isPending:Ce}=We(s.id,t.id),{mutateAsync:qe,isPending:Pe}=Ye(s.id,t.id),Ee=q||L||j||M||Ie||we||Ce||Pe||z,C=vt({defaultValues:()=>{const i=r.shipping_methods.find(o=>{var a;return!!((a=o.actions)!=null&&a.find(l=>l.action==="SHIPPING_ADD"))});return Promise.resolve({items:r.items.filter(o=>!!o.detail.return_requested_quantity).map(o=>{var a,l,g,_,R;return{item_id:o.id,quantity:o.detail.return_requested_quantity,note:(l=(a=o.actions)==null?void 0:a.find(k=>k.action==="RETURN_ITEM"))==null?void 0:l.internal_note,reason_id:(R=(_=(g=o.actions)==null?void 0:g.find(k=>k.action==="RETURN_ITEM"))==null?void 0:_.details)==null?void 0:R.reason_id}}),option_id:i?i.shipping_option_id:"",location_id:"",send_notification:!1})},resolver:jt(Mt)}),K=p.useMemo(()=>new Map(t.items.map(i=>[i.id,i])),[t.items]),ke=p.useMemo(()=>new Map(r.items.map(i=>[i.id,i])),[r.items]),{fields:I,append:Ae,remove:Me,update:Oe}=bt({name:"items",control:C.control});p.useEffect(()=>{const i={};r.items.forEach(o=>{var l,g;const a=I.findIndex(_=>_.item_id===o.id);if(o.detail.return_requested_quantity)if(i[o.id]=!0,a>-1){if(I[a].quantity!==o.detail.return_requested_quantity){const _=(l=o.actions)==null?void 0:l.find(R=>R.action==="RETURN_ITEM");Oe(a,{...I[a],quantity:o.detail.return_requested_quantity,note:_==null?void 0:_.internal_note,reason_id:(g=_==null?void 0:_.details)==null?void 0:g.reason_id})}}else Ae({item_id:o.id,quantity:o.detail.return_requested_quantity})}),I.forEach((o,a)=>{o.item_id in i||Me(a)})},[r.items]),p.useEffect(()=>{const i=r.shipping_methods.find(o=>{var a;return!!((a=o.actions)!=null&&a.find(l=>l.action==="SHIPPING_ADD"))});i&&C.setValue("option_id",i.shipping_option_id)},[r.shipping_methods]);const $=!I.length,O=C.watch("location_id"),Te=C.watch("option_id"),He=C.handleSubmit(async i=>{try{await b({no_notification:!i.send_notification}),d()}catch(o){at.error(n("general.error"),{description:o.message,dismissLabel:n("actions.close")})}}),De=()=>{Re({items:pe.map(i=>({id:i,quantity:1}))}),f("items",!1)},Le=async i=>{await F({location_id:i})},Fe=async i=>{const o=r.shipping_methods.map(a=>{var l,g;return(g=(l=a.actions)==null?void 0:l.find(_=>_.action==="SHIPPING_ADD"))==null?void 0:g.id}).filter(Boolean).map(Ne);await Promise.all(o),await V({shipping_option_id:i})};p.useEffect(()=>{c&&document.getElementById("js-shipping-input").focus()},[c]);const ze=p.useMemo(()=>O?!I.map(o=>{var l;const a=K.get(o.item_id);return!(a!=null&&a.variant_id)||!a.variant.manage_inventory?!0:(l=S[a.variant_id])==null?void 0:l.find(g=>g.location_id===O)}).every(Boolean):!1,[I,S,O]);p.useEffect(()=>{(async()=>{const o={};return I.length&&(await Promise.all(I.map(async a=>{const l=K.get(a.item_id);if(l.variant_id)return await he.admin.product.retrieveVariant(l.variant.product.id,l.variant_id,{fields:"*inventory,*inventory.location_levels"})}))).filter(a=>a==null?void 0:a.variant).forEach(a=>{var _;const{variant:l}=a,g=(_=l.inventory[0])==null?void 0:_.location_levels;g&&(o[l.id]=g)}),o})().then(o=>{P(o)})},[I]),p.useEffect(()=>()=>{Z&&(N(),Z=!1)},[]);const B=r.return_requested_total,se=p.useMemo(()=>{const i=r.shipping_methods.find(o=>{var a;return!!((a=o.actions)!=null&&a.find(l=>l.action==="SHIPPING_ADD"))});return(i==null?void 0:i.total)||0},[r.shipping_methods]),W=B-se;return e.jsx(A.Form,{form:C,children:e.jsxs("form",{onSubmit:He,className:"flex h-full flex-col",children:[e.jsx(A.Header,{}),e.jsx(A.Body,{className:"flex size-full justify-center overflow-y-auto",children:e.jsxs("div",{className:"mt-16 w-[720px] max-w-[100%] px-4 md:p-0",children:[e.jsx(re,{level:"h1",children:n("orders.returns.create")}),e.jsxs("div",{className:"mt-8 flex items-center justify-between",children:[e.jsx(re,{level:"h2",children:n("orders.returns.inbound")}),e.jsxs(H,{id:"items",children:[e.jsx(H.Trigger,{asChild:!0,children:e.jsx("a",{className:"focus-visible:shadow-borders-focus transition-fg txt-compact-small-plus cursor-pointer text-blue-500 outline-none hover:text-blue-400",children:n("actions.addItems")})}),e.jsxs(H.Content,{children:[e.jsx(H.Header,{}),e.jsx(Dt,{items:t.items,selectedItems:I.map(i=>i.item_id),currencyCode:t.currency_code,onSelectionChange:i=>pe=i}),e.jsx(H.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(A.Close,{asChild:!0,children:e.jsx(U,{type:"button",variant:"secondary",size:"small",children:n("actions.cancel")})}),e.jsx(U,{type:"submit",variant:"primary",size:"small",role:"button",onClick:()=>De(),children:n("actions.save")},"submit-button")]})})})]})]})]}),$&&e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"bg-ui-bg-field mt-4 block h-[56px] w-full rounded-lg border border-dashed"}),I.map((i,o)=>e.jsx($t,{item:K.get(i.item_id),previewItem:ke.get(i.item_id),currencyCode:t.currency_code,form:C,onRemove:()=>{var l,g,_;const a=(_=(g=(l=r.items.find(R=>R.id===i.item_id))==null?void 0:l.actions)==null?void 0:g.find(R=>R.action==="RETURN_ITEM"))==null?void 0:_.id;a&&Se(a)},onUpdate:a=>{var g,_,R;const l=(R=(_=(g=r.items.find(k=>k.id===i.item_id))==null?void 0:g.actions)==null?void 0:_.find(k=>k.action==="RETURN_ITEM"))==null?void 0:R.id;l&&qe({...a,actionId:l})},index:o},i.id)),!$&&e.jsxs("div",{className:"mt-8 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:n("orders.returns.location")}),e.jsx(m.Hint,{className:"!mt-1",children:n("orders.returns.locationHint")})]}),e.jsx(m.Field,{control:C.control,name:"location_id",render:({field:{value:i,onChange:o,...a}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(ne,{value:i,onChange:l=>{o(l),Le(l)},...a,options:(y??[]).map(l=>({label:l.name,value:l.id}))})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:n("orders.returns.inboundShipping")}),e.jsx(m.Hint,{className:"!mt-1",children:n("orders.returns.inboundShippingHint")})]}),e.jsx(m.Field,{control:C.control,name:"option_id",render:({field:{value:i,onChange:o,...a}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(ne,{value:i,onChange:l=>{o(l),Fe(l)},...a,options:(u??[]).filter(l=>(O?l.service_zone.fulfillment_set.location.id===O:!0)&&!!l.rules.find(g=>g.attribute==="is_return"&&g.value==="true")).map(l=>({label:l.name,value:l.id})),disabled:!O})})})})]})]}),ze&&e.jsxs(Rt,{variant:"warning",dismissible:!0,className:"mt-4 p-5",children:[e.jsx("div",{className:"text-ui-fg-subtle txt-small pb-2 font-medium leading-[20px]",children:n("orders.returns.noInventoryLevel")}),e.jsx(G,{className:"text-ui-fg-subtle txt-small leading-normal",children:n("orders.returns.noInventoryLevelDesc")})]}),e.jsxs("div",{className:"mt-8 border-y border-dotted py-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:n("orders.returns.returnTotal")}),e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:D(B&&-1*B,t.currency_code)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:n("orders.returns.inboundShipping")}),e.jsxs("span",{className:"txt-small text-ui-fg-subtle flex items-center",children:[!c&&e.jsx(te,{onClick:()=>x(!0),variant:"transparent",className:"text-ui-fg-muted",disabled:$||!Te,children:e.jsx(yt,{})}),c?e.jsx(Nt,{id:"js-shipping-input",onBlur:()=>{let i;r.shipping_methods.forEach(o=>{if(o.actions)for(let a of o.actions)a.action==="SHIPPING_ADD"&&(i=a.id)}),i&&E({actionId:i,custom_price:typeof v=="string"?null:v}),x(!1)},symbol:ft[t.currency_code.toUpperCase()].symbol_native,code:t.currency_code,onValueChange:i=>h(i?parseInt(i):""),value:v,disabled:$}):D(se,t.currency_code)]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-dotted pt-4",children:[e.jsx("span",{className:"txt-small font-medium",children:n("orders.returns.refundAmount")}),e.jsx("span",{className:"txt-small font-medium",children:D(W&&-1*W,t.currency_code)})]})]}),e.jsx("div",{className:"bg-ui-bg-field mt-8 rounded-lg border py-2 pl-2 pr-4",children:e.jsx(m.Field,{control:C.control,name:"send_notification",render:({field:{onChange:i,value:o,...a}})=>e.jsxs(m.Item,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.Control,{className:"mr-4 self-start",children:e.jsx(wt,{className:"mt-[2px]",checked:!!o,onCheckedChange:i,...a})}),e.jsxs("div",{className:"block",children:[e.jsx(m.Label,{children:n("orders.returns.sendNotification")}),e.jsx(m.Hint,{className:"!mt-1",children:n("orders.returns.sendNotificationHint")})]})]}),e.jsx(m.ErrorMessage,{})]})})})]})}),e.jsx(A.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(A.Close,{asChild:!0,children:e.jsx(U,{type:"button",onClick:()=>Z=!0,variant:"secondary",size:"small",children:n("actions.cancel")})}),e.jsx(U,{type:"submit",variant:"primary",size:"small",isLoading:Ee,children:n("actions.save")},"submit-button")]})})})]})})},ee=!1,Hn=()=>{const{id:t}=st(),{order:r}=rt(t,{fields:Ze}),{order:s}=it(t),[n,d]=p.useState(),{mutateAsync:f}=Ve(r.id),{return:c}=$e(n,void 0,{enabled:!!n});return p.useEffect(()=>{async function x(){var h;if(ee||!r||!s)return;if(((h=s.order_change)==null?void 0:h.change_type)==="return"){d(s.order_change.return.id);return}ee=!0;const v=await f({order_id:r.id});d(v.id),ee=!1}x()},[r,s]),e.jsx(A,{children:c&&s&&r&&e.jsx(Bt,{order:r,activeReturn:c,preview:s})})};export{Hn as Component};
