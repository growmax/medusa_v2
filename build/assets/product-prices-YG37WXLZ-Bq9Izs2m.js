import{u as V}from"./chunk-ZAKH3ZQB-BBhcY7sJ.js";import{g as $}from"./chunk-XVFLU5BP-pJYp3bDo.js";import{D as z}from"./chunk-ZUTZJQ3C-BDh6pyCy.js";import{c as B}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{v as E,j as e,u as T,r as D,m as R,o as W}from"./index-7A3rjJyE.js";import{u as F}from"./chunk-QHCOJC4V-B0yC0oe2.js";import{d as H,i as G}from"./chunk-YBHG7T6S-BleHOTgO.js";import{R as x,u as U}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as k,a as q}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as A}from"./zod-DRKIF09R.js";import{o as C,a as J,r as K,s as S,n as Q}from"./index-yuYasa5Y.js";import{B as L}from"./label-DDCdtDlT.js";import{c as X}from"./index-DL2eSRCZ.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-L0DzsZPB.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./chunk-DMYZ6SLX-BMyt3Z-P.js";import"./prompt-KZNvJYzq.js";var Y=({children:s})=>e.jsx("div",{role:"cell","data-cell-type":"readonly",className:"bg-ui-bg-base size-full cursor-not-allowed px-4 py-2.5",children:s}),Z=({form:s})=>{var h,v;const{store:r,isLoading:n}=R(),{currencies:o,isLoading:c}=V({code:(h=r==null?void 0:r.supported_currencies)==null?void 0:h.map(t=>t.currency_code),limit:(v=r==null?void 0:r.supported_currencies)==null?void 0:v.length},{enabled:!!r}),{regions:i}=F({limit:9999}),{price_preferences:a}=W({}),m=O({currencies:o,regions:i,pricePreferences:a}),j=q({control:s.control,name:"variants"});return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(z,{columns:m,data:j,isLoading:n||c,state:s})})},I=X(),O=({currencies:s=[],regions:r=[],pricePreferences:n=[]})=>{const{t:o}=T();return D.useMemo(()=>[I.display({id:o("fields.title"),header:o("fields.title"),cell:({row:i})=>{const a=i.original;return e.jsx(Y,{children:e.jsx("div",{className:"flex h-full w-full items-center gap-x-2 overflow-hidden",children:e.jsx("span",{title:a.title,className:"truncate",children:a.title})})})}}),...$({currencies:s.map(i=>i.code),regions:r,pricePreferences:n,getFieldName:(i,a)=>i.column.id.startsWith("currency_prices")?`variants.${i.row.index}.prices.${a}`:`variants.${i.row.index}.prices.${a}`,t:o})],[o,s,r,n])},ee=C({variants:J(C({prices:K(S(),S().or(Q()).optional()).optional()}))}),re=({product:s,variantId:r})=>{const{t:n}=T(),{handleSuccess:o}=U(),{regions:c}=F({limit:9999}),i=D.useMemo(()=>c!=null&&c.length?c.reduce((t,l)=>(t[l.id]=l.currency_code,t),{}):{},[c]),a=r?s.variants.filter(t=>t.id===r):s.variants,m=k({defaultValues:{variants:a.map(t=>({title:t.title,prices:t.prices.reduce((l,d)=>{var u;return(u=d.rules)!=null&&u.region_id?l[d.rules.region_id]=d.amount:l[d.currency_code]=d.amount,l},{})}))},resolver:A(ee,{})}),{mutateAsync:j,isPending:h}=G(s.id),v=m.handleSubmit(async t=>{const l=t.variants.map((d,u)=>({id:a[u].id,prices:Object.entries(d.prices||{}).map(([g,M])=>{var w,N;const p=g.startsWith("reg_")?g:void 0,_=g.startsWith("reg_")?i[p]:g;let f;p?f=(w=a[u].prices.find(y=>y.rules.region_id===p))==null?void 0:w.id:f=(N=a[u].prices.find(y=>y.currency_code===_&&Object.keys(y.rules??{}).length===0))==null?void 0:N.id;const P=B(M),b=f?{id:f,amount:P}:{currency_code:_,amount:P};return p&&!f&&(b.rules={region_id:p}),b})}));await j(l,{onSuccess:()=>{o("..")}})},t=>{console.log(t)});return e.jsx(x.Form,{form:m,children:e.jsxs("form",{onSubmit:v,className:"flex h-full flex-col",children:[e.jsx(x.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-2",children:e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(L,{variant:"secondary",size:"small",children:n("actions.cancel")})}),e.jsx(L,{type:"submit",variant:"primary",size:"small",isLoading:h,children:n("actions.save")})]})})}),e.jsx(x.Body,{children:e.jsx(Z,{form:m})})]})})},je=()=>{const{id:s,variant_id:r}=E(),{product:n,isLoading:o,isError:c,error:i}=H(s);if(c)throw i;return e.jsx(x,{children:!o&&n&&e.jsx(re,{product:n,variantId:r})})};export{je as Component};
