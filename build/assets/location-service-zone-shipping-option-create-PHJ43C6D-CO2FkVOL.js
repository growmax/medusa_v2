import{u as $}from"./chunk-7PJFIXDJ-B06yxNSH.js";import{S as q}from"./chunk-OUAFSZKF-BpzSoAuD.js";import{f as B}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{b as H}from"./chunk-MWKG2EGE-VcYUZG_Z.js";import{u as A}from"./chunk-OIW3F4EQ-D8V0uZdG.js";import{S as G}from"./chunk-ARXK2O3B-CKHwWM2L.js";import{u as T}from"./chunk-KKUJQ3HN-BWZVkDDd.js";import{C as F}from"./chunk-UY4EBCIZ-D3QWhMGG.js";import{D as K}from"./chunk-ZUTZJQ3C-BDh6pyCy.js";import"./index.esm-L0DzsZPB.js";import{u as J,F as r}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{v as Z,d as Q,J as U,j as e,r as O,u as D,t as k,s as z,H as W,T as X,I as Y,D as ee,m as se,o as ie}from"./index-7A3rjJyE.js";import{c as I}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{u as re}from"./chunk-QHCOJC4V-B0yC0oe2.js";import{R as C,u as oe}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{t as ne}from"./zod-DRKIF09R.js";import{z as p}from"./index-yuYasa5Y.js";import{P as b}from"./progress-tabs-CBvjkL6b.js";import{B as L}from"./label-DDCdtDlT.js";import{R as N}from"./radio-group-C5P_IsHK.js";import"./chunk-XVFLU5BP-pJYp3bDo.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./switch-DDIyRuzh.js";import"./index-dBm6oMZZ.js";import"./x-mark-mini-Di7jARRp.js";import"./triangles-mini-JWkpofVU.js";import"./plus-mini-BHxdUq8n.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./index-DL2eSRCZ.js";import"./prompt-KZNvJYzq.js";var te=({form:t,isReturn:l=!1,zone:f})=>{const{t:i}=D(),m=T({queryFn:s=>z.admin.shippingProfile.list(s),queryKey:["shipping_profiles"],getOptions:s=>s.shipping_profiles.map(n=>({label:n.name,value:n.id}))}),a=T({queryFn:s=>z.admin.fulfillmentProvider.list(s),queryKey:["fulfillment_providers"],getOptions:s=>s.fulfillment_providers.map(n=>({label:B(n.id),value:n.id}))});return e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(W,{children:i(`stockLocations.shippingOptions.create.${l?"returns":"shipping"}.header`,{zone:f.name})}),e.jsx(X,{size:"small",className:"text-ui-fg-subtle",children:i(`stockLocations.shippingOptions.create.${l?"returns":"shipping"}.hint`)})]}),e.jsx(r.Field,{control:t.control,name:"price_type",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(r.Control,{children:e.jsxs(N,{className:"grid grid-cols-1 gap-4 md:grid-cols-2",...s,onValueChange:s.onChange,children:[e.jsx(N.ChoiceBox,{className:"flex-1",value:"flat",label:i("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:i("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(N.ChoiceBox,{className:"flex-1",value:"calculated",label:i("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:i("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(r.Field,{control:t.control,name:"name",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i("fields.name")}),e.jsx(r.Control,{children:e.jsx(Y,{...s})}),e.jsx(r.ErrorMessage,{})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:t.control,name:"shipping_profile_id",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i("stockLocations.shippingOptions.fields.profile")}),e.jsx(r.Control,{children:e.jsx(F,{...s,options:m.options,searchValue:m.searchValue,onSearchValueChange:m.onSearchValueChange,disabled:m.disabled})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:t.control,name:"provider_id",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:i("stockLocations.shippingOptions.fields.provider")}),e.jsx(r.Control,{children:e.jsx(F,{...s,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,disabled:a.disabled})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(ee,{}),e.jsx(G,{control:t.control,name:"enabled_in_store",label:i("stockLocations.shippingOptions.fields.enableInStore.label"),description:i("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})},ae=({form:t})=>{const{store:l,isLoading:f,isError:i,error:m}=se(),a=O.useMemo(()=>{var x;return((x=l==null?void 0:l.supported_currencies)==null?void 0:x.map(h=>h.currency_code))||[]},[l]),{regions:s,isLoading:n,isError:v,error:o}=re({fields:"id,name,currency_code",limit:999}),{price_preferences:j}=ie({}),_=$({currencies:a,regions:s,pricePreferences:j}),g=O.useMemo(()=>[[...a||[],...s||[]]],[a,s]);if(i)throw m;if(v)throw o;return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(K,{data:g,columns:_,state:t})})},V=p.object({name:p.string().min(1),price_type:p.nativeEnum(q),enabled_in_store:p.boolean(),shipping_profile_id:p.string().min(1),provider_id:p.string().min(1)}),le=p.object({region_prices:p.record(p.string(),p.string().optional()),currency_prices:p.record(p.string(),p.string().optional())}).merge(V);function ce({zone:t,isReturn:l,locationId:f}){var P,E;const[i,m]=O.useState("details"),[a,s]=O.useState(!1),{t:n}=D(),{handleSuccess:v}=oe(),o=J({defaultValues:{name:"",price_type:"flat",enabled_in_store:!0,shipping_profile_id:"",provider_id:"",region_prices:{},currency_prices:{}},resolver:ne(le)}),j=o.watch("price_type")==="calculated",{mutateAsync:_,isPending:g}=H(),x=o.handleSubmit(async d=>{const w=Object.entries(d.currency_prices).map(([c,u])=>{const S=u?I(u):void 0;return{currency_code:c,amount:S}}).filter(c=>!!c.amount),y=Object.entries(d.region_prices).map(([c,u])=>{const S=u?I(u):void 0;return{region_id:c,amount:S}}).filter(c=>!!c.amount);await _({name:d.name,price_type:d.price_type,service_zone_id:t.id,shipping_profile_id:d.shipping_profile_id,provider_id:d.provider_id,prices:[...w,...y],rules:[{value:l?'"true"':'"false"',attribute:"is_return",operator:"eq"},{value:d.enabled_in_store?'"true"':'"false"',attribute:"enabled_in_store",operator:"eq"}],type:{label:"Type label",description:"Type description",code:"type-code"}},{onSuccess:({shipping_option:c})=>{k.success(n(`stockLocations.shippingOptions.create.${l?"returns":"shipping"}.successToast`,{name:c.name})),v(`/settings/locations/${f}`)},onError:c=>{k.error(c.message)}})}),h=d=>{if(d==="pricing"){o.clearErrors();const w=V.safeParse({...o.getValues()});if(!w.success){const[y,...c]=w.error.errors;for(const u of c){const S=u.path.join(".");o.setError(S,{message:u.message,type:u.code})}o.setError(y.path.join("."),{message:y.message,type:y.code},{shouldFocus:!0}),s(!1);return}s(!0)}m(d)},R=(P=o.getFieldState("currency_prices"))!=null&&P.isDirty||(E=o.getFieldState("region_prices"))!=null&&E.isDirty||i==="pricing"?"in-progress":"not-started",M=a?"completed":"in-progress";return e.jsx(C.Form,{form:o,children:e.jsx(b,{value:i,className:"flex h-full flex-col overflow-hidden",onValueChange:d=>h(d),children:e.jsxs("form",{className:"flex h-full flex-col",onSubmit:x,children:[e.jsxs(C.Header,{children:[e.jsxs(b.List,{className:"border-ui-border-base -my-2 ml-2 min-w-0 flex-1 border-l",children:[e.jsx(b.Trigger,{value:"details",status:M,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full cursor-auto overflow-hidden text-ellipsis whitespace-nowrap",children:n("stockLocations.shippingOptions.create.tabs.details")})}),!j&&e.jsx(b.Trigger,{value:"pricing",status:R,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:n("stockLocations.shippingOptions.create.tabs.prices")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(C.Close,{asChild:!0,children:e.jsx(L,{variant:"secondary",size:"small",children:n("actions.cancel")})}),i==="pricing"||j?e.jsx(L,{size:"small",className:"whitespace-nowrap",isLoading:g,type:"submit",children:n("actions.save")},"submit-btn"):e.jsx(L,{size:"small",className:"whitespace-nowrap",isLoading:g,onClick:()=>h("pricing"),type:"button",children:n("actions.continue")},"continue-btn")]})]}),e.jsxs(C.Body,{className:"size-full overflow-hidden",children:[e.jsx(b.Content,{value:"details",className:"size-full overflow-y-auto",children:e.jsx(te,{form:o,zone:t,isReturn:l})}),e.jsx(b.Content,{value:"pricing",className:"size-full",children:e.jsx(ae,{form:o})})]})]})})})}var pe="*fulfillment_sets,*fulfillment_sets.service_zones,*fulfillment_sets.service_zones.shipping_options";function qe(){var _,g,x;const{location_id:t,fset_id:l,zone_id:f}=Z(),[i]=Q(),m=i.has("is_return"),{stock_location:a,isPending:s,isError:n,error:v}=A(t,{fields:pe}),o=(x=(g=(_=a==null?void 0:a.fulfillment_sets)==null?void 0:_.find(h=>h.id===l))==null?void 0:g.service_zones)==null?void 0:x.find(h=>h.id===f);if(!s&&!o)throw U({message:`Service zone with ID ${f} was not found`},404);if(n)throw v;const j=!s&&!!o;return e.jsx(C,{prev:`/settings/locations/${t}`,children:j&&e.jsx(ce,{zone:o,isReturn:m,locationId:t})})}export{qe as Component};
