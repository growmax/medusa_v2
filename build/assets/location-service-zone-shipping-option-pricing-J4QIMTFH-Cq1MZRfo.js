import{u as z}from"./chunk-7PJFIXDJ-B06yxNSH.js";import{u as B,c as I}from"./chunk-MWKG2EGE-VcYUZG_Z.js";import{v as $,J as D,j as i,u as k,m as A,r as S,o as G,t as v}from"./index-7A3rjJyE.js";import{D as H}from"./chunk-ZUTZJQ3C-BDh6pyCy.js";import"./index.esm-L0DzsZPB.js";import{u as J}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{c as P}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{u as U}from"./chunk-QHCOJC4V-B0yC0oe2.js";import{R as u,u as V}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{t as Z}from"./zod-DRKIF09R.js";import{o as q,r as E,s as d,n as R}from"./index-yuYasa5Y.js";import{B as b}from"./label-DDCdtDlT.js";import"./chunk-XVFLU5BP-pJYp3bDo.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-OIW3F4EQ-D8V0uZdG.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./index-DL2eSRCZ.js";import"./prompt-KZNvJYzq.js";var K=e=>{const s={};return e.forEach(r=>{r.price_rules.length||(s[r.currency_code]=r.amount)}),s},Q=e=>{const s={};return e.forEach(r=>{if(r.price_rules.length){const n=r.price_rules[0].value;s[n]=r.amount}}),s},W=q({region_prices:E(d(),d().or(R()).optional()),currency_prices:E(d(),d().or(R()).optional())});function X({shippingOption:e}){const{t:s}=k(),{handleSuccess:r}=V(),n=J({defaultValues:{region_prices:Q(e.prices),currency_prices:K(e.prices)},resolver:Z(W)}),{mutateAsync:t,isPending:m}=I(e.id),{store:p,isLoading:Y,isError:w,error:C}=A(),l=S.useMemo(()=>{var a;return((a=p==null?void 0:p.supported_currencies)==null?void 0:a.map(g=>g.currency_code))||[]},[p]),{regions:f,isLoading:rr,isError:L,error:O}=U({fields:"id,name,currency_code",limit:999}),{price_preferences:N}=G({}),T=z({currencies:l,regions:f,pricePreferences:N}),F=S.useMemo(()=>[[...l||[],...f||[]]],[l,f]),y=n.handleSubmit(async a=>{const g=Object.entries(a.currency_prices).map(([o,c])=>{if(c===""||c===void 0)return;const h=P(c),x={currency_code:o,amount:h},j=e.prices.find(_=>_.currency_code===o&&!_.price_rules.length);return j&&(x.id=j.id),x}).filter(o=>!!o),M=Object.entries(a.region_prices).map(([o,c])=>{if(c===""||c===void 0)return;const h=P(c);return{region_id:o,amount:h}}).filter(o=>!!o);await t({prices:[...g,...M]},{onSuccess:()=>{v.success(s("general.success")),r()},onError:o=>{v.error(o.message)}})});if(w)throw C;if(L)throw O;return i.jsx(u.Form,{form:n,children:i.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:y,children:[i.jsx(u.Header,{children:i.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[i.jsx(u.Close,{asChild:!0,children:i.jsx(b,{variant:"secondary",size:"small",children:s("actions.cancel")})}),i.jsx(b,{size:"small",className:"whitespace-nowrap",isLoading:m,onClick:y,type:"button",children:s("actions.save")})]})}),i.jsx(u.Body,{children:i.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:i.jsx(H,{data:F,columns:T,state:n})})})]})})}function jr(){const{so_id:e,location_id:s}=$(),{shipping_options:r,isPending:n}=B({id:[e],fields:"*prices,*prices.price_rules"}),t=r==null?void 0:r.find(m=>m.id===e);if(!n&&!t)throw D(`Shipping option with id: ${e} not found`,{status:404});return i.jsx(u,{prev:`/settings/locations/${s}`,children:t&&i.jsx(X,{shippingOption:t})})}export{jr as Component};
