import{g as S}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{V as b}from"./chunk-EUTK2A3J-CZpwcbuN.js";import{S as v}from"./chunk-ULQT3HE4-DTXseesA.js";import{J as y}from"./chunk-3IW4HYUP-C89ww9p0.js";import{A as p}from"./chunk-WRXTMI2J-CygmDunM.js";import{u as C,D as P}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import{q as g,h as D,v as I,j as e,O as T,s as V,u as m,b as k,C as f,H as h,B as z,y as w,r as _,K as A}from"./index-7A3rjJyE.js";import"./lodash-8s6kkRaG.js";import{N as E}from"./chunk-WX2SMNCD-D4nWbVrW.js";import{P as x}from"./chunk-P3UUX2T6-Bigsa15J.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{m as K,v as L,h as B}from"./chunk-YBHG7T6S-BleHOTgO.js";import{C as q}from"./component-COQxFSkg.js";import{P as M}from"./pencil-square-mUSTT5rR.js";import{T as Q}from"./trash-C_lucST6.js";import{u as R}from"./use-prompt-iL3FbEo4.js";import{B as H}from"./label-DDCdtDlT.js";import{c as $}from"./index-DL2eSRCZ.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./arrow-up-right-on-box-CF7GLQ-o.js";import"./Trans-Cyi6soNY.js";import"./x-mark-mini-Di7jARRp.js";import"./triangle-down-mini-BHNqpDM0.js";import"./square-two-stack-Ao9P_yLE.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./plus-mini-BHxdUq8n.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./chunk-DMYZ6SLX-BMyt3Z-P.js";import"./prompt-KZNvJYzq.js";var O=(s,t)=>({queryKey:L.detail(t),queryFn:async()=>V.admin.product.retrieveVariant(s,t,{fields:b})}),ze=async({params:s})=>{const t=s.id,a=s.variant_id,i=O(t,a);return g.getQueryData(i.queryKey)??await g.fetchQuery(i)};function F({variant:s}){var c;const{t}=m(),a=R(),i=k(),r=((c=s.inventory)==null?void 0:c.length)>1,{mutateAsync:l}=B(s.product_id,s.id),o=async()=>{await a({title:t("general.areYouSure"),description:t("products.variant.deleteWarning",{title:s.title}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await l(void 0,{onSuccess:()=>{i("..",{replace:!0})}})};return e.jsxs(f,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{children:s.title}),r&&e.jsx("span",{className:"text-ui-fg-muted font-normal",children:e.jsx(q,{})})]}),e.jsx("span",{className:"text-ui-fg-subtle txt-small mt-2",children:t("labels.productVariant")})]}),e.jsx("div",{className:"flex items-center gap-x-4",children:e.jsx(p,{groups:[{actions:[{label:t("actions.edit"),to:"edit",icon:e.jsx(M,{})}]},{actions:[{label:t("actions.delete"),onClick:o,icon:e.jsx(Q,{})}]}]})})]}),e.jsx(v,{title:t("fields.sku"),value:s.sku}),s.options.map(n=>{var u;return e.jsx(v,{title:(u=n.option)==null?void 0:u.title,value:e.jsx(z,{size:"2xsmall",children:n.value})},n.id)})]})}var G=({item:s})=>{const{t}=m();return e.jsx(p,{groups:[{actions:[{icon:e.jsx(w,{}),label:t("products.variant.inventory.navigateToItem"),to:`/inventory/${s.id}`}]}]})},d=$(),J=()=>{const{t:s}=m();return _.useMemo(()=>[d.accessor("title",{header:s("fields.title"),cell:({getValue:t})=>{const a=t();return a?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})}):e.jsx(x,{})}}),d.accessor("sku",{header:s("fields.sku"),cell:({getValue:t})=>{const a=t();return a?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})}):e.jsx(x,{})}}),d.accessor("required_quantity",{header:s("fields.requiredQuantity"),cell:({getValue:t})=>{const a=t();return Number.isNaN(a)?e.jsx(x,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})})}}),d.display({id:"inventory_quantity",header:s("fields.inventory"),cell:({getValue:t,row:{original:a}})=>{var l;if(!((l=a.location_levels)!=null&&l.length))return e.jsx(x,{});let i=0,r=0;return a.location_levels.forEach(o=>{i+=o.available_quantity,r+=1}),e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:s("products.variant.tableItem",{availableCount:i,locationCount:r,count:r})})})}}),d.display({id:"actions",cell:({row:t})=>e.jsx(G,{item:t.original})})],[s])},N=20;function U({inventoryItems:s,manageInventory:t}){const{t:a}=m(),i=J(),{table:r}=C({data:s??[],columns:i,count:s.length,enablePagination:!0,getRowId:o=>o.id,pageSize:N}),l=s.length>1;return e.jsxs(f,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(h,{level:"h2",children:a("fields.inventoryItems")})}),e.jsx("div",{className:"flex items-center gap-x-4",children:t&&e.jsx(p,{groups:[{actions:[{label:a(l?"products.variant.inventory.manageKit":"products.variant.inventory.manageItems"),to:"manage-items",icon:l?e.jsx(q,{}):e.jsx(w,{})}]}]})})]}),e.jsx(P,{table:r,columns:i,pageSize:N,count:s.length,navigateTo:o=>`/inventory/${o.id}`})]})}function W({variant:s}){const{t}=m(),a=s.prices.filter(n=>!Object.keys(n.rules||{}).length).sort((n,u)=>{var j;return(j=n.currency_code)==null?void 0:j.localeCompare(u.currency_code)}),i=!!a.length,[r,l]=_.useState(3),o=a.slice(0,r),c=()=>{l(r+3)};return e.jsxs(f,{className:"flex flex-col divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(h,{level:"h2",children:t("labels.prices")}),e.jsx(p,{groups:[{actions:[{label:t("actions.edit"),to:`/products/${s.product_id}/variants/${s.id}/prices`,icon:e.jsx(A,{})}]}]})]}),!i&&e.jsx(E,{className:"h-60"}),o.map(n=>e.jsxs("div",{className:"txt-small text-ui-fg-subtle flex justify-between px-6 py-4",children:[e.jsx("span",{className:"font-medium",children:n.currency_code.toUpperCase()}),e.jsx("span",{children:S(n.amount,n.currency_code)})]},n.id)),i&&e.jsxs("div",{className:"txt-small text-ui-fg-subtle flex items-center justify-between px-6 py-4",children:[e.jsx("span",{className:"font-medium",children:t("products.variant.pricesPagination",{total:a.length,current:Math.min(r,a.length)})}),e.jsx(H,{onClick:c,disabled:r>=a.length,className:"-mr-3 text-blue-500",variant:"transparent",children:t("actions.showMore")})]})]})}var Ae=()=>{const s=D(),{id:t,variant_id:a}=I(),{variant:i,isLoading:r,isError:l,error:o}=K(t,a,{fields:b},{initialData:s});if(r||!i)return e.jsx("div",{children:"Loading..."});if(l)throw o;return e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-x-4 gap-y-3 xl:flex-row xl:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx(F,{variant:i}),e.jsx(U,{inventoryItems:i.inventory_items.map(c=>({...c.inventory,required_quantity:c.required_quantity,variant:i})),manageInventory:i.manage_inventory}),e.jsx("div",{className:"hidden xl:block",children:e.jsx(y,{data:i,root:"product"})})]}),e.jsxs("div",{className:"flex w-full max-w-[100%] flex-col gap-y-3 xl:mt-0 xl:max-w-[400px]",children:[e.jsx(W,{variant:i}),e.jsx("div",{className:"xl:hidden",children:e.jsx(y,{data:i})})]})]}),e.jsx(T,{})]})};export{Ae as Component,ze as loader};
