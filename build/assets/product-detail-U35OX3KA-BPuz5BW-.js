import{T as z}from"./chunk-FGHVNTU2-HfmduO2_.js";import{g as F}from"./chunk-OIAPXGI2-CkBelqNL.js";import{S as u}from"./chunk-ULQT3HE4-DTXseesA.js";import"./chunk-3IW4HYUP-C89ww9p0.js";import{q as O,h as Q,v as W,j as e,w as R,s as H,u as p,C as g,H as y,b as J,r as C,g as B,x as $,L as b,T as w,B as N,k as Y,y as U}from"./index-7A3rjJyE.js";import{P as L}from"./chunk-SWMQZ55N-BUcYz0eG.js";import{A as f}from"./chunk-WRXTMI2J-CygmDunM.js";import{u as G,D as Z}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import{P as A}from"./chunk-P3UUX2T6-Bigsa15J.js";import{u as X}from"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{a as ee}from"./chunk-TQZNQHGA-CqGicYvo.js";import{d as te,p as se,a as ie,e as ae,f as ne,g as le,h as re}from"./chunk-YBHG7T6S-BleHOTgO.js";import{P as v}from"./pencil-square-mUSTT5rR.js";import{S as oe}from"./status-badge-BK5p0WUV.js";import{T as D}from"./trash-C_lucST6.js";import{T as ce}from"./thumbnail-badge-B_XgQTWQ.js";import{P as E}from"./plus-o2nCfN-i.js";import{C as de}from"./channels-D53LzY8a.js";import{T as ue}from"./Trans-Cyi6soNY.js";import{C as M}from"./component-COQxFSkg.js";import{u as P}from"./use-prompt-iL3FbEo4.js";import{C as me}from"./checkbox-BD385cy_.js";import{B as xe}from"./label-DDCdtDlT.js";import{C as _}from"./command-bar-DBncXrlJ.js";import{c as pe}from"./index-DL2eSRCZ.js";import"./arrow-up-right-on-box-CF7GLQ-o.js";import"./x-mark-mini-Di7jARRp.js";import"./triangle-down-mini-BHNqpDM0.js";import"./square-two-stack-Ao9P_yLE.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./index-DFaNeppw.js";import"./chunk-DMYZ6SLX-BMyt3Z-P.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";const he={widgets:[]},fe={widgets:[]},ve={widgets:[]},je={widgets:[]};var ge=t=>({queryKey:se.detail(t),queryFn:async()=>H.admin.product.retrieve(t,{fields:L})}),Ct=async({params:t})=>{const s=t.id,a=ge(s);return O.getQueryData(a.queryKey)??await O.fetchQuery(a)},ye=({product:t})=>{const{t:s}=p();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("products.attributes")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"attributes",icon:e.jsx(v,{})}]}]})]}),e.jsx(u,{title:s("fields.height"),value:t.height}),e.jsx(u,{title:s("fields.width"),value:t.width}),e.jsx(u,{title:s("fields.length"),value:t.length}),e.jsx(u,{title:s("fields.weight"),value:t.weight}),e.jsx(u,{title:s("fields.midCode"),value:t.mid_code}),e.jsx(u,{title:s("fields.hsCode"),value:t.hs_code}),e.jsx(u,{title:s("fields.countryOfOrigin"),value:F(t.origin_country)})]})},be=t=>{switch(t){case"draft":return"grey";case"proposed":return"orange";case"published":return"green";case"rejected":return"red";default:return"grey"}},we=({product:t})=>{const{t:s}=p(),a=P(),i=J(),{mutateAsync:n}=ie(t.id),l=async()=>{await a({title:s("general.areYouSure"),description:s("products.deleteWarning",{title:t.title}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await n(void 0,{onSuccess:()=>{i("..")}})};return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{children:t.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(oe,{color:be(t.status),children:s(`products.productStatus.${t.status}`)}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"edit",icon:e.jsx(v,{})}]},{actions:[{label:s("actions.delete"),onClick:l,icon:e.jsx(D,{})}]}]})]})]}),e.jsx(u,{title:s("fields.description"),value:t.description}),e.jsx(u,{title:s("fields.subtitle"),value:t.subtitle}),e.jsx(u,{title:s("fields.handle"),value:`/${t.handle}`}),e.jsx(u,{title:s("fields.discountable"),value:t.discountable?s("fields.true"):s("fields.false")})]})},Ne=({product:t})=>{const{t:s}=p(),a=P(),[i,n]=C.useState({}),l=_e(t),c=r=>{n(d=>{if(d[r]){const{[r]:m,...x}=d;return x}else return{...d,[r]:!0}})},{mutateAsync:o}=ae(t.id),h=async()=>{const r=Object.keys(i),d=r.some(j=>{var T;return(T=l.find(k=>k.id===j))==null?void 0:T.isThumbnail});if(!await a({title:s("general.areYouSure"),description:d?s("products.media.deleteWarningWithThumbnail",{count:r.length}):s("products.media.deleteWarning",{count:r.length}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")}))return;const x=t.images.filter(j=>!r.includes(j.id)).map(j=>j.url);await o({images:x,thumbnail:d?"":void 0},{onSuccess:()=>{n({})}})};return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("products.media.label")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"media?view=edit",icon:e.jsx(v,{})}]}]})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4",children:l.map((r,d)=>{const m=i[r.id];return e.jsxs("div",{className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",children:[e.jsx("div",{className:B("transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",{"visible opacity-100":m}),children:e.jsx(me,{checked:i[r.id]||!1,onCheckedChange:()=>c(r.id)})}),r.isThumbnail&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx($,{content:s("fields.thumbnail"),children:e.jsx(ce,{})})}),e.jsx(b,{to:"media",state:{curr:d},children:e.jsx("img",{src:r.url,alt:`${t.title} image`,className:"size-full object-cover"})})]},r.id)})}):e.jsxs("div",{className:"flex flex-col items-center gap-y-4 pb-8 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(w,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:s("products.media.emptyState.header")}),e.jsx(w,{size:"small",className:"text-ui-fg-muted",children:s("products.media.emptyState.description")})]}),e.jsx(xe,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(b,{to:"media?view=edit",children:s("products.media.emptyState.action")})})]}),e.jsx(_,{open:!!Object.keys(i).length,children:e.jsxs(_.Bar,{children:[e.jsx(_.Value,{children:s("general.countSelected",{count:Object.keys(i).length})}),e.jsx(_.Seperator,{}),e.jsx(_.Command,{action:h,label:s("actions.delete"),shortcut:"d"})]})})]})},_e=t=>{const{images:s=[],thumbnail:a}=t,i=s.map(n=>({id:n.id,url:n.url,isThumbnail:n.url===a}));return a&&!i.some(n=>n.url===a)&&i.unshift({id:"img_thumbnail",url:a,isThumbnail:!0}),i},Se=({product:t,option:s})=>{const{t:a}=p(),{mutateAsync:i}=le(t.id,s.id),n=P(),l=async()=>{await n({title:a("general.areYouSure"),description:a("products.deleteWarning",{title:t.title}),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await i()};return e.jsx(f,{groups:[{actions:[{label:a("actions.edit"),to:`options/${s.id}/edit`,icon:e.jsx(v,{})}]},{actions:[{label:a("actions.delete"),onClick:l,icon:e.jsx(D,{})}]}]})},Ce=({product:t})=>{var a;const{t:s}=p();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("products.options.header")}),e.jsx(f,{groups:[{actions:[{label:s("actions.create"),to:"options/create",icon:e.jsx(E,{})}]}]})]}),(a=t.options)==null?void 0:a.map(i=>{var n;return e.jsx(u,{title:i.title,value:(n=i.values)==null?void 0:n.map(l=>e.jsx(N,{size:"2xsmall",className:"flex min-w-[20px] items-center justify-center",children:l.value},l.value)),actions:e.jsx(Se,{product:t,option:i})},i.id)})]})},Pe=({product:t})=>{var a,i;const{t:s}=p();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("products.organization.header")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"organization",icon:e.jsx(v,{})}]}]})]}),e.jsx(u,{title:s("fields.tags"),value:(a=t.tags)!=null&&a.length?t.tags.map(n=>e.jsx(N,{className:"w-fit",size:"2xsmall",asChild:!0,children:e.jsx(b,{to:`/products?tags=${n.id}`,children:n.value})},n.id)):void 0}),e.jsx(u,{title:s("fields.type"),value:t.type?e.jsx(N,{size:"2xsmall",className:"w-fit",asChild:!0,children:e.jsx(b,{to:`/products?type_id=${t.type_id}`,children:t.type.value})}):void 0}),e.jsx(u,{title:s("fields.collection"),value:t.collection?e.jsx(N,{size:"2xsmall",color:"blue",className:"w-fit",asChild:!0,children:e.jsx(b,{to:`/collections/${t.collection.id}`,children:t.collection.title})}):void 0}),e.jsx(u,{title:s("fields.categories"),value:(i=t.categories)!=null&&i.length?t.categories.map(n=>e.jsx(N,{className:"w-fit",color:"purple",size:"2xsmall",asChild:!0,children:e.jsx(b,{to:`/categories/${n.id}`,children:n.name})},n.id)):void 0})]})},Te=({product:t})=>{var c;const{count:s}=ee(),{t:a}=p(),i=((c=t.sales_channels)==null?void 0:c.map(o=>({id:o.id,name:o.name})))??[],n=i.slice(0,3),l=i.slice(3);return e.jsxs(g,{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{level:"h2",children:a("fields.sales_channels")}),e.jsx(f,{groups:[{actions:[{label:a("actions.edit"),to:"sales-channels",icon:e.jsx(v,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(de,{className:"text-ui-fg-subtle"})})}),i.length>0?e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(w,{size:"small",leading:"compact",children:n.map(o=>o.name).join(", ")}),l.length>0&&e.jsx($,{content:e.jsx("ul",{children:l.map(o=>e.jsx("li",{children:o.name},o.id))}),children:e.jsx(w,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:`+${l.length}`})})]}):e.jsx(w,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:a("products.noSalesChannels")})]}),e.jsx("div",{children:e.jsx(w,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:e.jsx(ue,{i18nKey:"sales_channels.availableIn",values:{x:i.length,y:s??0},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})})]})},ke=({variant:t,product:s})=>{var m;const{mutateAsync:a}=re(s.id,t.id),{t:i}=p(),n=P(),l=((m=t.inventory_items)==null?void 0:m.length)||0,c=l===1,o=l>1,h=async()=>{await n({title:i("general.areYouSure"),description:i("products.deleteVariantWarning",{title:t.title}),confirmText:i("actions.delete"),cancelText:i("actions.cancel")})&&await a()},[r,d]=C.useMemo(()=>{var q;if(!((q=t.inventory_items)!=null&&q.length))return["",""];const j=`/inventory/${t.inventory_items[0].inventory.id}`,k={id:t.inventory_items.map(V=>V.inventory.id)},K=`/inventory?${new URLSearchParams(k).toString()}`;return[j,K]},[t.inventory_items]);return e.jsx(f,{groups:[{actions:[{label:i("actions.edit"),to:`variants/${t.id}/edit`,icon:e.jsx(v,{})},{label:i("actions.delete"),onClick:h,icon:e.jsx(D,{})},c?{label:i("products.variant.inventory.actions.inventoryItems"),to:r,icon:e.jsx(U,{})}:!1,o?{label:i("products.variant.inventory.actions.inventoryKit"),to:d,icon:e.jsx(M,{})}:!1].filter(Boolean)}]})},S=pe(),ze=t=>{const{t:s}=p(),a=C.useMemo(()=>{var i;return t?(i=t.options)==null?void 0:i.map(n=>S.display({id:n.id,header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:n.title})}),cell:({row:l})=>{const c=l.original.options.find(o=>o.option_id===n.id);return c?e.jsx("div",{className:"flex items-center",children:e.jsx(N,{size:"2xsmall",title:c.value,className:"inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",children:c.value})}):e.jsx(A,{})}})):[]},[t]);return C.useMemo(()=>[S.accessor("title",{header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s("fields.title")})}),cell:({getValue:i})=>e.jsx("div",{className:"flex h-full w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:i()})})}),S.accessor("sku",{header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s("fields.sku")})}),cell:({getValue:i})=>{const n=i();return n?e.jsx("div",{className:"flex h-full w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:n})}):e.jsx(A,{})}}),...a,S.accessor("inventory_items",{header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s("fields.inventory")})}),cell:({getValue:i,row:n})=>{const l=n.original;if(!l.manage_inventory)return s("products.variant.inventory.notManaged");const c=i().map(m=>m.inventory),o=c.length>1,h={};c.forEach(m=>{m.location_levels.forEach(x=>{h[x.id]=!0})});const r=Object.keys(h).length,d=o?s("products.variant.tableItemAvailable",{availableCount:l.inventory_quantity}):s("products.variant.tableItem",{availableCount:l.inventory_quantity,locationCount:r,count:r});return e.jsxs("div",{className:"flex h-full w-full items-center gap-2 overflow-hidden",children:[o&&e.jsx(M,{style:{marginTop:1}}),e.jsx("span",{className:B("truncate",{"text-ui-fg-error":!l.inventory_quantity}),title:d,children:d})]})}}),S.display({id:"actions",cell:({row:i,table:n})=>{const{product:l}=n.options.meta;return e.jsx(ke,{variant:i.original,product:l})}})],[s,a])},Ie=()=>{const{t}=p();let s=[];const a={key:"manage_inventory",label:t("fields.managedInventory"),type:"select",options:[{label:t("fields.true"),value:"true"},{label:t("fields.false"),value:"false"}]},i={key:"allow_backorder",label:t("fields.allowBackorder"),type:"select",options:[{label:t("fields.true"),value:"true"},{label:t("fields.false"),value:"false"}]},n=[{label:t("fields.createdAt"),key:"created_at"},{label:t("fields.updatedAt"),key:"updated_at"}].map(l=>({key:l.key,label:l.label,type:"date"}));return s=[...s,a,i,...n],s},De=({pageSize:t,prefix:s})=>{const a=X(["offset","q","manage_inventory","allow_backorder","order","created_at","updated_at"],s),{offset:i,manage_inventory:n,allow_backorder:l,created_at:c,updated_at:o,q:h,order:r}=a;return{searchParams:{limit:t,offset:i?Number(i):0,manage_inventory:n?n==="true":void 0,allow_backorder:l?l==="true":void 0,order:r,created_at:c?JSON.parse(c):void 0,updated_at:o?JSON.parse(o):void 0,q:h},raw:a}},I=10,qe=({product:t})=>{const{t:s}=p(),{searchParams:a,raw:i}=De({pageSize:I}),{variants:n,count:l,isLoading:c,isError:o,error:h}=ne(t.id,{...a,fields:"*inventory_items.inventory.location_levels,+inventory_quantity"},{placeholderData:Y}),r=Ie(),d=ze(t),{table:m}=G({data:n??[],columns:d,count:l,enablePagination:!0,getRowId:x=>x.id,pageSize:I,meta:{product:t}});if(o)throw h;return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("products.variants")}),e.jsx(f,{groups:[{actions:[{label:s("actions.create"),to:"variants/create",icon:e.jsx(E,{})},{label:s("products.editPrices"),to:"prices",icon:e.jsx(v,{})}]}]})]}),e.jsx(Z,{table:m,columns:d,filters:r,count:l,pageSize:I,isLoading:c,orderBy:["title","created_at","updated_at"],navigateTo:x=>`/products/${x.original.product_id}/variants/${x.id}`,pagination:!0,search:!0,queryObject:i})]})},Pt=()=>{const t=Q(),{id:s}=W(),{product:a,isLoading:i,isError:n,error:l}=te(s,{fields:L},{initialData:t});if(i||!a)return e.jsx(R,{mainSections:4,sidebarSections:3,showJSON:!0,showMetadata:!0});if(n)throw l;return e.jsxs(z,{widgets:{after:he,before:fe,sideAfter:ve,sideBefore:je},showJSON:!0,showMetadata:!0,data:a,children:[e.jsxs(z.Main,{children:[e.jsx(we,{product:a}),e.jsx(Ne,{product:a}),e.jsx(Ce,{product:a}),e.jsx(qe,{product:a})]}),e.jsxs(z.Sidebar,{children:[e.jsx(Te,{product:a}),e.jsx(Pe,{product:a}),e.jsx(ye,{product:a})]})]})};export{Pt as Component,Ct as loader};
