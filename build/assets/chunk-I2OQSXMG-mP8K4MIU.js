import{r as o,j as l,g as N,u as k,H as J,t as P,bY as Z,am as u,n as q,bZ as Q,W as _}from"./index-7A3rjJyE.js";import{a as m,u as X}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as ee,b as re,F as p}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as ae}from"./zod-DRKIF09R.js";import{z as x}from"./index-yuYasa5Y.js";import{T as te}from"./trash-C_lucST6.js";import{B as R}from"./label-DDCdtDlT.js";var le=Object.defineProperty,h=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,I=(e,r,a)=>r in e?le(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,se=(e,r)=>{for(var a in r||(r={}))C.call(r,a)&&I(e,a,r[a]);if(h)for(var a of h(r))T.call(r,a)&&I(e,a,r[a]);return e},ie=(e,r)=>{var a={};for(var t in e)C.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&h)for(var t of h(e))r.indexOf(t)<0&&T.call(e,t)&&(a[t]=e[t]);return a};const F=o.forwardRef((e,r)=>{var a=e,{color:t="currentColor"}=a,i=ie(a,["color"]);return o.createElement("svg",se({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},i),o.createElement("path",{stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 13.056V1.944M11.278 9.278 7.5 13.056 3.722 9.278"}))});F.displayName="ArrowDownMini";var oe=Object.defineProperty,b=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,M=(e,r,a)=>r in e?oe(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,ne=(e,r)=>{for(var a in r||(r={}))D.call(r,a)&&M(e,a,r[a]);if(b)for(var a of b(r))V.call(r,a)&&M(e,a,r[a]);return e},de=(e,r)=>{var a={};for(var t in e)D.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&b)for(var t of b(e))r.indexOf(t)<0&&V.call(e,t)&&(a[t]=e[t]);return a};const L=o.forwardRef((e,r)=>{var a=e,{color:t="currentColor"}=a,i=de(a,["color"]);return o.createElement("svg",ne({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},i),o.createElement("path",{stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 1.944v11.112M3.722 5.722 7.5 1.944l3.778 3.778"}))});L.displayName="ArrowUpMini";var ce=Object.defineProperty,g=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,A=(e,r,a)=>r in e?ce(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,me=(e,r)=>{for(var a in r||(r={}))B.call(r,a)&&A(e,a,r[a]);if(g)for(var a of g(r))U.call(r,a)&&A(e,a,r[a]);return e},fe=(e,r)=>{var a={};for(var t in e)B.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&g)for(var t of g(e))r.indexOf(t)<0&&U.call(e,t)&&(a[t]=e[t]);return a};const z=o.forwardRef((e,r)=>{var a=e,{color:t="currentColor"}=a,i=fe(a,["color"]);return o.createElement("svg",me({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:r},i),o.createElement("path",{fill:t,fillRule:"evenodd",d:"M6.306 7.5a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 2.389a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 12.611a1.194 1.194 0 1 1 2.388 0 1.194 1.194 0 0 1-2.388 0",clipRule:"evenodd"}))});z.displayName="EllipsisVertical";var ue=x.object({key:x.string(),disabled:x.boolean().optional(),value:x.any()}),pe=x.object({metadata:x.array(ue)}),Pe=e=>{const{t:r}=k(),{isPending:a,...t}=e;return l.jsxs(m,{children:[l.jsxs(m.Header,{children:[l.jsx(m.Title,{asChild:!0,children:l.jsx(J,{children:r("metadata.edit.header")})}),l.jsx(m.Description,{className:"sr-only",children:r("metadata.edit.description")})]}),a?l.jsx(ve,{}):l.jsx(xe,{...t})]})},S="metadata-form-key-label",$="metadata-form-value-label",xe=({metadata:e,hook:r,isMutating:a})=>{const{t}=k(),{handleSuccess:i}=X();o.useRef([]);const n=ge(e),s=ee({defaultValues:{metadata:he(e)},resolver:ae(pe)}),j=s.handleSubmit(async d=>{const c=be(d);await r({metadata:c},{onSuccess:()=>{P.success(t("metadata.edit.successToast")),i()},onError:f=>{P.error(f.message)}})}),{fields:v,insert:W,remove:Y}=re({control:s.control,name:"metadata"});function G(d){Y(d)}function E(d,c){W(d+(c==="above"?0:1),{key:"",value:"",disabled:!1})}return l.jsx(m.Form,{form:s,children:l.jsxs("form",{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[l.jsxs(m.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[l.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[l.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[l.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:l.jsx("label",{id:S,children:t("metadata.edit.labels.key")})}),l.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:l.jsx("label",{id:$,children:t("metadata.edit.labels.value")})})]}),v.map((d,c)=>{const f=d.disabled||!1;let w="-";return typeof d.value=="object"&&(w="{ ... }"),Array.isArray(d.value)&&(w="[ ... ]"),l.jsx(Z,{showTooltip:f,content:t("metadata.edit.complexRow.tooltip"),children:l.jsxs("div",{className:"group/table relative",children:[l.jsxs("div",{className:N("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":c===v.length-1}),children:[l.jsx(p.Field,{control:s.control,name:`metadata.${c}.key`,render:({field:y})=>l.jsx(p.Item,{children:l.jsx(p.Control,{children:l.jsx(O,{"aria-labelledby":S,...y,disabled:f,placeholder:"Key"})})})}),l.jsx(p.Field,{control:s.control,name:`metadata.${c}.value`,render:({field:{value:y,...K}})=>l.jsx(p.Item,{children:l.jsx(p.Control,{children:l.jsx(O,{"aria-labelledby":$,...K,value:f?w:y,disabled:f,placeholder:"Value"})})})})]}),l.jsxs(u,{children:[l.jsx(u.Trigger,{className:N("invisible absolute inset-y-0 -right-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:f}),disabled:f,asChild:!0,children:l.jsx(q,{size:"2xsmall",children:l.jsx(z,{})})}),l.jsxs(u.Content,{children:[l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>E(c,"above"),children:[l.jsx(L,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowAbove")]}),l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>E(c,"below"),children:[l.jsx(F,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowBelow")]}),l.jsx(u.Separator,{}),l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>G(c),children:[l.jsx(te,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.deleteRow")]})]})]})]})},d.id)})]}),n&&l.jsx(Q,{variant:"warning",label:t("metadata.edit.complexRow.label"),children:t("metadata.edit.complexRow.description")})]}),l.jsx(m.Footer,{children:l.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[l.jsx(m.Close,{asChild:!0,children:l.jsx(R,{size:"small",variant:"secondary",type:"button",disabled:a,children:t("actions.cancel")})}),l.jsx(R,{size:"small",type:"submit",isLoading:a,children:t("actions.save")})]})})]})})},O=o.forwardRef(({className:e,...r},a)=>l.jsx("input",{ref:a,...r,autoComplete:"off",className:N("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",e)}));O.displayName="MetadataForm.GridInput";var ve=()=>l.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[l.jsx(m.Body,{children:l.jsx(_,{className:"h-[148ox] w-full rounded-lg"})}),l.jsx(m.Footer,{children:l.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[l.jsx(_,{className:"h-7 w-12 rounded-md"}),l.jsx(_,{className:"h-7 w-12 rounded-md"})]})})]}),H=["string","number","boolean"];function he(e){return!e||!Object.keys(e).length?[{key:"",value:"",disabled:!1}]:Object.entries(e).map(([r,a])=>{if(!H.includes(typeof a))return{key:r,value:a,disabled:!0};let t=a;return typeof a!="string"&&(t=JSON.stringify(a)),{key:r,value:t,original_key:r}})}function be(e){const r=e.metadata;if(!r.length||r.length===1&&!r[0].key&&!r[0].value)return null;const t={};return r.forEach(i=>{let n=i.key,s=i.value;const j=i.disabled;if(!(!n||!s)){if(j){t[n]=s;return}if(n=n.trim(),s=s.trim(),s==="true")t[n]=!0;else if(s==="false")t[n]=!1;else{const v=parseFloat(s);isNaN(v)?t[n]=s:t[n]=v}}}),t}function ge(e){return e?Object.values(e).some(r=>!H.includes(typeof r)):!1}export{Pe as M};
