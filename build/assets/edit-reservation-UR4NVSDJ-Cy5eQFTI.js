import{c as w,d as E}from"./chunk-KWVVOB4B-Bc14zBvB.js";import{a as I}from"./chunk-OIW3F4EQ-D8V0uZdG.js";import{b as R}from"./chunk-DMYZ6SLX-BMyt3Z-P.js";import{v as k,u as F,j as e,H as C,t as _,I as N,T as q}from"./index-7A3rjJyE.js";import{a as u,u as T}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as z,F as s}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as L}from"./zod-DRKIF09R.js";import{z as p}from"./index-yuYasa5Y.js";import{S as x}from"./select-cXhfXDq8.js";import{T as M}from"./textarea-Cvx7IHRI.js";import{B as S}from"./label-DDCdtDlT.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";import"./triangles-mini-JWkpofVU.js";var V=p.object({location_id:p.string(),description:p.string().optional(),quantity:p.number().min(1)}),h=({title:t,value:n})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(q,{className:"px-2 py-1.5",size:"small",leading:"compact",children:t}),e.jsx(q,{className:"px-2 py-1.5",size:"small",leading:"compact",children:n})]}),A=t=>({quantity:t.quantity,location_id:t.location_id,description:t.description??void 0}),B=({reservation:t,item:n,locations:l})=>{const{t:i}=F(),{handleSuccess:f}=T(),a=z({defaultValues:A(t),resolver:L(V)}),{mutateAsync:o}=E(t.id),j=a.handleSubmit(async r=>{o(r,{onSuccess:()=>{_.success(i("inventory.reservation.updateSuccessToast")),f()},onError:m=>{_.error(m.message)}})}),y=a.watch("quantity"),v=a.watch("location_id"),d=n.location_levels.find(r=>r.location_id===v);return e.jsx(u.Form,{form:a,children:e.jsxs("form",{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(u.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(s.Field,{control:a.control,name:"location_id",render:({field:{onChange:r,value:m,ref:g,...b}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("inventory.reservation.location")}),e.jsx(s.Control,{children:e.jsxs(x,{value:m,onValueChange:c=>{r(c)},...b,children:[e.jsx(x.Trigger,{ref:g,children:e.jsx(x.Value,{})}),e.jsx(x.Content,{children:(l||[]).map(c=>e.jsx(x.Item,{value:c.id,children:c.name},c.id))})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(h,{title:i("fields.title"),value:n.title??n.sku}),e.jsx(h,{title:i("fields.sku"),value:n.sku}),e.jsx(h,{title:i("fields.inStock"),value:d.stocked_quantity}),e.jsx(h,{title:i("inventory.available"),value:d.stocked_quantity-(d.reserved_quantity-t.quantity)-y})]}),e.jsx(s.Field,{control:a.control,name:"quantity",render:({field:{onChange:r,value:m,...g}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("inventory.reservation.reservedAmount")}),e.jsx(s.Control,{children:e.jsx(N,{type:"number",min:0,max:d.available_quantity+t.quantity,value:m||"",onChange:b=>{const c=b.target.value;r(c===""?null:parseFloat(c))},...g})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:a.control,name:"description",render:({field:r})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:i("fields.description")}),e.jsx(s.Control,{children:e.jsx(M,{...r})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(S,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(S,{type:"submit",size:"small",isLoading:!1,children:i("actions.save")})]})})]})})},ee=()=>{var v;const{id:t}=k(),{t:n}=F(),{reservation:l,isPending:i,isError:f,error:a}=w(t),{inventory_item:o}=R(l==null?void 0:l.inventory_item_id,{enabled:!!l}),{stock_locations:j}=I({id:(v=o==null?void 0:o.location_levels)==null?void 0:v.map(d=>d.location_id)},{enabled:!!(o!=null&&o.location_levels)}),y=!i&&l&&o&&j;if(f)throw a;return e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx(C,{children:n("inventory.reservation.editItemDetails")})}),y&&e.jsx(B,{locations:j,reservation:l,item:o})]})};export{ee as Component};
