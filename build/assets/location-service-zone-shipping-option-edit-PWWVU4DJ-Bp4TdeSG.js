import{a as L}from"./chunk-R2O6QX4D-CX21ziz_.js";import{S as E}from"./chunk-OUAFSZKF-BpzSoAuD.js";import{f as F}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{u as O,c as T}from"./chunk-MWKG2EGE-VcYUZG_Z.js";import{u as S,v as V,J as k,j as e,H as I,s as _,t as g,I as P,D as w}from"./index-7A3rjJyE.js";import{S as N}from"./chunk-ARXK2O3B-CKHwWM2L.js";import{u as b}from"./chunk-KKUJQ3HN-BWZVkDDd.js";import{C as y}from"./chunk-UY4EBCIZ-D3QWhMGG.js";import{a as m,u as B}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as R,F as o}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{o as q,s as f,c as D,b as M}from"./index-yuYasa5Y.js";import{R as x}from"./radio-group-C5P_IsHK.js";import{B as v}from"./label-DDCdtDlT.js";import"./chunk-OIW3F4EQ-D8V0uZdG.js";import"./switch-DDIyRuzh.js";import"./index-dBm6oMZZ.js";import"./x-mark-mini-Di7jARRp.js";import"./triangles-mini-JWkpofVU.js";import"./plus-mini-BHxdUq8n.js";import"./prompt-KZNvJYzq.js";function H(c,r){const s={};return r.forEach(n=>{n in c&&(s[n]=c[n])}),s}q({name:f().min(1),price_type:D(E),enabled_in_store:M().optional(),shipping_profile_id:f(),provider_id:f()});var z=({locationId:c,shippingOption:r})=>{const{t:s}=S(),{handleSuccess:n}=B(),l=b({queryFn:i=>_.admin.shippingProfile.list(i),queryKey:["shipping_profiles"],getOptions:i=>i.shipping_profiles.map(a=>({label:a.name,value:a.id})),defaultValue:r.shipping_profile_id}),d=b({queryFn:i=>_.admin.fulfillmentProvider.list(i),queryKey:["fulfillment_providers"],getOptions:i=>i.fulfillment_providers.map(a=>({label:F(a.id),value:a.id})),defaultValue:r.provider_id}),t=R({defaultValues:{name:r.name,price_type:r.price_type,enabled_in_store:L(r),shipping_profile_id:r.shipping_profile_id,provider_id:r.provider_id}}),{mutateAsync:h,isPending:u}=T(r.id),C=t.handleSubmit(async i=>{const a=r.rules.map(p=>({...H(p,["id","attribute","operator","value"])})),j=a.find(p=>p.attribute==="enabled_in_store");j?j.value=i.enabled_in_store?"true":"false":a.push({value:i.enabled_in_store?"true":"false",attribute:"enabled_in_store",operator:"eq"}),await h({name:i.name,price_type:i.price_type,shipping_profile_id:i.shipping_profile_id,provider_id:i.provider_id,rules:a},{onSuccess:({shipping_option:p})=>{g.success(s("stockLocations.shippingOptions.edit.successToast",{name:p.name})),n(`/settings/locations/${c}`)},onError:p=>{g.error(p.message)}})});return e.jsx(m.Form,{form:t,children:e.jsxs("form",{onSubmit:C,className:"flex flex-1 flex-col",children:[e.jsx(m.Body,{children:e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(o.Field,{control:t.control,name:"price_type",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(o.Control,{children:e.jsxs(x,{...i,onValueChange:i.onChange,children:[e.jsx(x.ChoiceBox,{className:"flex-1",value:"flat",label:s("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:s("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(x.ChoiceBox,{className:"flex-1",value:"calculated",label:s("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:s("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsx(o.Field,{control:t.control,name:"name",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("fields.name")}),e.jsx(o.Control,{children:e.jsx(P,{...i})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"shipping_profile_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.profile")}),e.jsx(o.Control,{children:e.jsx(y,{...i,options:l.options,searchValue:l.searchValue,onSearchValueChange:l.onSearchValueChange,disabled:l.disabled})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"provider_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.provider")}),e.jsx(o.Control,{children:e.jsx(y,{...i,options:d.options,searchValue:d.searchValue,onSearchValueChange:d.onSearchValueChange,disabled:d.disabled})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(w,{}),e.jsx(N,{control:t.control,name:"enabled_in_store",label:s("stockLocations.shippingOptions.fields.enableInStore.label"),description:s("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(v,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(v,{size:"small",type:"submit",isLoading:u,children:s("actions.save")})]})})]})})},pe=()=>{const{t:c}=S(),{location_id:r,so_id:s}=V(),{shipping_options:n,isPending:l,isError:d,error:t}=O({id:s}),h=n==null?void 0:n.find(u=>u.id===s);if(d)throw t;if(!l&&!h)throw k({message:`Shipping option with ID ${s} was not found`},404);return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(I,{children:c("stockLocations.shippingOptions.edit.header")})}),!l&&h&&e.jsx(z,{shippingOption:h,locationId:r})]})};export{pe as Component};
