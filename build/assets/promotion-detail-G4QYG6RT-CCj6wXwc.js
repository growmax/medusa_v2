import{B as _}from"./chunk-BKJC5BGQ-lBPY5-jj.js";import{g as S}from"./chunk-KDXAFTVE-BIJQy-Te.js";import{J as N}from"./chunk-3IW4HYUP-C89ww9p0.js";import{q as b,h as P,v as z,ca as T,c6 as p,j as e,O as L,c0 as R,p as q,u as d,C as g,H as f,b as A,c2 as E,T as a,B as C,r as B}from"./index-7A3rjJyE.js";import{A as j}from"./chunk-WRXTMI2J-CygmDunM.js";import{N as D}from"./chunk-WX2SMNCD-D4nWbVrW.js";import{P as h}from"./pencil-square-mUSTT5rR.js";import{T as $}from"./trash-C_lucST6.js";import{u as I}from"./use-prompt-iL3FbEo4.js";import{S as k}from"./status-badge-BK5p0WUV.js";import{C as M}from"./copy-DaTMJgYc.js";import{f as Q}from"./format-CkWRMO1y.js";import"./arrow-up-right-on-box-CF7GLQ-o.js";import"./Trans-Cyi6soNY.js";import"./x-mark-mini-Di7jARRp.js";import"./triangle-down-mini-BHNqpDM0.js";import"./square-two-stack-Ao9P_yLE.js";import"./plus-mini-BHxdUq8n.js";import"./label-DDCdtDlT.js";import"./prompt-KZNvJYzq.js";const V={widgets:[]},H={widgets:[]};var K=s=>({queryKey:R.detail(s),queryFn:async()=>q.promotions.retrieve(s)}),fe=async({params:s})=>{const t=s.id,i=K(t);return b.getQueryData(i.queryKey)??await b.fetchQuery(i)};function w(s){return s?Q(new Date(s),"dd MMM yyyy"):"-"}var F=({campaign:s})=>{const{t}=d();return e.jsxs(B.Fragment,{children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.name")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(a,{size:"small",leading:"compact",className:"text-pretty",children:s==null?void 0:s.name})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.identifier")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(a,{size:"small",leading:"compact",className:"text-pretty",children:s==null?void 0:s.campaign_identifier})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.start_date")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(a,{size:"small",leading:"compact",className:"text-pretty",children:w(s==null?void 0:s.starts_at)})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("campaigns.fields.end_date")||"-"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(a,{size:"small",leading:"compact",className:"text-pretty",children:w(s==null?void 0:s.ends_at)})})]})]})},J=({campaign:s})=>{const{t}=d(),{id:i}=z();return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(f,{level:"h2",children:t("promotions.fields.campaign")}),e.jsx(j,{groups:[{actions:[{label:t("actions.edit"),to:"add-to-campaign",icon:e.jsx(h,{})}]}]})]}),s?e.jsx(F,{campaign:s}):e.jsx(D,{className:"h-[180px] p-6 text-center",title:"Not part of a campaign",message:"Add this promotion to an existing campaign",action:{to:`/promotions/${i}/add-to-campaign`,label:"Add to Campaign"},buttonVariant:"transparentIconLeft"})]})};function O({rule:s}){var t;return e.jsx("div",{className:"bg-ui-bg-subtle shadow-borders-base align-center flex justify-around rounded-md p-2",children:e.jsxs("div",{className:"text-ui-fg-subtle txt-compact-xsmall flex items-center whitespace-nowrap",children:[e.jsx(C,{size:"2xsmall",className:"txt-compact-xsmall-plus tag-neutral-text mx-1 inline-block truncate",children:s.attribute_label},"rule-attribute"),e.jsx("span",{className:"txt-compact-2xsmall mx-1 inline-block",children:s.operator_label}),e.jsx(_,{inline:!0,className:"!txt-compact-small-plus",list:s.field_type==="number"?[s.values]:(t=s.values)==null?void 0:t.map(i=>i.label)})]})})}var u=({rules:s,ruleType:t})=>{const{t:i}=d();return e.jsxs(g,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(f,{children:i(`promotions.fields.conditions.${t}.title`)})}),e.jsx(j,{groups:[{actions:[{icon:e.jsx(h,{}),label:i("actions.edit"),to:`${t}/edit`}]}]})]}),e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-2 px-6 pb-4 pt-2",children:[!s.length&&e.jsx(D,{className:"h-[180px]",title:i("general.noRecordsTitle"),message:i("promotions.conditions.list.noRecordsMessage"),action:{to:`${t}/edit`,label:i("promotions.conditions.add")},buttonVariant:"transparentIconLeft"}),s.map(l=>e.jsx(O,{rule:l},`${l.id}-${l.attribute}`))]})]})},G=({promotion:s})=>{var r,n,y,v;const{t}=d(),i=I(),l=A(),{mutateAsync:c}=E(s.id),o=async()=>{await i({title:t("general.areYouSure"),description:t("promotions.deleteWarning",{code:s.code}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.code,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await c(void 0,{onSuccess:()=>{l("/promotions",{replace:!0})}})},[m,x]={DISABLED:["grey",t("statuses.disabled")],ACTIVE:["green",t("statuses.active")],SCHEDULED:["orange",t("statuses.scheduled")],EXPIRED:["red",t("statuses.expired")]}[S(s)];return e.jsxs(g,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(f,{children:s.code})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(k,{color:m,children:x}),e.jsx(j,{groups:[{actions:[{icon:e.jsx(h,{}),label:t("actions.edit"),to:`/promotions/${s.id}/edit`}]},{actions:[{icon:e.jsx($,{}),label:t("actions.delete"),onClick:o}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.campaign")}),e.jsx(a,{size:"small",leading:"compact",className:"text-pretty",children:s.is_automatic?"Promotion code":"Automatic"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("fields.code")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",className:"text-pretty",children:s.code}),e.jsx(M,{content:s.code,variant:"mini"})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.type")}),e.jsx(a,{size:"small",leading:"compact",className:"text-pretty capitalize",children:s.type})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.value")}),e.jsxs(a,{size:"small",leading:"compact",className:"text-pretty",children:[e.jsx(a,{className:"inline pr-3",size:"small",leading:"compact",children:(r=s.application_method)==null?void 0:r.value}),((n=s==null?void 0:s.application_method)==null?void 0:n.type)==="fixed"&&e.jsx(C,{size:"xsmall",children:(y=s==null?void 0:s.application_method)==null?void 0:y.currency_code})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(a,{size:"small",weight:"plus",leading:"compact",children:t("promotions.fields.allocation")}),e.jsx(a,{size:"small",leading:"compact",className:"text-pretty capitalize",children:(v=s.application_method)==null?void 0:v.allocation})]})]})},je=()=>{const s=P(),{id:t}=z(),{promotion:i,isLoading:l}=T(t,{initialData:s}),c={};(i==null?void 0:i.type)==="buyget"&&(c.promotion_type=i.type);const{rules:o}=p(t,"rules",c),{rules:m}=p(t,"target-rules",c),{rules:x}=p(t,"buy-rules",c);return l||!i?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"flex flex-col gap-y-2",children:[H.widgets.map((r,n)=>e.jsx("div",{children:e.jsx(r.Component,{data:i})},n)),e.jsxs("div",{className:"flex flex-col gap-x-4 xl:flex-row xl:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx(G,{promotion:i}),e.jsx(u,{rules:o||[],ruleType:"rules"}),e.jsx(u,{rules:m||[],ruleType:"target-rules"}),i.type==="buyget"&&e.jsx(u,{rules:x||[],ruleType:"buy-rules"}),V.widgets.map((r,n)=>e.jsx("div",{children:e.jsx(r.Component,{data:i})},n)),e.jsx("div",{className:"hidden xl:block",children:e.jsx(N,{data:i})})]}),e.jsxs("div",{className:"mt-2 flex w-full max-w-[100%] flex-col gap-y-2 xl:mt-0 xl:max-w-[400px]",children:[e.jsx(J,{campaign:i.campaign}),e.jsx("div",{className:"xl:hidden",children:e.jsx(N,{data:i})})]})]}),e.jsx(L,{})]})};export{je as Component,fe as loader};
