import{P as Y}from"./chunk-LW4RKN4D-DzwZ-D_n.js";import{P as ee,a as se,u as re,b as te}from"./chunk-W6XVKIR4-FmInSyUk.js";import{j as e,r as T,u as z,t as B,H as ie,T as G,I as oe,D as k,g as ae,aJ as le,n as ne,k as ce}from"./index-7A3rjJyE.js";import{e as de,i as ue}from"./chunk-G2J2T2QU-CMBJZuqd.js";import{b as pe}from"./chunk-GMJC4MQM-BknCPGqF.js";import{u as me}from"./chunk-QBDU475K-BjRzsrqf.js";import{u as xe,a as he}from"./chunk-OGPZJ7JQ-9Z-hWx5h.js";import{D as fe}from"./chunk-ZUTZJQ3C-BDh6pyCy.js";import"./index.esm-L0DzsZPB.js";import{u as ge,b as je,F as r,a as E}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{u as be,D as ve}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{u as Q}from"./chunk-YBHG7T6S-BleHOTgO.js";import{R as w,u as ye,b as Pe,S as F}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{t as Se}from"./zod-DRKIF09R.js";import{z as h}from"./index-yuYasa5Y.js";import{X as Ce}from"./x-mark-mini-Di7jARRp.js";import{P as S}from"./progress-tabs-CBvjkL6b.js";import{B as O}from"./label-DDCdtDlT.js";import{R as H}from"./radio-group-C5P_IsHK.js";import{S as _}from"./select-cXhfXDq8.js";import{T as Le}from"./textarea-Cvx7IHRI.js";import{D as X}from"./date-picker-foikjjE_.js";import{C as $}from"./checkbox-BD385cy_.js";import{c as _e}from"./index-DL2eSRCZ.js";import"./chunk-APWN266K-BhXvr4m7.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-IQRVIEMV-JX6w9umB.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./chunk-YVTBRLIE-C161Iqr5.js";import"./chunk-RYVWLLZ2-BlkKIhzO.js";import"./chunk-PHMALPVO-EKeNghx2.js";import"./chunk-XVFLU5BP-pJYp3bDo.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-QHCOJC4V-B0yC0oe2.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-6XHB4MRO-DKQXmGFz.js";import"./chunk-ADOCJB6L-3PFdxvdK.js";import"./chunk-OPYB3EPU-B_-LG2wj.js";import"./chunk-TQZNQHGA-CqGicYvo.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./chunk-DMYZ6SLX-BMyt3Z-P.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";import"./triangles-mini-JWkpofVU.js";import"./clsx-B-dksMZM.js";var we=({form:o})=>{const{t:s}=z(),{fields:l,remove:n,append:g}=je({control:o.control,name:"rules.customer_group_id",keyName:"cg_id"}),{setIsOpen:j}=Pe(),u=a=>{const m=a.map(f=>f.id),c=a.filter(f=>!l.some(y=>y.id===f.id));for(const f of l)m.includes(f.id)||n(l.indexOf(f));g(c),j("cg",!1)};return e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-8 py-16",children:[e.jsxs("div",{children:[e.jsx(ie,{children:s("priceLists.create.header")}),e.jsx(G,{size:"small",className:"text-ui-fg-subtle",children:s("priceLists.create.subheader")})]}),e.jsx(r.Field,{control:o.control,name:"type",render:({field:{onChange:a,...m}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(r.Label,{children:s("priceLists.fields.type.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.type.hint")})]}),e.jsx(r.Control,{children:e.jsxs(H,{onValueChange:a,...m,className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(H.ChoiceBox,{value:"sale",label:s("priceLists.fields.type.options.sale.label"),description:s("priceLists.fields.type.options.sale.description")}),e.jsx(H.ChoiceBox,{value:"override",label:s("priceLists.fields.type.options.override.label"),description:s("priceLists.fields.type.options.override.description")})]})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1  gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:o.control,name:"title",render:({field:a})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.title")}),e.jsx(r.Control,{children:e.jsx(oe,{...a})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:o.control,name:"status",render:({field:{onChange:a,ref:m,...c}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("priceLists.fields.status.label")}),e.jsx(r.Control,{children:e.jsxs(_,{...c,onValueChange:a,children:[e.jsx(_.Trigger,{ref:m,children:e.jsx(_.Value,{})}),e.jsxs(_.Content,{children:[e.jsx(_.Item,{value:"active",children:s("priceLists.fields.status.options.active")}),e.jsx(_.Item,{value:"draft",children:s("priceLists.fields.status.options.draft")})]})]})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(r.Field,{control:o.control,name:"description",render:({field:a})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:s("fields.description")}),e.jsx(r.Control,{children:e.jsx(Le,{...a})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(k,{}),e.jsx(r.Field,{control:o.control,name:"starts_at",render:({field:a})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.startsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.startsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(X,{granularity:"minute",shouldCloseOnSelect:!1,...a})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(k,{}),e.jsx(r.Field,{control:o.control,name:"ends_at",render:({field:a})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.endsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.endsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(X,{granularity:"minute",shouldCloseOnSelect:!1,...a})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(k,{}),e.jsx(r.Field,{control:o.control,name:"rules.customer_group_id",render:({field:a})=>e.jsxs(r.Item,{children:[e.jsxs("div",{children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.customerAvailability.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(r.Control,{children:e.jsxs("div",{className:ae("bg-ui-bg-component shadow-elevation-card-rest transition-fg grid gap-1.5 rounded-xl py-1.5","aria-[invalid='true']:shadow-borders-error"),role:"application",ref:a.ref,children:[e.jsxs("div",{className:"text-ui-fg-subtle grid gap-1.5 px-1.5 md:grid-cols-2",children:[e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("priceLists.fields.customerAvailability.attribute")}),e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("operators.in")})]}),e.jsx("div",{className:"flex items-center gap-1.5 px-1.5",children:e.jsxs(F,{id:"cg",children:[e.jsx(F.Trigger,{asChild:!0,children:e.jsxs("button",{type:"button",className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover shadow-borders-base txt-compact-small text-ui-fg-muted transition-fg focus-visible:shadow-borders-interactive-with-active flex flex-1 items-center gap-x-2 rounded-md px-2 py-1.5 outline-none",children:[e.jsx(le,{}),s("priceLists.fields.customerAvailability.placeholder")]})}),e.jsx(F.Trigger,{asChild:!0,children:e.jsx(O,{variant:"secondary",children:s("actions.browse")})}),e.jsxs(F.Content,{children:[e.jsx(F.Header,{}),e.jsx(Y,{state:l,setState:u,type:"focus"})]})]})}),l.length>0?e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx(k,{variant:"dashed"}),e.jsx("div",{className:"flex flex-col gap-y-1.5 px-1.5",children:l.map((m,c)=>e.jsxs("div",{className:"bg-ui-bg-field-component shadow-borders-base flex items-center justify-between gap-2 rounded-md px-2 py-0.5",children:[e.jsx(G,{size:"small",leading:"compact",children:m.name}),e.jsx(ne,{size:"small",variant:"transparent",type:"button",onClick:()=>n(c),children:e.jsx(Ce,{})})]},m.cg_id))})]}):null]})}),e.jsx(r.ErrorMessage,{})]})})]})})},Ne=({form:o,currencies:s,regions:l,pricePreferences:n})=>{const g=E({control:o.control,name:"product_ids"}),j=E({control:o.control,name:"products"}),{products:u,isLoading:a,isError:m,error:c}=Q({id:g.map(x=>x.id),limit:g.length,fields:"title,thumbnail,*variants"}),{setValue:f}=o;T.useEffect(()=>{!a&&u&&u.forEach(x=>{j[x.id]||!x.variants||f(`products.${x.id}.variants`,{...x.variants.reduce((L,N)=>(L[N.id]={currency_prices:{},region_prices:{}},L),{})})})},[u,j,a,f]);const y=te({currencies:s,regions:l,pricePreferences:n});if(m)throw c;return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(fe,{columns:y,data:u,getSubRows:x=>{if(ue(x)&&x.variants)return x.variants},state:o})})},V=50,K="p";function Fe(o){return o.reduce((s,l)=>(s[l.id]=!0,s),{})}var Te=({form:o})=>{const{t:s}=z(),{control:l,setValue:n}=o,g=E({control:l,name:"product_ids"}),j=E({control:l,name:"products"}),[u,a]=T.useState(Fe(g)),{searchParams:m,raw:c}=xe({pageSize:V,prefix:K}),{products:f,count:y,isLoading:x,isError:L,error:N}=Q(m,{placeholderData:ce}),R=t=>{const d=typeof t=="function"?t(u):t,v=Object.keys(d),b=Object.keys(j).reduce((D,A)=>(v.includes(A)&&(D[A]=j[A]),D),{}),U=v.map(D=>({id:D}));n("product_ids",U,{shouldDirty:!0,shouldTouch:!0}),n("products",b,{shouldDirty:!0,shouldTouch:!0}),a(d)},I=Ie(),i=he(),{table:p}=be({data:f||[],columns:I,count:y,enablePagination:!0,enableRowSelection:t=>{var d;return!!((d=t.original.variants)!=null&&d.length)},getRowId:t=>t.id,rowSelection:{state:u,updater:R},pageSize:V});if(L)throw N;return e.jsx("div",{className:"flex size-full flex-col",children:e.jsx(ve,{table:p,columns:I,filters:i,pageSize:V,prefix:K,count:y,isLoading:x,layout:"fill",orderBy:["title","status","created_at","updated_at"],pagination:!0,search:!0,queryObject:c,noRecords:{message:s("priceLists.create.products.list.noRecordsMessage")}})})},Re=_e(),Ie=()=>{const o=me();return T.useMemo(()=>[Re.display({id:"select",header:({table:s})=>e.jsx($,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:l=>s.toggleAllPageRowsSelected(!!l)}),cell:({row:s})=>e.jsx($,{checked:s.getIsSelected(),disabled:!s.getCanSelect(),onCheckedChange:l=>s.toggleSelected(!!l),onClick:l=>{l.stopPropagation()}})}),...o],[o])};h.array(h.object({id:h.string(),name:h.string()}));var M=h.object({type:h.enum(["sale","override"]),status:h.enum(["draft","active"]),title:h.string().min(1),description:h.string().min(1),starts_at:h.date().nullish(),ends_at:h.date().nullish(),product_ids:h.array(h.object({id:h.string()})).min(1),products:ee,rules:se.nullish()}),W=M.pick({type:!0,title:!0,description:!0,starts_at:!0,ends_at:!0,customer_group_ids:!0}),q=Object.keys(W.shape),Z=M.pick({product_ids:!0}),J=Object.keys(Z.shape),De=M.pick({products:!0}),ke=Object.keys(De.shape),C=["detail","product","price"],Ee={detail:"in-progress",product:"not-started",price:"not-started"},Oe=({regions:o,currencies:s,pricePreferences:l})=>{const[n,g]=T.useState("detail"),[j,u]=T.useState(Ee),{t:a}=z(),{handleSuccess:m}=ye(),c=ge({defaultValues:{type:"sale",status:"active",title:"",description:"",starts_at:null,ends_at:null,product_ids:[],products:{},rules:{customer_group_id:[]}},resolver:Se(M)}),{mutateAsync:f,isPending:y}=pe(),x=c.handleSubmit(async i=>{var P;const{rules:p,products:t}=i,d=(P=p==null?void 0:p.customer_group_id)!=null&&P.length?{customer_group_id:p.customer_group_id.map(b=>b.id)}:void 0,v=de(t,o);await f({title:i.title,type:i.type,status:i.status,description:i.description,starts_at:i.starts_at?i.starts_at.toISOString():null,ends_at:i.ends_at?i.ends_at.toISOString():null,rules:d,prices:v},{onSuccess:({price_list:b})=>{B.success(a("priceLists.create.successToast",{title:b.title})),m(`../${b.id}`)},onError:b=>{B.error(b.message)}})}),L=(i,p)=>{c.clearErrors(i);const t=i.reduce((v,P)=>(v[P]=c.getValues(P),v),{}),d=p.safeParse(t);return d.success?!0:(d.error.errors.forEach(({path:v,message:P,code:b})=>{c.setError(v.join("."),{type:b,message:P})}),!1)},N=i=>{switch(i){case"detail":return q.some(t=>c.getFieldState(t).isDirty);case"product":return J.some(t=>c.getFieldState(t).isDirty);case"price":return ke.some(t=>c.getFieldState(t).isDirty)}},R=i=>{if(n===i)return;if(C.indexOf(i)<C.indexOf(n)){const t=N(n);u(d=>({...d,[n]:t?d[n]:"not-started",[i]:"in-progress"})),g(i);return}const p=C.slice(0,C.indexOf(i));for(const t of p)if(t==="detail"){if(!L(q,W)){u(d=>({...d,[t]:"in-progress"})),g(t);return}u(d=>({...d,[t]:"completed"}))}else if(t==="product"){if(!L(J,Z)){u(d=>({...d,[t]:"in-progress"})),g(t);return}u(d=>({...d,[t]:"completed"}))}u(t=>({...t,[n]:"completed",[i]:"in-progress"})),g(i)},I=i=>{if(C.indexOf(i)+1>=C.length)return;const p=C[C.indexOf(i)+1];R(p)};return e.jsx(w.Form,{form:c,children:e.jsx(S,{value:n,onValueChange:i=>R(i),className:"flex h-full flex-col overflow-hidden",children:e.jsxs("form",{onSubmit:x,className:"flex h-full flex-col",children:[e.jsx(w.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(S.List,{className:"grid w-full grid-cols-3",children:[e.jsx(S.Trigger,{status:j.detail,value:"detail",children:a("priceLists.create.tabs.details")}),e.jsx(S.Trigger,{status:j.product,value:"product",children:a("priceLists.create.tabs.products")}),e.jsx(S.Trigger,{status:j.price,value:"price",children:a("priceLists.create.tabs.prices")})]})})})}),e.jsxs(w.Body,{className:"size-full overflow-hidden",children:[e.jsx(S.Content,{className:"size-full overflow-y-auto",value:"detail",children:e.jsx(we,{form:c})}),e.jsx(S.Content,{className:"size-full overflow-y-auto",value:"product",children:e.jsx(Te,{form:c})}),e.jsx(S.Content,{className:"size-full overflow-hidden",value:"price",children:e.jsx(Ne,{form:c,regions:o,currencies:s,pricePreferences:l})})]}),e.jsx(w.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(w.Close,{asChild:!0,children:e.jsx(O,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(ze,{tab:n,next:I,isLoading:y})]})})]})})})},ze=({tab:o,next:s,isLoading:l})=>{const{t:n}=z();return o==="price"?e.jsx(O,{type:"submit",variant:"primary",size:"small",isLoading:l,children:n("actions.save")},"submit-button"):e.jsx(O,{type:"button",variant:"primary",size:"small",onClick:()=>s(o),children:n("actions.continue")},"next-button")},Vs=()=>{const{isReady:o,regions:s,currencies:l,pricePreferences:n}=re();return e.jsx(w,{children:o&&e.jsx(Oe,{regions:s,currencies:l,pricePreferences:n})})};export{Vs as Component};
