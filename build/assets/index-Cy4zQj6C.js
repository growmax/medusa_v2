import{r as n,j as x}from"./index-7A3rjJyE.js";import{M as L,u as j,P as $,a as k,L as b,i as A}from"./motion-UqVoX3oU.js";class S extends n.Component{getSnapshotBeforeUpdate(l){const e=this.props.childRef.current;if(e&&l.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=e.offsetHeight||0,s.width=e.offsetWidth||0,s.top=e.offsetTop,s.left=e.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function B({children:r,isPresent:l}){const e=n.useId(),s=n.useRef(null),h=n.useRef({width:0,height:0,top:0,left:0}),{nonce:m}=n.useContext(L);return n.useInsertionEffect(()=>{const{width:d,height:t,top:a,left:C}=h.current;if(l||!s.current||!d||!t)return;s.current.dataset.motionPopId=e;const i=document.createElement("style");return m&&(i.nonce=m),document.head.appendChild(i),i.sheet&&i.sheet.insertRule(`
          [data-motion-pop-id="${e}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${t}px !important;
            top: ${a}px !important;
            left: ${C}px !important;
          }
        `),()=>{document.head.removeChild(i)}},[l]),x.jsx(S,{isPresent:l,childRef:s,sizeRef:h,children:n.cloneElement(r,{ref:s})})}const D=({children:r,initial:l,isPresent:e,onExitComplete:s,custom:h,presenceAffectsLayout:m,mode:d})=>{const t=j(K),a=n.useId(),C=n.useMemo(()=>({id:a,initial:l,isPresent:e,custom:h,onExitComplete:i=>{t.set(i,!0);for(const c of t.values())if(!c)return;s&&s()},register:i=>(t.set(i,!1),()=>t.delete(i))}),m?[Math.random()]:[e]);return n.useMemo(()=>{t.forEach((i,c)=>t.set(c,!1))},[e]),n.useEffect(()=>{!e&&!t.size&&s&&s()},[e]),d==="popLayout"&&(r=x.jsx(B,{isPresent:e,children:r})),x.jsx($.Provider,{value:C,children:r})};function K(){return new Map}const g=r=>r.key||"";function M(r){const l=[];return n.Children.forEach(r,e=>{n.isValidElement(e)&&l.push(e)}),l}const F=({children:r,exitBeforeEnter:l,custom:e,initial:s=!0,onExitComplete:h,presenceAffectsLayout:m=!0,mode:d="sync"})=>{A(!l,"Replace exitBeforeEnter with mode='wait'");const t=n.useMemo(()=>M(r),[r]),a=t.map(g),C=n.useRef(!0),i=n.useRef(t),c=j(()=>new Map),[P,z]=n.useState(t),[f,R]=n.useState(t);k(()=>{C.current=!1,i.current=t;for(let u=0;u<f.length;u++){const o=g(f[u]);a.includes(o)?c.delete(o):c.get(o)!==!0&&c.set(o,!1)}},[f,a.length,a.join("-")]);const w=[];if(t!==P){let u=[...t];for(let o=0;o<f.length;o++){const p=f[o],E=g(p);a.includes(E)||(u.splice(o,0,p),w.push(p))}d==="wait"&&w.length&&(u=w),R(M(u)),z(t);return}d==="wait"&&f.length>1&&console.warn(`You're attempting to animate multiple children within AnimatePresence, but its mode is set to "wait". This will lead to odd visual behaviour.`);const{forceRender:y}=n.useContext(b);return x.jsx(x.Fragment,{children:f.map(u=>{const o=g(u),p=t===f||a.includes(o),E=()=>{if(c.has(o))c.set(o,!0);else return;let v=!0;c.forEach(I=>{I||(v=!1)}),v&&(y==null||y(),R(i.current),h&&h())};return x.jsx(D,{isPresent:p,initial:!C.current||s?void 0:!1,custom:p?void 0:e,presenceAffectsLayout:m,mode:d,onExitComplete:p?void 0:E,children:u},o)})})};export{F as A};
