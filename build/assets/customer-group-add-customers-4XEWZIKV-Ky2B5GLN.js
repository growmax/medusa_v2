import{u as z,a as D,b as F}from"./chunk-DJPQV344-h2lsG9Cn.js";import{v as G,j as e,u as j,r as p,t as S,x as H}from"./index-7A3rjJyE.js";import{g as B}from"./chunk-YVTBRLIE-C161Iqr5.js";import{u as I}from"./chunk-RYVWLLZ2-BlkKIhzO.js";import{u as M,D as N}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{R as n,u as O}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as L,H as V}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as $}from"./zod-DRKIF09R.js";import{o as q,a as Q,s as Z}from"./index-yuYasa5Y.js";import{B as x}from"./label-DDCdtDlT.js";import{C}from"./checkbox-BD385cy_.js";import{c as J}from"./index-DL2eSRCZ.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-B4FQDBC3-Plo6CPPz.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./format-CkWRMO1y.js";import"./chunk-ADOCJB6L-3PFdxvdK.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./x-mark-mini-Di7jARRp.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";var K=q({customer_ids:Q(Z()).min(1)}),d=10,U=({customerGroupId:r})=>{const{t:a}=j(),{handleSuccess:h}=O(),s=L({defaultValues:{customer_ids:[]},resolver:$(K)}),{setValue:o}=s,[i,u]=p.useState({});p.useEffect(()=>{o("customer_ids",Object.keys(i).filter(t=>i[t]),{shouldDirty:!0,shouldTouch:!0})},[i,o]);const{searchParams:m,raw:y}=z({pageSize:d}),b=D(),{customers:_,count:f,isLoading:v,isError:T,error:R}=I({fields:"id,email,first_name,last_name,*groups",...m}),w=t=>{const c=typeof t=="function"?t(i):t,l=Object.keys(c);o("customer_ids",l,{shouldDirty:!0,shouldTouch:!0}),u(c)},g=X(),{table:P}=M({data:_??[],columns:g,count:f,enablePagination:!0,enableRowSelection:t=>{var c;return!((c=t.original.groups)!=null&&c.map(l=>l.id).includes(r))},getRowId:t=>t.id,pageSize:d,rowSelection:{state:i,updater:w}}),{mutateAsync:A,isPending:k}=B(r),E=s.handleSubmit(async t=>{await A({customer_ids:t.customer_ids},{onSuccess:()=>{S.success(a("customerGroups.customers.add.successToast",{count:t.customer_ids.length})),h(`/customer-groups/${r}`)},onError:c=>{S.error(c.message)}})});if(T)throw R;return e.jsx(n.Form,{form:s,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:E,children:[e.jsx(n.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[s.formState.errors.customer_ids&&e.jsx(V,{variant:"error",children:s.formState.errors.customer_ids.message}),e.jsx(n.Close,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(x,{type:"submit",variant:"primary",size:"small",isLoading:k,children:a("actions.save")})]})}),e.jsx(n.Body,{className:"size-full overflow-hidden",children:e.jsx(N,{table:P,columns:g,pageSize:d,count:f,filters:b,orderBy:["email","first_name","last_name","has_account","created_at","updated_at"],isLoading:v,layout:"fill",search:!0,queryObject:y,noRecords:{message:a("customerGroups.customers.add.list.noRecordsMessage")}})})]})})},W=J(),X=()=>{const{t:r}=j(),a=F();return p.useMemo(()=>[W.display({id:"select",header:({table:s})=>e.jsx(C,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:o=>s.toggleAllPageRowsSelected(!!o)}),cell:({row:s})=>{const o=!s.getCanSelect(),i=s.getIsSelected()||o,u=e.jsx(C,{checked:i,disabled:o,onCheckedChange:m=>s.toggleSelected(!!m),onClick:m=>{m.stopPropagation()}});return o?e.jsx(H,{content:r("customerGroups.customers.alreadyAddedTooltip"),side:"right",children:u}):u}}),...a],[r,a])},ze=()=>{const{id:r}=G();return e.jsx(n,{children:e.jsx(U,{customerGroupId:r})})};export{ze as Component};
