import{v as g,$ as _,j as e,u as v,b_ as y,t as j,H as N,I as C}from"./index-7A3rjJyE.js";import{R as o,u as k}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as S,b as w,F as i}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as F}from"./zod-DRKIF09R.js";import{z as t}from"./index-yuYasa5Y.js";import{B as p}from"./label-DDCdtDlT.js";import{S as E}from"./switch-DDIyRuzh.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";var H=t.object({labels:t.array(t.object({tracking_number:t.string(),tracking_url:t.string().optional(),label_url:t.string().optional()})),send_notification:t.boolean().optional()});function M({order:a,fulfillment:c}){const{t:r}=v(),{handleSuccess:m}=k(),{mutateAsync:u,isPending:f}=y(a.id,c.id),n=S({defaultValues:{send_notification:!a.no_notification},resolver:F(H)}),{fields:d,append:x}=w({name:"labels",control:n.control}),b=n.handleSubmit(async l=>{await u({items:c.items.map(s=>({id:s.line_item_id,quantity:s.quantity})),labels:l.labels.filter(s=>!!s.tracking_number).map(s=>({tracking_number:s.tracking_number,tracking_url:"#",label_url:"#"})),no_notification:!l.send_notification},{onSuccess:()=>{j.success(r("orders.shipment.toastCreated")),m(`/orders/${a.id}`)},onError:s=>{j.error(s.message)}})});return e.jsx(o.Form,{form:n,children:e.jsxs("form",{onSubmit:b,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(o.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(o.Close,{asChild:!0,children:e.jsx(p,{size:"small",variant:"secondary",children:r("actions.cancel")})}),e.jsx(p,{size:"small",type:"submit",isLoading:f,children:r("actions.save")})]})}),e.jsx(o.Body,{className:"flex h-full w-full flex-col items-center divide-y overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsx("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(N,{className:"mb-4",children:r("orders.shipment.title")}),d.map((l,s)=>e.jsx(i.Field,{control:n.control,name:`labels.${s}.tracking_number`,render:({field:h})=>e.jsxs(i.Item,{className:"mb-4",children:[s===0&&e.jsx(i.Label,{children:r("orders.shipment.trackingNumber")}),e.jsx(i.Control,{children:e.jsx(C,{...h,placeholder:"123-456-789"})}),e.jsx(i.ErrorMessage,{})]})},l.id)),e.jsx(p,{type:"button",onClick:()=>x({tracking_number:""}),className:"self-end",variant:"secondary",children:r("orders.shipment.addTracking")})]}),e.jsx("div",{className:"mt-8 pt-8 ",children:e.jsx(i.Field,{control:n.control,name:"send_notification",render:({field:{onChange:l,value:s,...h}})=>e.jsxs(i.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i.Label,{children:r("orders.shipment.sendNotification")}),e.jsx(i.Control,{children:e.jsx(i.Control,{children:e.jsx(E,{checked:!!s,onCheckedChange:l,...h})})})]}),e.jsx(i.Hint,{className:"!mt-1",children:r("orders.shipment.sendNotificationHint")}),e.jsx(i.ErrorMessage,{})]})})})]})})})})]})})}function P(){var d;const{id:a,f_id:c}=g(),{order:r,isLoading:m,isError:u,error:f}=_(a,{fields:"*fulfillments,*fulfillments.items"});if(u)throw f;const n=!m&&r;return e.jsx(o,{children:n&&e.jsx(M,{order:r,fulfillment:(d=r.fulfillments)==null?void 0:d.find(x=>x.id===c)})})}export{P as Component};
