import{a as M}from"./chunk-KWVVOB4B-Bc14zBvB.js";import{a as z}from"./chunk-OIW3F4EQ-D8V0uZdG.js";import{C as b}from"./chunk-UY4EBCIZ-D3QWhMGG.js";import{u as E}from"./chunk-DMYZ6SLX-BMyt3Z-P.js";import{d as P,j as e,u as B,R as H,t as g,H as I,I as L,T as _}from"./index-7A3rjJyE.js";import{R as m,u as $}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as A,F as s}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{o as V,s as j,n as G}from"./index-yuYasa5Y.js";import{t as D}from"./zod-DRKIF09R.js";import{B as C}from"./label-DDCdtDlT.js";import{T as J}from"./textarea-Cvx7IHRI.js";import"./x-mark-mini-Di7jARRp.js";import"./triangles-mini-JWkpofVU.js";import"./plus-mini-BHxdUq8n.js";import"./prompt-KZNvJYzq.js";var K=V({inventory_item_id:j().min(1),location_id:j().min(1),quantity:G().min(1),description:j().optional()}),h=({title:l,value:i})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(_,{className:"px-2 py-1.5",size:"small",leading:"compact",children:l}),e.jsx(_,{className:"px-2 py-1.5",size:"small",leading:"compact",children:i})]}),O=l=>{var p,f;const{t:i}=B(),{handleSuccess:S}=$(),[R,q]=H.useState(null),n=A({defaultValues:{inventory_item_id:l.inventoryItemId||"",location_id:"",quantity:0,description:""},resolver:D(K)}),{inventory_items:u}=E({q:R}),x=n.watch("inventory_item_id"),a=u==null?void 0:u.find(t=>t.id===x),v=n.watch("location_id"),d=(p=a==null?void 0:a.location_levels)==null?void 0:p.find(t=>t.location_id===v),w=n.watch("quantity"),{stock_locations:F}=z({id:((f=a==null?void 0:a.location_levels)==null?void 0:f.map(t=>t.location_id))??[]},{enabled:!!a}),{mutateAsync:T,isPending:N}=M(),k=n.handleSubmit(async t=>{await T(t,{onSuccess:({reservation:o})=>{g.success(i("inventory.reservation.successToast")),S(l.inventoryItemId?`/inventory/${l.inventoryItemId}`:`/reservations/${o.id}`)},onError:o=>{g.error(o.message)}})});return e.jsx(m.Form,{form:n,children:e.jsxs("form",{onSubmit:k,children:[e.jsx(m.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(C,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(C,{type:"submit",variant:"primary",size:"small",isLoading:N,children:i("actions.create")})]})}),e.jsx(m.Body,{className:"flex flex-col items-center pt-[72px]",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(I,{children:i("inventory.reservation.create")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(s.Field,{control:n.control,name:"inventory_item_id",render:({field:{value:t,onChange:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("inventory.reservation.itemToReserve")}),e.jsx(s.Control,{children:e.jsx(b,{onSearchValueChange:r=>q(r),value:t,onChange:r=>{o(r)},...c,disabled:!!l.inventoryItemId,options:(u??[]).map(r=>({label:r.title??r.sku,value:r.id}))})})]})},"inventory_item_id"),e.jsx(s.Field,{control:n.control,name:"location_id",render:({field:{value:t,onChange:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.location")}),e.jsx(s.Control,{children:e.jsx(b,{value:t,onChange:r=>{o(r)},...c,disabled:!x,options:(F??[]).map(r=>({label:r.name,value:r.id}))})})]})},"location_id")]}),e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(h,{title:i("fields.title"),value:(a==null?void 0:a.title)??(a==null?void 0:a.sku)??"-"}),e.jsx(h,{title:i("fields.sku"),value:(a==null?void 0:a.sku)??"-"}),e.jsx(h,{title:i("fields.inStock"),value:(d==null?void 0:d.stocked_quantity)??"-"}),e.jsx(h,{title:i("inventory.available"),value:d?d.available_quantity-(w||0):"-"})]}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(s.Field,{control:n.control,name:"quantity",render:({field:{onChange:t,value:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:i("fields.quantity")}),e.jsx(s.Control,{children:e.jsx(L,{type:"number",placeholder:i("inventory.reservation.quantityPlaceholder"),min:1,max:d?d.available_quantity:0,value:o||"",onChange:r=>{const y=r.target.value;t(y===""?null:parseFloat(y))},...c,disabled:!x||!v})}),e.jsx(s.ErrorMessage,{})]})})}),e.jsx(s.Field,{control:n.control,name:"description",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:i("fields.description")}),e.jsx(s.Control,{children:e.jsx(J,{...t,disabled:!x||!v,placeholder:i("inventory.reservation.descriptionPlaceholder")})}),e.jsx(s.ErrorMessage,{})]})})]})})]})})},de=()=>{const[l]=P(),i=l.get("item_id");return e.jsx(m,{children:e.jsx(O,{inventoryItemId:i})})};export{de as Component};
