import{u as _,a as A,b as E}from"./chunk-APWN266K-BhXvr4m7.js";import{S as I}from"./chunk-FGHVNTU2-HfmduO2_.js";import"./chunk-3IW4HYUP-C89ww9p0.js";import{v as Q,h as L,j as e,cj as M,q as f,u as S,b as B,C as b,H as T,T as d,r as P,k as K,ay as a,L as O,s as H,t as p,p as F}from"./index-7A3rjJyE.js";import{u as $,c as J,a as Y}from"./chunk-YVTBRLIE-C161Iqr5.js";import{b as Z,d as U}from"./chunk-RYVWLLZ2-BlkKIhzO.js";import{A as k}from"./chunk-WRXTMI2J-CygmDunM.js";import{u as V,D as W}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{p as X}from"./chunk-YBHG7T6S-BleHOTgO.js";import{P as G}from"./pencil-square-mUSTT5rR.js";import{T as R}from"./trash-C_lucST6.js";import{u as y}from"./use-prompt-iL3FbEo4.js";import{S as ee}from"./status-badge-BK5p0WUV.js";import{B as se}from"./label-DDCdtDlT.js";import{C}from"./checkbox-BD385cy_.js";import{c as te}from"./index-DL2eSRCZ.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-IQRVIEMV-JX6w9umB.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./arrow-up-right-on-box-CF7GLQ-o.js";import"./Trans-Cyi6soNY.js";import"./x-mark-mini-Di7jARRp.js";import"./triangle-down-mini-BHNqpDM0.js";import"./square-two-stack-Ao9P_yLE.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./chunk-DMYZ6SLX-BMyt3Z-P.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";const re={widgets:[]},oe={widgets:[]};var ae=({customer:s})=>{const{t}=S(),r=y(),o=B(),{mutateAsync:i}=U(s.id),n=[s.first_name,s.last_name].filter(Boolean).join(" "),c=s.has_account?"green":"orange",m=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),g=async()=>{await r({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i(void 0,{onSuccess:()=>{p.success(t("customers.delete.successToast",{email:s.email})),o("/customers",{replace:!0})},onError:x=>{p.error(x.message)}})};return e.jsxs(b,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(ee,{color:c,children:m}),e.jsx(k,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(G,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(R,{}),onClick:g}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(d,{size:"small",leading:"compact",children:n||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(d,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(d,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},h=10,ie=({customer:s})=>{const t=y(),[r,o]=P.useState({}),{raw:i,searchParams:n}=_({pageSize:h}),{customer_groups:c,count:m,isLoading:g,isError:j,error:x}=$({...n,fields:"+customers.id",customers:{id:s.id}},{placeholderData:K}),D=A(),v=ce(s.id),{table:N}=V({data:c??[],columns:v,count:m,getRowId:u=>u.id,enablePagination:!0,enableRowSelection:!0,pageSize:h,rowSelection:{state:r,updater:o}}),z=async()=>{const u=Object.keys(r);if(await t({title:a("general.areYouSure"),description:a("customers.groups.removeMany",{groups:c==null?void 0:c.filter(l=>u.includes(l.id)).map(l=>l.name).join(",")}),confirmText:a("actions.remove"),cancelText:a("actions.cancel")}))try{const l=u.map(q=>F.customerGroups.removeCustomers(q,{customer_ids:[s.id]}));await Promise.all(l),await f.invalidateQueries({queryKey:J.lists()})}catch(l){p.error(l.message)}};if(j)throw x;return e.jsxs(b,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{level:"h2",children:a("customerGroups.domain")}),e.jsx(O,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(se,{variant:"secondary",size:"small",children:a("general.add")})})]}),e.jsx(W,{table:N,columns:v,pageSize:h,isLoading:g,count:m,navigateTo:u=>`/customer-groups/${u.id}`,filters:D,search:!0,pagination:!0,orderBy:["name","created_at","updated_at"],commands:[{action:z,label:a("actions.remove"),shortcut:"r"}],queryObject:i,noRecords:{message:a("customers.groups.list.noRecordsMessage")}})]})},ne=({group:s,customerId:t})=>{const r=y(),{t:o}=S(),{mutateAsync:i}=Y(s.id),n=async()=>{await r({title:o("general.areYouSure"),description:o("customers.groups.remove",{name:s.name}),confirmText:o("actions.remove"),cancelText:o("actions.cancel")})&&await i({customer_ids:[t]},{onError:m=>{p.error(m.message)}})};return e.jsx(k,{groups:[{actions:[{label:o("actions.edit"),icon:e.jsx(G,{}),to:`/customer-groups/${s.id}/edit`},{label:o("actions.remove"),onClick:n,icon:e.jsx(R,{})}]}]})},w=te(),ce=s=>{const t=E();return P.useMemo(()=>[w.display({id:"select",header:({table:r})=>e.jsx(C,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:o=>r.toggleAllPageRowsSelected(!!o)}),cell:({row:r})=>e.jsx(C,{checked:r.getIsSelected(),onCheckedChange:o=>r.toggleSelected(!!o),onClick:o=>{o.stopPropagation()}})}),...t,w.display({id:"actions",cell:({row:r})=>e.jsx(ne,{group:r.original,customerId:s})})],[t])},We=()=>{const{id:s}=Q(),t=L(),{customer:r,isLoading:o,isError:i,error:n}=Z(s,void 0,{initialData:t});if(o||!r)return e.jsx(M,{sections:2,showJSON:!0,showMetadata:!0});if(i)throw n;return e.jsxs(I,{widgets:{before:oe,after:re},data:r,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(ae,{customer:r}),e.jsx(ie,{customer:r})]})},le=s=>({queryKey:X.detail(s),queryFn:async()=>H.admin.customer.retrieve(s)}),Xe=async({params:s})=>{const t=s.id,r=le(t);return f.getQueryData(r.queryKey)??await f.fetchQuery(r)};export{We as Component,Xe as loader};
