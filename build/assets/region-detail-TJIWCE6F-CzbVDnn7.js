import{u as D,a as N,b as q}from"./chunk-NOAFLTPV-CWOM6qcu.js";import{L}from"./chunk-I3VB6NM2-KfRd9ms0.js";import{f as z}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{S as f}from"./chunk-ULQT3HE4-DTXseesA.js";import{J as Q}from"./chunk-3IW4HYUP-C89ww9p0.js";import{A as h}from"./chunk-WRXTMI2J-CygmDunM.js";import{c as H}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{c as O,r as B,d as _,a as K}from"./chunk-QHCOJC4V-B0yC0oe2.js";import{q as w,h as M,v as W,o as Y,j as s,O as G,s as J,u as v,r as P,C as R,H as E,B as U,T as F,b as V,t as d}from"./index-7A3rjJyE.js";import{u as X,D as Z}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{P as $}from"./plus-mini-BHxdUq8n.js";import{P as ee}from"./pencil-square-mUSTT5rR.js";import{T as k}from"./trash-C_lucST6.js";import{u as C}from"./use-prompt-iL3FbEo4.js";import{C as b}from"./checkbox-BD385cy_.js";import{c as se}from"./index-DL2eSRCZ.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./arrow-up-right-on-box-CF7GLQ-o.js";import"./Trans-Cyi6soNY.js";import"./x-mark-mini-Di7jARRp.js";import"./triangle-down-mini-BHNqpDM0.js";import"./square-two-stack-Ao9P_yLE.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./label-DDCdtDlT.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";const te={widgets:[]},re={widgets:[]};var ie=r=>({queryKey:B.detail(r),queryFn:async()=>J.admin.region.retrieve(r,{fields:"*payment_providers"})}),Fe=async({params:r})=>{const t=r.id,e=ie(t);return w.getQueryData(e.queryKey)??await w.fetchQuery(e)},y="c",j=10,oe=({region:r})=>{const{t}=v(),e=C(),[i,a]=P.useState({}),{searchParams:o,raw:m}=D({pageSize:j,prefix:y}),{countries:c,count:n}=N({countries:r.countries||[],...o}),u=ne(),{table:p}=X({data:c||[],columns:u,count:n,enablePagination:!0,enableRowSelection:!0,getRowId:x=>x.iso_2,pageSize:j,rowSelection:{state:i,updater:a},prefix:y,meta:{region:r}}),{mutateAsync:g}=_(r.id),A=async()=>{var S;const x=Object.keys(i).filter(l=>i[l]);if(!await e({title:t("general.areYouSure"),description:t("regions.removeCountriesWarning",{count:x.length}),verificationText:t("actions.remove"),verificationInstruction:t("general.typeToConfirm"),cancelText:t("actions.cancel"),confirmText:t("actions.remove")}))return;const I=(S=r.countries)==null?void 0:S.filter(l=>!x.includes(l.iso_2)).map(l=>l.iso_2);await g({countries:I},{onSuccess:()=>{d.success(t("regions.toast.countries"))},onError:l=>{d.error(l.message)}})};return s.jsxs(R,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(E,{level:"h2",children:t("fields.countries")}),s.jsx(h,{groups:[{actions:[{label:t("regions.addCountries"),icon:s.jsx($,{}),to:"countries/add"}]}]})]}),s.jsx(Z,{table:p,columns:u,pageSize:j,count:n,orderBy:["name","code"],search:!0,pagination:!0,queryObject:m,prefix:y,commands:[{action:A,label:t("actions.remove"),shortcut:"r"}]})]})},ae=({country:r,region:t})=>{var c;const{t:e}=v(),i=C(),{mutateAsync:a}=_(t.id),o=(c=t.countries)==null?void 0:c.filter(n=>n.iso_2!==r.iso_2).map(n=>n.iso_2),m=async()=>{await i({title:e("general.areYouSure"),description:e("regions.removeCountryWarning",{name:r.display_name}),verificationText:r.display_name,verificationInstruction:e("general.typeToConfirm"),cancelText:e("actions.cancel"),confirmText:e("actions.remove")})&&await a({countries:o},{onSuccess:()=>{d.success(e("regions.toast.countries"))},onError:u=>{d.error(u.message)}})};return s.jsx(h,{groups:[{actions:[{label:e("actions.remove"),onClick:m,icon:s.jsx(k,{})}]}]})},T=se(),ne=()=>{const r=q();return P.useMemo(()=>[T.display({id:"select",header:({table:t})=>s.jsx(b,{checked:t.getIsSomePageRowsSelected()?"indeterminate":t.getIsAllPageRowsSelected(),onCheckedChange:e=>t.toggleAllPageRowsSelected(!!e)}),cell:({row:t})=>s.jsx(b,{checked:t.getIsSelected(),onCheckedChange:e=>t.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...r,T.display({id:"actions",cell:({row:t,table:e})=>{const{region:i}=e.options.meta;return s.jsx(ae,{country:t.original,region:i})}})],[r])},ce=({region:r,pricePreferences:t})=>{var a;const{t:e}=v(),i=t==null?void 0:t.find(o=>o.attribute==="region_id"&&o.value===r.id);return s.jsxs(R,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(E,{children:r.name}),s.jsx(le,{region:r})]}),s.jsx(f,{title:e("fields.currency"),value:s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(U,{size:"2xsmall",className:"uppercase",children:r.currency_code}),s.jsx(F,{size:"small",leading:"compact",children:H[r.currency_code.toUpperCase()].name})]})}),s.jsx(f,{title:e("fields.automaticTaxes"),value:r.automatic_taxes?e("fields.true"):e("fields.false")}),s.jsx(f,{title:e("fields.taxInclusivePricing"),value:i!=null&&i.is_tax_inclusive?e("fields.true"):e("fields.false")}),s.jsx(f,{title:e("fields.paymentProviders"),value:s.jsx("div",{className:"inline-flex",children:(a=r.payment_providers)!=null&&a.length?s.jsx(L,{list:r.payment_providers.map(o=>z(o.id))}):"-"})})]})},le=({region:r})=>{const t=V(),{t:e}=v(),{mutateAsync:i}=K(r.id),a=C(),o=async()=>{await a({title:e("general.areYouSure"),description:e("regions.deleteRegionWarning",{name:r.name}),verificationText:r.name,verificationInstruction:e("general.typeToConfirm"),confirmText:e("actions.delete"),cancelText:e("actions.cancel")})&&await i(void 0,{onSuccess:()=>{d.success(e("regions.toast.delete")),t("/settings/regions",{replace:!0})},onError:c=>{d.error(c.message)}})};return s.jsx(h,{groups:[{actions:[{icon:s.jsx(ee,{}),label:e("actions.edit"),to:`/settings/regions/${r.id}/edit`}]},{actions:[{icon:s.jsx(k,{}),label:e("actions.delete"),onClick:o}]}]})},Ve=()=>{const r=M(),{id:t}=W(),{region:e,isPending:i,isError:a,error:o}=O(t,{fields:"*payment_providers,*countries"},{initialData:r}),{price_preferences:m,isPending:c,isError:n,error:u}=Y({attribute:"region_id",value:t},{enabled:!!e});if(i||c||!e)return s.jsx("div",{children:"Loading..."});if(a)throw o;if(n)throw u;return s.jsxs("div",{className:"flex flex-col gap-y-2",children:[re.widgets.map((p,g)=>s.jsx("div",{children:s.jsx(p.Component,{data:e})},g)),s.jsx(ce,{region:e,pricePreferences:m??[]}),s.jsx(oe,{region:e}),te.widgets.map((p,g)=>s.jsx("div",{children:s.jsx(p.Component,{data:e})},g)),s.jsx(Q,{data:e}),s.jsx(G,{})]})};export{Ve as Component,Fe as loader};
