import{u as X,l as de}from"./lodash-8s6kkRaG.js";import{u as ke}from"./chunk-QAF7PVQE-exoP4XGT.js";import{u as Pe,R as V,T as $,P as K,C as U}from"./chunk-M566SHKI-Cmdx6k9x.js";import{P as Me,r as u,ap as Q,j as e,aq as G,ar as pe,as as Ae,at as q,au as k,av as Le,aw as ze,R as M,ab as le,u as A,d as me,g as R,ax as W,ay as te,T as E,I as H,az as z,z as Ge}from"./index-7A3rjJyE.js";import{c as Ve}from"./_baseIsEqual-D9C7gzzJ.js";import{D as ce}from"./date-picker-foikjjE_.js";import{X as B}from"./x-mark-mini-Di7jARRp.js";import{B as $e,L as Y}from"./label-DDCdtDlT.js";var Ke=Ve;function Ue(t,s){return Ke(t,s)}var qe=Ue;const Be=Me(qe);var fe=u.createContext(null),J=()=>{const t=u.useContext(fe);if(!t)throw new Error("useDataTableFacetedFilterContext must be used within a DataTableFacetedFilter");return t},Je=({filter:t,prefix:s,readonly:n,openOnMount:l})=>{const[i,r]=u.useState(l),[c,d]=u.useState(!1),{getFullDate:p}=ke(),{key:m,label:f}=t,{removeFilter:g}=J(),x=X({param:m,prefix:s}),h=Ye(),a=b=>{x.add(JSON.stringify(b)),d(!1)},o=()=>{x.delete(),d(b=>!b)},j=x.get(),v=We(j),w=ue(v,"$gte"),I=ue(v,"$lte"),O=(b,_)=>{const ie=_==="start"?"$gte":"$lte",ee=b?b.toISOString():void 0;x.add(JSON.stringify({...v||{},[ie]:ee}))},F=()=>{const b=h.find(_=>Be(_.value,v));return b==null?void 0:b.label},C=b=>b?p({date:b}):void 0,T=()=>[w,I].map(C).filter(Boolean).join(" - "),N=F()||T(),y=()=>{x.delete(),g(m)};let S=null;const D=b=>{r(b),S&&clearTimeout(S),!b&&!j.length&&(S=setTimeout(()=>{g(m)},200))};return e.jsxs(V,{modal:!0,open:i,onOpenChange:D,children:[e.jsx(He,{label:f,value:N,onRemove:y,readonly:n}),!n&&e.jsx(K,{children:e.jsxs(U,{"data-name":"date_filter_content",align:"start",sideOffset:8,collisionPadding:24,className:R("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout h-full max-h-[var(--radix-popper-available-height)] w-[300px] overflow-auto rounded-lg"),onInteractOutside:b=>{var _;b.target instanceof HTMLElement&&((_=b.target.attributes.getNamedItem("data-name"))==null?void 0:_.value)==="filters_menu_content"&&b.preventDefault()},children:[e.jsxs("ul",{className:"w-full p-1",children:[h.map(b=>{const _=x.get().includes(JSON.stringify(b.value));return e.jsx("li",{children:e.jsxs("button",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex w-full cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",type:"button",onClick:()=>{a(b.value)},children:[e.jsx("div",{className:R("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!_}),children:e.jsx(W,{})}),b.label]})},b.label)}),e.jsx("li",{children:e.jsxs("button",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex w-full cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",type:"button",onClick:o,children:[e.jsx("div",{className:R("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!c}),children:e.jsx(W,{})}),te("filters.date.custom")]})})]}),c&&e.jsxs("div",{className:"border-t px-1 pb-3 pt-1",children:[e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1",children:e.jsx(E,{size:"xsmall",leading:"compact",weight:"plus",children:te("filters.date.from")})}),e.jsx("div",{className:"px-2 py-1",children:e.jsx(ce,{maxValue:I,value:w,onChange:b=>O(b,"start")})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1",children:e.jsx(E,{size:"xsmall",leading:"compact",weight:"plus",children:te("filters.date.to")})}),e.jsx("div",{className:"px-2 py-1",children:e.jsx(ce,{minValue:w,value:I||void 0,onChange:b=>{O(b,"end")}})})]})]})]})})]})},He=({label:t,value:s,readonly:n,onRemove:l})=>{const i=r=>{r.stopPropagation(),l()};return e.jsx($,{asChild:!0,className:R("bg-ui-bg-field transition-fg shadow-borders-base text-ui-fg-subtle flex cursor-pointer select-none items-center rounded-md",{"hover:bg-ui-bg-field-hover":!n,"data-[state=open]:bg-ui-bg-field-hover":!n}),children:e.jsxs("div",{children:[e.jsx("div",{className:R("flex items-center justify-center px-2 py-1",{"border-r":!!s}),children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",children:t})}),s&&e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",children:s})},s)}),!n&&s&&e.jsx("div",{children:e.jsx("button",{onClick:i,className:R("text-ui-fg-muted transition-fg flex items-center justify-center p-1","hover:bg-ui-bg-subtle-hover","active:bg-ui-bg-subtle-pressed active:text-ui-fg-base"),children:e.jsx(B,{})})})]})})},L=new Date;L.setHours(0,0,0,0);var Ye=()=>{const{t}=A();return u.useMemo(()=>[{label:t("filters.date.today"),value:{$gte:L.toISOString()}},{label:t("filters.date.lastSevenDays"),value:{$gte:new Date(L.getTime()-7*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastThirtyDays"),value:{$gte:new Date(L.getTime()-30*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastNinetyDays"),value:{$gte:new Date(L.getTime()-90*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastTwelveMonths"),value:{$gte:new Date(L.getTime()-365*24*60*60*1e3).toISOString()}}],[t])},We=t=>t!=null&&t.length?JSON.parse(t.join(",")):null,ue=(t,s)=>t!=null&&t[s]?new Date(t[s]):void 0;function Xe(t){const s=t+"CollectionProvider",[n,l]=Q(s),[i,r]=n(s,{collectionRef:{current:null},itemMap:new Map}),c=h=>{const{scope:a,children:o}=h,j=M.useRef(null),v=M.useRef(new Map).current;return e.jsx(i,{scope:a,itemMap:v,collectionRef:j,children:o})};c.displayName=s;const d=t+"CollectionSlot",p=M.forwardRef((h,a)=>{const{scope:o,children:j}=h,v=r(d,o),w=G(a,v.collectionRef);return e.jsx(le,{ref:w,children:j})});p.displayName=d;const m=t+"CollectionItemSlot",f="data-radix-collection-item",g=M.forwardRef((h,a)=>{const{scope:o,children:j,...v}=h,w=M.useRef(null),I=G(a,w),O=r(m,o);return M.useEffect(()=>(O.itemMap.set(w,{ref:w,...v}),()=>void O.itemMap.delete(w))),e.jsx(le,{[f]:"",ref:I,children:j})});g.displayName=m;function x(h){const a=r(t+"CollectionConsumer",h);return M.useCallback(()=>{const j=a.collectionRef.current;if(!j)return[];const v=Array.from(j.querySelectorAll(`[${f}]`));return Array.from(a.itemMap.values()).sort((O,F)=>v.indexOf(O.ref.current)-v.indexOf(F.ref.current))},[a.collectionRef,a.itemMap])}return[{Provider:c,Slot:p,ItemSlot:g},x,l]}var Qe=u.createContext(void 0);function ge(t){const s=u.useContext(Qe);return t||s||"ltr"}var se="rovingFocusGroup.onEntryFocus",Ze={bubbles:!1,cancelable:!0},Z="RovingFocusGroup",[ae,he,et]=Xe(Z),[tt,xe]=Q(Z,[et]),[st,nt]=tt(Z),be=u.forwardRef((t,s)=>e.jsx(ae.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ae.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(at,{...t,ref:s})})}));be.displayName=Z;var at=u.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:n,orientation:l,loop:i=!1,dir:r,currentTabStopId:c,defaultCurrentTabStopId:d,onCurrentTabStopIdChange:p,onEntryFocus:m,preventScrollOnEntryFocus:f=!1,...g}=t,x=u.useRef(null),h=G(s,x),a=ge(r),[o=null,j]=pe({prop:c,defaultProp:d,onChange:p}),[v,w]=u.useState(!1),I=Ae(m),O=he(n),F=u.useRef(!1),[C,T]=u.useState(0);return u.useEffect(()=>{const N=x.current;if(N)return N.addEventListener(se,I),()=>N.removeEventListener(se,I)},[I]),e.jsx(st,{scope:n,orientation:l,dir:a,loop:i,currentTabStopId:o,onItemFocus:u.useCallback(N=>j(N),[j]),onItemShiftTab:u.useCallback(()=>w(!0),[]),onFocusableItemAdd:u.useCallback(()=>T(N=>N+1),[]),onFocusableItemRemove:u.useCallback(()=>T(N=>N-1),[]),children:e.jsx(q.div,{tabIndex:v||C===0?-1:0,"data-orientation":l,...g,ref:h,style:{outline:"none",...t.style},onMouseDown:k(t.onMouseDown,()=>{F.current=!0}),onFocus:k(t.onFocus,N=>{const y=!F.current;if(N.target===N.currentTarget&&y&&!v){const S=new CustomEvent(se,Ze);if(N.currentTarget.dispatchEvent(S),!S.defaultPrevented){const D=O().filter(P=>P.focusable),b=D.find(P=>P.active),_=D.find(P=>P.id===o),ee=[b,_,...D].filter(Boolean).map(P=>P.ref.current);we(ee,f)}}F.current=!1}),onBlur:k(t.onBlur,()=>w(!1))})})}),ve="RovingFocusGroupItem",je=u.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:n,focusable:l=!0,active:i=!1,tabStopId:r,...c}=t,d=Le(),p=r||d,m=nt(ve,n),f=m.currentTabStopId===p,g=he(n),{onFocusableItemAdd:x,onFocusableItemRemove:h}=m;return u.useEffect(()=>{if(l)return x(),()=>h()},[l,x,h]),e.jsx(ae.ItemSlot,{scope:n,id:p,focusable:l,active:i,children:e.jsx(q.span,{tabIndex:f?0:-1,"data-orientation":m.orientation,...c,ref:s,onMouseDown:k(t.onMouseDown,a=>{l?m.onItemFocus(p):a.preventDefault()}),onFocus:k(t.onFocus,()=>m.onItemFocus(p)),onKeyDown:k(t.onKeyDown,a=>{if(a.key==="Tab"&&a.shiftKey){m.onItemShiftTab();return}if(a.target!==a.currentTarget)return;const o=it(a,m.orientation,m.dir);if(o!==void 0){if(a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)return;a.preventDefault();let v=g().filter(w=>w.focusable).map(w=>w.ref.current);if(o==="last")v.reverse();else if(o==="prev"||o==="next"){o==="prev"&&v.reverse();const w=v.indexOf(a.currentTarget);v=m.loop?lt(v,w+1):v.slice(w+1)}setTimeout(()=>we(v))}})})})});je.displayName=ve;var ot={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function rt(t,s){return s!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function it(t,s,n){const l=rt(t.key,n);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return ot[l]}function we(t,s=!1){const n=document.activeElement;for(const l of t)if(l===n||(l.focus({preventScroll:s}),document.activeElement!==n))return}function lt(t,s){return t.map((n,l)=>t[(s+l)%t.length])}var ct=be,ut=je;function dt(t){const s=u.useRef({value:t,previous:t});return u.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var oe="Radio",[pt,ye]=Q(oe),[mt,ft]=pt(oe),Ce=u.forwardRef((t,s)=>{const{__scopeRadio:n,name:l,checked:i=!1,required:r,disabled:c,value:d="on",onCheck:p,...m}=t,[f,g]=u.useState(null),x=G(s,o=>g(o)),h=u.useRef(!1),a=f?!!f.closest("form"):!0;return e.jsxs(mt,{scope:n,checked:i,disabled:c,children:[e.jsx(q.button,{type:"button",role:"radio","aria-checked":i,"data-state":Se(i),"data-disabled":c?"":void 0,disabled:c,value:d,...m,ref:x,onClick:k(t.onClick,o=>{i||p==null||p(),a&&(h.current=o.isPropagationStopped(),h.current||o.stopPropagation())})}),a&&e.jsx(gt,{control:f,bubbles:!h.current,name:l,value:d,checked:i,required:r,disabled:c,style:{transform:"translateX(-100%)"}})]})});Ce.displayName=oe;var Ne="RadioIndicator",Re=u.forwardRef((t,s)=>{const{__scopeRadio:n,forceMount:l,...i}=t,r=ft(Ne,n);return e.jsx(ze,{present:l||r.checked,children:e.jsx(q.span,{"data-state":Se(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:s})})});Re.displayName=Ne;var gt=t=>{const{control:s,checked:n,bubbles:l=!0,...i}=t,r=u.useRef(null),c=dt(n),d=Pe(s);return u.useEffect(()=>{const p=r.current,m=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(m,"checked").set;if(c!==n&&g){const x=new Event("click",{bubbles:l});g.call(p,n),p.dispatchEvent(x)}},[c,n,l]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:n,...i,tabIndex:-1,ref:r,style:{...t.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Se(t){return t?"checked":"unchecked"}var ht=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],re="RadioGroup",[xt,Vt]=Q(re,[xe,ye]),Ie=xe(),Oe=ye(),[bt,vt]=xt(re),Fe=u.forwardRef((t,s)=>{const{__scopeRadioGroup:n,name:l,defaultValue:i,value:r,required:c=!1,disabled:d=!1,orientation:p,dir:m,loop:f=!0,onValueChange:g,...x}=t,h=Ie(n),a=ge(m),[o,j]=pe({prop:r,defaultProp:i,onChange:g});return e.jsx(bt,{scope:n,name:l,required:c,disabled:d,value:o,onValueChange:j,children:e.jsx(ct,{asChild:!0,...h,orientation:p,dir:a,loop:f,children:e.jsx(q.div,{role:"radiogroup","aria-required":c,"aria-orientation":p,"data-disabled":d?"":void 0,dir:a,...x,ref:s})})})});Fe.displayName=re;var Ee="RadioGroupItem",Te=u.forwardRef((t,s)=>{const{__scopeRadioGroup:n,disabled:l,...i}=t,r=vt(Ee,n),c=r.disabled||l,d=Ie(n),p=Oe(n),m=u.useRef(null),f=G(s,m),g=r.value===i.value,x=u.useRef(!1);return u.useEffect(()=>{const h=o=>{ht.includes(o.key)&&(x.current=!0)},a=()=>x.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",a),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",a)}},[]),e.jsx(ut,{asChild:!0,...d,focusable:!c,active:g,children:e.jsx(Ce,{disabled:c,required:r.required,checked:g,...p,...i,name:r.name,ref:f,onCheck:()=>r.onValueChange(i.value),onKeyDown:k(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:k(i.onFocus,()=>{var h;x.current&&((h=m.current)==null||h.click())})})})});Te.displayName=Ee;var jt="RadioGroupIndicator",_e=u.forwardRef((t,s)=>{const{__scopeRadioGroup:n,...l}=t,i=Oe(n);return e.jsx(Re,{...i,...l,ref:s})});_e.displayName=jt;var wt=Fe,yt=Te,Ct=_e,Nt=({filter:t,prefix:s,readonly:n,openOnMount:l})=>{const{t:i}=A(),[r,c]=u.useState(l),{key:d,label:p}=t,{removeFilter:m}=J(),f=X({param:d,prefix:s,multiple:!1}),g=f.get(),[x,h]=u.useState(St(g)),a=u.useCallback(de.debounce((C,T)=>{const N=C.target.value,y=JSON.parse((g==null?void 0:g.join(","))||"{}"),S=!isNaN(Number(y)),D=b=>{if(!N&&S){f.delete();return}if(y&&!N){delete y[b],f.add(JSON.stringify(y));return}if(!y){f.add(JSON.stringify({[b]:N}));return}f.add(JSON.stringify({...y,[b]:N}))};switch(T){case"eq":N?f.add(N):f.delete();break;case"lt":case"gt":D(T);break}},500),[f,g]);u.useEffect(()=>()=>{a.cancel()},[a]);let o=null;const j=C=>{c(C),o&&clearTimeout(o),!C&&!g.length&&(o=setTimeout(()=>{m(d)},200))},v=()=>{f.delete(),m(d)},w=[{operator:"exact",label:i("filters.compare.exact")},{operator:"range",label:i("filters.compare.range")}],I=`${d}-gt`,O=`${d}-lt`,F=d;return e.jsxs(V,{modal:!0,open:r,onOpenChange:j,children:[e.jsx(Rt,{label:p,value:g,onRemove:v,readonly:n}),!n&&e.jsx(K,{children:e.jsxs(U,{"data-name":"number_filter_content",align:"start",sideOffset:8,collisionPadding:24,className:R("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout max-h-[var(--radix-popper-available-height)] w-[300px] divide-y overflow-y-auto rounded-lg outline-none"),onInteractOutside:C=>{var T;C.target instanceof HTMLElement&&((T=C.target.attributes.getNamedItem("data-name"))==null?void 0:T.value)==="filters_menu_content"&&C.preventDefault()},children:[e.jsx("div",{className:"p-1",children:e.jsx(wt,{value:x,onValueChange:C=>h(C),className:"flex flex-col items-start",orientation:"vertical",autoFocus:!0,children:w.map(C=>e.jsxs(yt,{value:C.operator,className:"txt-compact-small hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed transition-fg grid w-full grid-cols-[20px_1fr] gap-2 rounded-[4px] px-2 py-1.5 text-left outline-none",children:[e.jsx("div",{className:"size-5",children:e.jsx(Ct,{children:e.jsx(W,{})})}),e.jsx("span",{className:"w-full",children:C.label})]},C.operator))})}),e.jsx("div",{children:x==="range"?e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(Y,{size:"xsmall",weight:"plus",htmlFor:I,children:i("filters.compare.greaterThan")})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(H,{name:I,size:"small",type:"number",defaultValue:ne(g,"gt"),onChange:C=>a(C,"gt")})}),e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(Y,{size:"xsmall",weight:"plus",htmlFor:O,children:i("filters.compare.lessThan")})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(H,{name:O,size:"small",type:"number",defaultValue:ne(g,"lt"),onChange:C=>a(C,"lt")})})]},"range"):e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(Y,{size:"xsmall",weight:"plus",htmlFor:F,children:p})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(H,{name:F,size:"small",type:"number",defaultValue:ne(g,"eq"),onChange:C=>a(C,"eq")})})]},"exact")})]})})]})},Rt=({label:t,value:s,readonly:n,onRemove:l})=>{const{t:i}=A(),r=p=>{p.stopPropagation(),l()},c=JSON.parse((s==null?void 0:s.join(","))||"{}");let d="";if(typeof c=="object"){const p=[];c.gt&&p.push(i("filters.compare.greaterThanLabel",{value:c.gt})),c.lt&&p.push(i("filters.compare.lessThanLabel",{value:c.lt})),d=p.join(` ${i("filters.compare.andLabel")} `)}return typeof c=="number"&&(d=c.toString()),e.jsx($,{asChild:!0,className:R("bg-ui-bg-field transition-fg shadow-borders-base text-ui-fg-subtle flex cursor-pointer select-none items-center rounded-md",{"hover:bg-ui-bg-field-hover":!n,"data-[state=open]:bg-ui-bg-field-hover":!n}),children:e.jsxs("div",{children:[e.jsx("div",{className:R("flex items-center justify-center px-2 py-1",{"border-r":!!s}),children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",children:t})}),!!s&&e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",className:"text-ui-fg-muted",children:i("general.is")})}),s&&e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",children:d})})}),!n&&s&&e.jsx("div",{children:e.jsx("button",{onClick:r,className:R("text-ui-fg-muted transition-fg flex items-center justify-center p-1","hover:bg-ui-bg-subtle-hover","active:bg-ui-bg-subtle-pressed active:text-ui-fg-base"),children:e.jsx(B,{})})})]})})},De=t=>{if(!t)return;const s=t.join(",");if(s)return JSON.parse(s)},ne=(t,s)=>{const n=De(t);if(typeof n=="object")return n[s];if(typeof n=="number"&&s==="eq")return n},St=t=>typeof De(t)=="object"?"range":"exact",It=({filter:t,prefix:s,readonly:n,multiple:l,searchable:i,options:r,openOnMount:c})=>{const[d,p]=u.useState(c),[m,f]=u.useState(""),[g,x]=u.useState(null),{t:h}=A(),{removeFilter:a}=J(),{key:o,label:j}=t,v=X({param:o,prefix:s,multiple:l}),w=v.get(),I=w.map(y=>{var S;return(S=r.find(D=>D.value===y))==null?void 0:S.label}).filter(Boolean),O=()=>{v.delete(),a(o)};let F=null;const C=y=>{p(y),F&&clearTimeout(F),!y&&!w.length&&(F=setTimeout(()=>{a(o)},200))},T=()=>{f(""),g&&g.focus()},N=y=>{v.get().includes(String(y))?v.delete(String(y)):v.add(String(y))};return e.jsxs(V,{modal:!0,open:d,onOpenChange:C,children:[e.jsx(Ot,{readonly:n,label:j,value:I,onRemove:O}),!n&&e.jsx(K,{children:e.jsx(U,{hideWhenDetached:!0,align:"start",sideOffset:8,collisionPadding:8,className:R("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-hidden rounded-lg outline-none"),onInteractOutside:y=>{var S;y.target instanceof HTMLElement&&((S=y.target.attributes.getNamedItem("data-name"))==null?void 0:S.value)==="filters_menu_content"&&(y.preventDefault(),y.stopPropagation())},children:e.jsxs(z,{className:"h-full",children:[i&&e.jsx("div",{className:"border-b p-1",children:e.jsxs("div",{className:"grid grid-cols-[1fr_20px] gap-x-2 rounded-md px-2 py-1",children:[e.jsx(z.Input,{ref:x,value:m,onValueChange:f,className:"txt-compact-small placeholder:text-ui-fg-muted bg-transparent outline-none",placeholder:"Search"}),e.jsx("div",{className:"flex h-5 w-5 items-center justify-center",children:e.jsx("button",{disabled:!m,onClick:T,className:R("transition-fg text-ui-fg-muted focus-visible:bg-ui-bg-base-pressed rounded-md outline-none",{invisible:!m}),children:e.jsx(B,{})})})]})}),e.jsx(z.Empty,{className:"txt-compact-small flex items-center justify-center p-1",children:e.jsx("span",{className:"w-full px-2 py-1 text-center",children:h("general.noResultsTitle")})}),e.jsx(z.List,{className:"h-full max-h-[163px] min-h-[0] overflow-auto p-1 outline-none",children:r.map(y=>{const S=v.get().includes(String(y.value));return e.jsxs(z.Item,{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover aria-selected:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex cursor-pointer select-none items-center gap-x-2 rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",value:y.label,onSelect:()=>{N(y.value)},children:[e.jsx("div",{className:R("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!S}),children:l?e.jsx(Ge,{}):e.jsx(W,{})}),y.label]},String(y.value))})})]})})})]})},Ot=({label:t,value:s,onRemove:n,readonly:l})=>{const{t:i}=A(),r=s?Array.isArray(s)?s:[s]:null,c=(r==null?void 0:r.length)||0,d=p=>{p.stopPropagation(),n()};return e.jsx($,{asChild:!0,children:e.jsxs("div",{className:R("bg-ui-bg-field transition-fg shadow-borders-base text-ui-fg-subtle flex cursor-pointer select-none items-center overflow-hidden rounded-md",{"hover:bg-ui-bg-field-hover":!l,"data-[state=open]:bg-ui-bg-field-hover":!l}),children:[e.jsx("div",{className:R("flex items-center justify-center whitespace-nowrap px-2 py-1",{"border-r":c>0}),children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",children:t})}),e.jsxs("div",{className:"flex w-full items-center overflow-hidden",children:[c>0&&e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",className:"text-ui-fg-muted",children:i("general.is")})}),c>0&&e.jsx("div",{className:"flex-1 overflow-hidden border-r p-1 px-2",children:e.jsx(E,{size:"small",leading:"compact",weight:"plus",className:"truncate text-nowrap",children:r==null?void 0:r.join(", ")})})]}),!l&&r&&r.length>0&&e.jsx("div",{children:e.jsx("button",{onClick:d,className:R("text-ui-fg-muted transition-fg flex items-center justify-center p-1","hover:bg-ui-bg-subtle-hover","active:bg-ui-bg-subtle-pressed active:text-ui-fg-base"),children:e.jsx(B,{})})})]})})},Ft=({filter:t,prefix:s,readonly:n,openOnMount:l})=>{const[i,r]=u.useState(l),{key:c,label:d}=t,{removeFilter:p}=J(),m=X({param:c,prefix:s}),f=m.get(),g=u.useCallback(de.debounce(o=>{const j=o.target.value;j?m.add(j):m.delete()},500),[m]);u.useEffect(()=>()=>{g.cancel()},[g]);let x=null;const h=o=>{r(o),x&&clearTimeout(x),!o&&!f.length&&(x=setTimeout(()=>{p(c)},200))},a=()=>{m.delete(),p(c)};return e.jsxs(V,{modal:!0,open:i,onOpenChange:h,children:[e.jsx(Et,{label:d,value:f==null?void 0:f[0],onRemove:a,readonly:n}),!n&&e.jsx(K,{children:e.jsx(U,{hideWhenDetached:!0,align:"start",sideOffset:8,collisionPadding:8,className:R("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-hidden rounded-lg outline-none"),onInteractOutside:o=>{var j;o.target instanceof HTMLElement&&((j=o.target.attributes.getNamedItem("data-name"))==null?void 0:j.value)==="filters_menu_content"&&(o.preventDefault(),o.stopPropagation())},children:e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(Y,{size:"xsmall",weight:"plus",htmlFor:c,children:d})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(H,{name:c,size:"small",defaultValue:(f==null?void 0:f[0])||void 0,onChange:g})})]})})})]})},Et=({label:t,value:s,readonly:n,onRemove:l})=>{const{t:i}=A();return e.jsx($,{asChild:!0,children:e.jsxs("div",{className:R("bg-ui-bg-field transition-fg shadow-borders-base text-ui-fg-subtle flex cursor-pointer select-none items-center overflow-hidden rounded-md",{"hover:bg-ui-bg-field-hover":!n,"data-[state=open]:bg-ui-bg-field-hover":!n}),children:[e.jsx("div",{className:R("flex items-center justify-center whitespace-nowrap px-2 py-1",{"border-r":!!s}),children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",children:t})}),e.jsxs("div",{className:"flex w-full items-center overflow-hidden",children:[!!s&&e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx(E,{size:"small",weight:"plus",leading:"compact",className:"text-ui-fg-muted",children:i("general.is")})}),!!s&&e.jsx("div",{className:"flex-1 overflow-hidden border-r p-1 px-2",children:e.jsx(E,{size:"small",leading:"compact",weight:"plus",className:"truncate text-nowrap",children:s})})]}),!n&&!!s&&e.jsx("div",{children:e.jsx("button",{onClick:l,className:R("text-ui-fg-muted transition-fg flex items-center justify-center p-1","hover:bg-ui-bg-subtle-hover","active:bg-ui-bg-subtle-pressed active:text-ui-fg-base"),children:e.jsx(B,{})})})]})})},$t=({filters:t,readonly:s,prefix:n})=>{const{t:l}=A(),[i]=me(),[r,c]=u.useState(!1),[d,p]=u.useState(_t({searchParams:i,filters:t,prefix:n})),m=t.filter(a=>!d.find(o=>o.key===a.key)),f=u.useRef(!0);u.useEffect(()=>{if(f.current){const a=new URLSearchParams(i);t.forEach(o=>{const j=n?`${n}_${o.key}`:o.key;a.get(j)&&!d.find(w=>w.key===o.key)&&(o.type==="select"?p(w=>[...w,{...o,multiple:o.multiple,options:o.options,openOnMount:!1}]):p(w=>[...w,{...o,openOnMount:!1}]))})}f.current=!1},[d,t,n,i]);const g=a=>{c(!1),p(o=>[...o,{...a,openOnMount:!0}])},x=u.useCallback(a=>{p(o=>o.filter(j=>j.key!==a))},[]),h=u.useCallback(()=>{p([])},[]);return e.jsx(fe.Provider,{value:u.useMemo(()=>({removeFilter:x,removeAllFilters:h}),[h,x]),children:e.jsxs("div",{className:"max-w-2/3 flex flex-wrap items-center gap-2",children:[d.map(a=>{switch(a.type){case"select":return e.jsx(It,{filter:a,prefix:n,readonly:s,options:a.options,multiple:a.multiple,searchable:a.searchable,openOnMount:a.openOnMount},a.key);case"date":return e.jsx(Je,{filter:a,prefix:n,readonly:s,openOnMount:a.openOnMount},a.key);case"string":return e.jsx(Ft,{filter:a,prefix:n,readonly:s,openOnMount:a.openOnMount},a.key);case"number":return e.jsx(Nt,{filter:a,prefix:n,readonly:s,openOnMount:a.openOnMount},a.key)}}),!s&&m.length>0&&e.jsxs(V,{modal:!0,open:r,onOpenChange:c,children:[e.jsx($,{asChild:!0,id:"filters_menu_trigger",children:e.jsx($e,{size:"small",variant:"secondary",children:l("filters.addFilter")})}),e.jsx(K,{children:e.jsx(U,{className:R("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-auto rounded-lg p-1 outline-none"),"data-name":"filters_menu_content",align:"start",sideOffset:8,collisionPadding:8,onCloseAutoFocus:a=>{d.find(j=>j.openOnMount)&&a.preventDefault()},children:m.map(a=>e.jsx("div",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",role:"menuitem",onClick:()=>{g(a)},children:a.label},a.key))})})]}),!s&&d.length>0&&e.jsx(Tt,{filters:t,prefix:n})]})})},Tt=({filters:t,prefix:s})=>{const{removeAllFilters:n}=J(),[l,i]=me(),r=()=>{i(c=>{const d=new URLSearchParams(c);return t.forEach(p=>{d.delete(s?`${s}_${p.key}`:p.key)}),d}),n()};return e.jsx("button",{type:"button",onClick:r,className:R("text-ui-fg-muted transition-fg txt-compact-small-plus rounded-md px-2 py-1","hover:text-ui-fg-subtle","focus-visible:shadow-borders-focus"),children:"Clear all"})},_t=({searchParams:t,filters:s,prefix:n})=>{const l=new URLSearchParams(t),i=[];return s.forEach(r=>{const c=n?`${n}_${r.key}`:r.key;l.get(c)&&(r.type==="select"?i.push({...r,multiple:r.multiple,options:r.options,openOnMount:!1}):i.push({...r,openOnMount:!1}))}),i};export{$t as D};
