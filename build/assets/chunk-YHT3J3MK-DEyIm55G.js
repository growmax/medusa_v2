import{o as m}from"./chunk-Y2QXUTMB-CYOiJYmV.js";import{c as x}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{F as g}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{z as e}from"./index-yuYasa5Y.js";import{j as i,r as h,u as D,x as k,g as y,z as I,S as L,G as M,T as w}from"./index-7A3rjJyE.js";import{T as P}from"./thumbnail-badge-B_XgQTWQ.js";import{A as C}from"./index-Cy4zQj6C.js";import{m as U}from"./motion-UqVoX3oU.js";var Y=t=>{var a,s,d,c,p,u,b;const o=(s=(a=t.media)==null?void 0:a.find(l=>l.isThumbnail))==null?void 0:s.url,r=(d=t.media)==null?void 0:d.filter(l=>!l.isThumbnail).map(l=>({url:l.url}));return{status:t.status,is_giftcard:!1,tags:(c=t==null?void 0:t.tags)!=null&&c.length?(p=t.tags)==null?void 0:p.map(l=>({value:l})):void 0,sales_channels:(u=t==null?void 0:t.sales_channels)!=null&&u.length?(b=t.sales_channels)==null?void 0:b.map(l=>({id:l.id})):void 0,images:r,collection_id:t.collection_id||void 0,categories:t.categories.map(l=>({id:l})),type_id:t.type_id||void 0,handle:t.handle||void 0,origin_country:t.origin_country||void 0,material:t.material||void 0,mid_code:t.mid_code||void 0,hs_code:t.hs_code||void 0,thumbnail:o,title:t.title,subtitle:t.subtitle||void 0,description:t.description||void 0,discountable:t.discountable||void 0,width:t.width?parseFloat(t.width):void 0,length:t.length?parseFloat(t.length):void 0,height:t.height?parseFloat(t.height):void 0,weight:t.weight?parseFloat(t.weight):void 0,options:t.options.filter(l=>l.title),variants:q(t.variants.filter(l=>l.should_create),t.regionsCurrencyMap)}},q=(t,o)=>t.map(r=>({title:r.custom_title||Object.values(r.options||{}).join(" / "),options:r.options,sku:r.sku||void 0,manage_inventory:r.manage_inventory||void 0,allow_backorder:r.allow_backorder||void 0,inventory_items:r.inventory.map(a=>{const s=x(a.required_quantity);return!a.inventory_item_id||!s?!1:{...a,required_quantity:s}}).filter(Boolean),prices:Object.entries(r.prices||{}).map(([a,s])=>a.startsWith("reg_")?{currency_code:o[a],amount:x(s),rules:{region_id:a}}:{currency_code:a,amount:x(s)}).filter(a=>!!a)})),A=t=>t.map(o=>({...o,title:o.title||"",sku:o.sku||"",manage_inventory:o.manage_inventory||!1,allow_backorder:o.allow_backorder||!1,inventory_kit:o.inventory_kit||!1})),F=e.object({id:e.string().optional(),url:e.string(),isThumbnail:e.boolean(),file:e.any().nullable()}),$=e.object({title:e.string().min(1),subtitle:e.string().optional(),handle:e.string().optional(),description:e.string().optional(),discountable:e.boolean(),type_id:e.string().optional(),collection_id:e.string().optional(),categories:e.array(e.string()),tags:e.array(e.string()).optional(),sales_channels:e.array(e.object({id:e.string(),name:e.string()})).optional(),origin_country:e.string().optional(),material:e.string().optional(),width:e.string().optional(),length:e.string().optional(),height:e.string().optional(),weight:e.string().optional(),mid_code:e.string().optional(),hs_code:e.string().optional(),options:e.array(e.object({title:e.string().min(1),values:e.array(e.string()).min(1)})).min(1),enable_variants:e.boolean(),variants:e.array(e.object({should_create:e.boolean(),is_default:e.boolean().optional(),title:e.string(),upc:e.string().optional(),ean:e.string().optional(),barcode:e.string().optional(),mid_code:e.string().optional(),hs_code:e.string().optional(),width:m,height:m,length:m,weight:m,material:e.string().optional(),origin_country:e.string().optional(),custom_title:e.string().optional(),sku:e.string().optional(),manage_inventory:e.boolean().optional(),allow_backorder:e.boolean().optional(),inventory_kit:e.boolean().optional(),options:e.record(e.string(),e.string()),variant_rank:e.number(),prices:e.record(e.string(),e.string().optional()).optional(),inventory:e.array(e.object({inventory_item_id:e.string(),required_quantity:m})).optional()})).min(1),media:e.array(F).optional()}).superRefine((t,o)=>{if(t.variants.every(r=>!r.should_create))return o.addIssue({code:e.ZodIssueCode.custom,path:["variants"],message:"invalid_length"})}),ee=e.object({media:e.array(F)}),te={discountable:!0,tags:[],sales_channels:[],options:[{title:"Default option",values:["Default option value"]}],variants:A([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]),enable_variants:!1,media:[],categories:[],collection_id:"",description:"",handle:"",height:"",hs_code:"",length:"",material:"",mid_code:"",origin_country:"",subtitle:"",title:"",type_id:"",weight:"",width:""},ie=({media:t,selection:o,onCheckedChange:r})=>i.jsx("div",{className:"bg-ui-bg-subtle size-full overflow-auto",children:i.jsx("div",{className:"grid h-fit auto-rows-auto grid-cols-4 gap-6 p-6",children:t.map(a=>i.jsx(z,{onCheckedChange:r(a.id),checked:!!o[a.id],media:a},a.field_id))})}),z=({media:t,checked:o,onCheckedChange:r})=>{const[a,s]=h.useState(!0),{t:d}=D(),c=h.useCallback(()=>{r(!o)},[o,r]);return i.jsxs("button",{type:"button",onClick:c,className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover focus-visible:shadow-borders-focus bg-ui-bg-subtle-hover group relative aspect-square h-auto max-w-full overflow-hidden rounded-lg outline-none",children:[t.isThumbnail&&i.jsx("div",{className:"absolute left-2 top-2",children:i.jsx(k,{content:d("products.media.thumbnailTooltip"),children:i.jsx(P,{})})}),i.jsx("div",{className:y("transition-fg absolute right-2 top-2 opacity-0 group-focus-within:opacity-100 group-hover:opacity-100 group-focus:opacity-100",{"opacity-100":o}),children:i.jsx("div",{className:y("group relative inline-flex h-4 w-4 items-center justify-center outline-none "),children:i.jsx("div",{className:y("text-ui-fg-on-inverted bg-ui-bg-component shadow-borders-base [&_path]:shadow-details-contrast-on-bg-interactive group-disabled:text-ui-fg-disabled group-disabled:!bg-ui-bg-disabled group-disabled:!shadow-borders-base transition-fg h-[14px] w-[14px] rounded-[3px]",{"bg-ui-bg-interactive group-hover:bg-ui-bg-interactive shadow-borders-interactive-with-shadow":o}),children:o&&i.jsx("div",{className:"absolute inset-0",children:i.jsx(I,{})})})})}),i.jsx(C,{children:a&&i.jsx(U.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.5}},className:"bg-ui-bg-subtle-hover absolute inset-0 flex items-center justify-center",children:i.jsx(L,{className:"text-ui-fg-subtle animate-spin"})})}),i.jsx("img",{src:t.url,onLoad:()=>s(!1),alt:"",className:"size-full object-cover object-center"})]})},V=({label:t,hint:o,hasError:r,formats:a,onUploaded:s})=>{const[d,c]=h.useState(!1),p=h.useRef(null),u=h.useRef(null),b=()=>{var n;(n=p.current)==null||n.click()},l=n=>{var _;n.preventDefault(),n.stopPropagation(),(_=n.dataTransfer)!=null&&_.files&&c(!0)},E=n=>{n.preventDefault(),n.stopPropagation(),!(!u.current||u.current.contains(n.relatedTarget))&&c(!1)},v=n=>{if(!n)return;const _=Array.from(n).map(j=>{const O=Math.random().toString(36).substring(7),R=URL.createObjectURL(j);return{id:O,url:R,file:j}});s(_)},N=n=>{var f;n.preventDefault(),n.stopPropagation(),c(!1),v((f=n.dataTransfer)==null?void 0:f.files)},S=async n=>{v(n.target.files)};return i.jsxs("div",{children:[i.jsxs("button",{ref:u,type:"button",onClick:b,onDrop:N,onDragOver:n=>n.preventDefault(),onDragEnter:l,onDragLeave:E,className:y("bg-ui-bg-component border-ui-border-strong transition-fg group flex w-full flex-col items-center gap-y-2 rounded-lg border border-dashed p-8","hover:border-ui-border-interactive focus:border-ui-border-interactive","focus:shadow-borders-focus outline-none focus:border-solid",{"!border-ui-border-error":r,"!border-ui-border-interactive":d}),children:[i.jsxs("div",{className:"text-ui-fg-subtle group-disabled:text-ui-fg-disabled flex items-center gap-x-2",children:[i.jsx(M,{}),i.jsx(w,{children:t})]}),!!o&&i.jsx(w,{size:"small",leading:"compact",className:"text-ui-fg-muted group-disabled:text-ui-fg-disabled",children:o})]}),i.jsx("input",{hidden:!0,ref:p,onChange:S,type:"file",accept:a.join(","),multiple:!0})]})},T=["image/jpeg","image/png","image/gif","image/webp","image/heic","image/svg+xml"],G=[".jpeg",".png",".gif",".webp",".heic",".svg"],oe=({form:t,append:o})=>{const{t:r}=D(),a=s=>{const d=s.find(c=>!T.includes(c.file.type));return d?(t.setError("media",{type:"invalid_file",message:r("products.media.invalidFileType",{name:d.file.name,types:G.join(", ")})}),!0):!1};return i.jsx(g.Field,{control:t.control,name:"media",render:()=>i.jsx(g.Item,{children:i.jsxs("div",{className:"flex flex-col gap-y-4",children:[i.jsxs("div",{className:"flex flex-col gap-y-1",children:[i.jsx(g.Label,{optional:!0,children:r("products.media.label")}),i.jsx(g.Hint,{children:r("products.media.editHint")})]}),i.jsx(g.Control,{children:i.jsx(V,{label:r("products.media.uploadImagesLabel"),hint:r("products.media.uploadImagesHint"),hasError:!!t.formState.errors.media,formats:T,onUploaded:s=>{t.clearErrors("media"),!a(s)&&s.forEach(d=>o({...d,isThumbnail:!1}))}})}),i.jsx(g.ErrorMessage,{})]})})})};export{ee as E,ie as M,te as P,oe as U,$ as a,A as d,Y as n};
