import{u as z,a as E}from"./chunk-XDVPCCFF-B6JMJTaY.js";import{u as M}from"./chunk-LSEYENCI-DIrDwSyt.js";import{v as F,cf as H,j as e,u as k,cg as B,r as D,c1 as N,t as T,x as b,k as O}from"./index-7A3rjJyE.js";import{u as L,D as V}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{R as p,u as q}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as G,H as Q}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{t as Z}from"./zod-DRKIF09R.js";import{o as $,a as J,s as K}from"./index-yuYasa5Y.js";import{B as A}from"./label-DDCdtDlT.js";import{C as R}from"./checkbox-BD385cy_.js";import{c as U}from"./index-DL2eSRCZ.js";import"./chunk-KDXAFTVE-BIJQy-Te.js";import"./chunk-IQRVIEMV-JX6w9umB.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./chunk-ADOCJB6L-3PFdxvdK.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./x-mark-mini-Di7jARRp.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";var W=$({promotion_ids:J(K()).min(1)}),P=50,X=({campaign:t})=>{var _,v;const{t:s}=k(),{handleSuccess:o}=q(),r=G({defaultValues:{promotion_ids:[]},resolver:Z(W)}),{setValue:u}=r,{mutateAsync:x,isPending:S}=B(t.id),[g,n]=D.useState({}),c=i=>{const y=typeof i=="function"?i(g):i,w=Object.keys(y);u("promotion_ids",w,{shouldDirty:!0,shouldTouch:!0}),n(y)},{searchParams:d,raw:j}=z({pageSize:P}),{promotions:C,count:a,isPending:h}=N({...d},{placeholderData:O}),m=ee(),f=M(),{table:l}=L({data:C??[],columns:m,enableRowSelection:i=>i.original.campaign_id!==t.id,enablePagination:!0,getRowId:i=>i.id,pageSize:P,count:a,rowSelection:{state:g,updater:c},meta:{campaignId:t.id,currencyCode:(_=t==null?void 0:t.budget)==null?void 0:_.currency_code,budgetType:(v=t==null?void 0:t.budget)==null?void 0:v.type}}),I=r.handleSubmit(async i=>{await x({add:i.promotion_ids},{onSuccess:()=>{T.success(s("campaigns.promotions.toast.success",{count:i.promotion_ids.length})),o()},onError:y=>T.error(y.message)})});return e.jsx(p.Form,{form:r,children:e.jsxs("form",{onSubmit:I,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(p.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.formState.errors.promotion_ids&&e.jsx(Q,{variant:"error",children:r.formState.errors.promotion_ids.message}),e.jsx(p.Close,{asChild:!0,children:e.jsx(A,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(A,{size:"small",type:"submit",isLoading:S,children:s("actions.save")})]})}),e.jsx(p.Body,{className:"flex size-full flex-col overflow-y-auto",children:e.jsx(V,{table:l,count:a,columns:m,pageSize:P,isLoading:h,filters:f,orderBy:["title","status","created_at","updated_at"],queryObject:j,layout:"fill",pagination:!0,search:!0,noRecords:{message:s("campaigns.promotions.add.list.noRecordsMessage")}})})]})})},Y=U(),ee=()=>{const t=E(),{t:s}=k();return D.useMemo(()=>[Y.display({id:"select",header:({table:o})=>e.jsx(R,{checked:o.getIsSomePageRowsSelected()?"indeterminate":o.getIsAllPageRowsSelected(),onCheckedChange:r=>o.toggleAllRowsSelected(!!r)}),cell:({row:o,table:r})=>{var h,m,f;const{campaignId:u,currencyCode:x,budgetType:S}=r.options.meta,g=S==="spend",n=o.original.campaign_id===u,c=!!o.original.campaign_id&&o.original.campaign_id!==u,d=g&&((h=o.original.application_method)==null?void 0:h.currency_code)!==x,j=o.getIsSelected()||n,C=d||c,a=e.jsx(R,{checked:C?"indeterminate":j,disabled:n||c||d,onCheckedChange:l=>o.toggleSelected(!!l),onClick:l=>{l.stopPropagation()}});return c?e.jsx(b,{content:s("campaigns.promotions.alreadyAddedDiffCampaign",{name:(f=(m=o.original)==null?void 0:m.campaign)==null?void 0:f.name}),side:"right",children:a}):d?e.jsx(b,{content:s("campaigns.promotions.currencyMismatch"),side:"right",children:a}):n?e.jsx(b,{content:s("campaigns.promotions.alreadyAdded"),side:"right",children:a}):a}}),...t],[s,t])},Ee=()=>{const{id:t}=F(),{campaign:s,isError:o,error:r}=H(t);if(o)throw r;return e.jsx(p,{children:s&&e.jsx(X,{campaign:s})})};export{Ee as Component};
