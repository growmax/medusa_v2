import{a as A}from"./chunk-KKUJQ3HN-BWZVkDDd.js";import{u as M}from"./chunk-MMJ4V5AR-M7tiWwVa.js";import{r as n,u as q,j as e,g as l,T as p,A as F,D as I,z as U,E as V,F as X}from"./index-7A3rjJyE.js";import{R as H,T as K,P as B,C as G}from"./chunk-M566SHKI-Cmdx6k9x.js";import{X as J}from"./x-mark-mini-Di7jARRp.js";import{T as Q}from"./triangles-mini-JWkpofVU.js";import{T as W}from"./Trans-Cyi6soNY.js";var Y=n.forwardRef(({value:s,onChange:r,className:f,...C},T)=>{const o=n.useRef(null);n.useImperativeHandle(T,()=>o.current,[]);const[c,_]=n.useState(!1),{i18n:z,t:b}=q(),[d,m]=n.useState([]),{searchValue:i,onSearchValueChange:v,query:g}=A(),{product_categories:D,isPending:j,isError:P,error:R}=M({q:g,parent_category_id:i?void 0:Z(d),include_descendants_tree:!i},{enabled:c}),[h,w]=n.useState(!1);n.useEffect(()=>{let t;return j?w(!0):t=setTimeout(()=>{w(!1)},150),()=>{clearTimeout(t)}},[j]),n.useEffect(()=>{i&&m([])},[i]);function S(t){var a;t.preventDefault(),t.stopPropagation(),m(d.slice(0,d.length-1)),(a=o.current)==null||a.focus()}function k(t){return a=>{var u;a.preventDefault(),a.stopPropagation(),m([...d,{id:t.value,label:t.label}]),(u=o.current)==null||u.focus()}}function L(t){return a=>{var u;a.preventDefault(),a.stopPropagation(),N(s,t.value)?r(s.filter(E=>E!==t.value)):r([...s,t.value]),(u=o.current)==null||u.focus()}}function O(t){t||(v(""),m([])),t&&requestAnimationFrame(()=>{var a;(a=o.current)==null||a.focus()}),_(t)}const x=ee(D||[]),y=s.length>0&&!c;if(P)throw R;return e.jsxs(H,{modal:!0,open:c,onOpenChange:O,children:[e.jsx(K,{asChild:!0,children:e.jsxs("div",{className:l("relative flex cursor-pointer items-center gap-x-2 overflow-hidden","h-8 w-full rounded-md px-2 py-0.5","bg-ui-bg-field transition-fg shadow-borders-base","hover:bg-ui-bg-field-hover","has-[input:focus]:shadow-borders-interactive-with-active","has-[:invalid]:shadow-borders-error has-[[aria-invalid=true]]:shadow-borders-error","has-[:disabled]:bg-ui-bg-disabled has-[:disabled]:text-ui-fg-disabled has-[:disabled]:cursor-not-allowed",{"shadow-borders-interactive-with-active":c,"pl-0.5":y},f),children:[c?e.jsx("input",{ref:o,value:i,onChange:t=>v(t.target.value),className:l("txt-compact-small w-full appearance-none bg-transparent outline-none","placeholder:text-ui-fg-muted"),...C}):y?e.jsxs("div",{className:"flex w-full items-center gap-x-2",children:[e.jsx("div",{className:"flex w-fit items-center gap-x-1",children:e.jsxs("div",{className:"bg-ui-bg-base txt-compact-small-plus text-ui-fg-subtle focus-within:border-ui-fg-interactive relative flex h-[28px] items-center rounded-[4px] border py-[3px] pl-1.5 pr-1",children:[e.jsx("span",{children:s.length}),e.jsx("button",{type:"button",className:"size-fit outline-none",onClick:t=>{t.preventDefault(),r([])},children:e.jsx(J,{className:"text-ui-fg-muted"})})]})}),e.jsx(p,{size:"small",leading:"compact",children:b("general.selected")})]}):e.jsx("div",{className:"w-full"}),e.jsx("div",{className:"flex size-5 items-center justify-center",children:e.jsx(Q,{className:"text-ui-fg-muted"})})]})}),e.jsx(B,{children:e.jsxs(G,{sideOffset:8,role:"listbox",className:l("shadow-elevation-flyout bg-ui-bg-base -left-2 z-50 w-[var(--radix-popper-anchor-width)] rounded-[8px]","max-h-[200px] overflow-y-auto","data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-95","data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),onOpenAutoFocus:t=>{t.preventDefault()},children:[!i&&d.length>0&&e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"p-1",children:e.jsxs("button",{className:l("transition-fg grid w-full appearance-none grid-cols-[20px_1fr] items-center justify-center gap-2 rounded-md px-2 py-1.5 text-left outline-none","hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed"),type:"button",onClick:S,children:[e.jsx(F,{className:"text-ui-fg-muted"}),e.jsx(p,{size:"small",leading:"compact",children:$(d)})]})}),e.jsx(I,{})]}),e.jsxs("div",{className:"p-1",children:[x.length>0&&!h&&x.map(t=>e.jsxs("div",{className:l("transition-fg bg-ui-bg-base grid cursor-pointer grid-cols-1 items-center gap-2 overflow-hidden",{"grid-cols-[1fr_32px]":t.has_children&&!i}),children:[e.jsxs("button",{type:"button",role:"option",className:l("grid h-full w-full appearance-none grid-cols-[20px_1fr] items-center gap-2 overflow-hidden rounded-md px-2 py-1.5 text-left","hover:bg-ui-bg-base-hover"),onClick:L(t),children:[e.jsx("div",{className:"flex size-5 items-center justify-center",children:N(s,t.value)&&e.jsx(U,{})}),e.jsx(p,{as:"span",size:"small",leading:"compact",className:"w-full truncate",children:t.label})]}),t.has_children&&!i&&e.jsx("button",{className:l("text-ui-fg-muted flex size-8 appearance-none items-center justify-center rounded-md outline-none","hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed"),type:"button",onClick:k(t),children:e.jsx(V,{})})]},t.value)),h&&Array.from({length:5}).map((t,a)=>e.jsxs("div",{className:"grid grid-cols-[20px_1fr_20px] gap-2 px-2 py-1.5",children:[e.jsx("div",{}),e.jsx(X,{size:"small",leading:"compact"}),e.jsx("div",{})]},a)),x.length===0&&!h&&e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(p,{size:"small",leading:"compact",children:g?e.jsx(W,{i18n:z,i18nKey:"general.noResultsTitle",tOptions:{query:g},components:[e.jsx("span",{className:"font-medium"},"query")]}):b("general.noResultsTitle")})})]})]})})]})});Y.displayName="CategoryCombobox";function Z(s){return s.length?s[s.length-1].id:"null"}function $(s){return s.length?s[s.length-1].label:null}function ee(s){return s.map(r=>{var f;return{value:r.id,label:r.name,has_children:((f=r.category_children)==null?void 0:f.length)>0}})}function N(s,r){return s.includes(r)}export{Y as C};
