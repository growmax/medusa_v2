import{u as V,a as K}from"./chunk-WL3E5WGF-DZFGL-a4.js";import{u as L}from"./chunk-ZAKH3ZQB-BBhcY7sJ.js";import{m as O,o as U,j as e,u as I,r as j,co as G,t as T,q as X,bF as Z,x as $,k as J}from"./index-7A3rjJyE.js";import{u as W,D as Y}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{R as h,u as ee}from"./chunk-BHGSRQH6-2xCUuk1R.js";import{u as re,H as se}from"./chunk-C7RYT3S3-C_x8NvOf.js";import{o as te,a as oe,s as ie,r as ce,b as ae}from"./index-yuYasa5Y.js";import{t as ne}from"./zod-DRKIF09R.js";import{B as k}from"./label-DDCdtDlT.js";import{C as R}from"./checkbox-BD385cy_.js";import{S as le}from"./switch-DDIyRuzh.js";import{c as de}from"./index-DL2eSRCZ.js";import"./chunk-IQRVIEMV-JX6w9umB.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./format-CkWRMO1y.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./x-mark-mini-Di7jARRp.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";var ue=te({currencies:oe(ie()).min(1),pricePreferences:ce(ae())}),E=50,S="ac",me=({store:t,pricePreferences:n})=>{var b;const{t:c}=I(),{handleSuccess:m}=ee(),{raw:s,searchParams:i}=V({pageSize:50,prefix:S}),{currencies:l,count:a,isPending:d,isError:x,error:g}=L(i,{placeholderData:J}),p=re({defaultValues:{currencies:[],pricePreferences:n==null?void 0:n.reduce((r,o)=>(o.value&&(r[o.value]=o.is_tax_inclusive),r),{})},resolver:ne(ue)}),[v,N]=j.useState({}),{setValue:y,watch:D}=p,F=D("pricePreferences"),z=r=>{const o=typeof r=="function"?r(v):r,f=Object.keys(o);y("currencies",f,{shouldDirty:!0,shouldTouch:!0}),N(o)},C=((b=t.supported_currencies)==null?void 0:b.map(r=>r.currency_code))??[],H=j.useCallback(r=>{y("pricePreferences",r)},[y]),P=pe(F,H),{table:q}=W({data:l??[],columns:P,count:a,getRowId:r=>r.code,enableRowSelection:r=>!C.includes(r.original.code),enablePagination:!0,pageSize:E,prefix:S,rowSelection:{state:v,updater:z}}),{mutateAsync:B,isPending:M}=G(t.id),Q=p.handleSubmit(async r=>{var w,_;const o=Array.from(new Set([...r.currencies,...C]));let f=(_=(w=t.supported_currencies)==null?void 0:w.find(u=>u.is_default))==null?void 0:_.currency_code;o.includes(f??"")||(f=o==null?void 0:o[0]),await B({supported_currencies:o.map(u=>({currency_code:u,is_default:u===f,is_tax_inclusive:r.pricePreferences[u]}))},{onSuccess:()=>{T.success(c("store.toast.currenciesUpdated")),X.invalidateQueries({queryKey:Z.all}),m()},onError:u=>{T.error(u.message)}})});if(x)throw g;return e.jsx(h.Form,{form:p,children:e.jsxs("form",{onSubmit:Q,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(h.Header,{children:e.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:p.formState.errors.currencies&&e.jsx(se,{variant:"error",children:p.formState.errors.currencies.message})}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(k,{size:"small",variant:"secondary",children:c("actions.cancel")})}),e.jsx(k,{size:"small",type:"submit",isLoading:M,children:c("actions.save")})]})]})}),e.jsx(h.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx(Y,{table:q,pageSize:E,count:a,columns:P,layout:"fill",pagination:!0,search:!0,prefix:S,orderBy:["code","name"],isLoading:d,queryObject:s})})]})})},A=de(),pe=(t,n)=>{const{t:c}=I(),m=K();return j.useMemo(()=>[A.display({id:"select",header:({table:s})=>e.jsx(R,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:i=>s.toggleAllPageRowsSelected(!!i)}),cell:({row:s})=>{const i=!s.getCanSelect(),l=s.getIsSelected()||i,a=e.jsx(R,{checked:l,disabled:i,onCheckedChange:d=>s.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}});return i?e.jsx($,{content:c("store.currencyAlreadyAdded"),side:"right",children:a}):a}}),...m,A.display({id:"select",header:()=>e.jsx("div",{className:"whitespace-nowrap",children:c("fields.taxInclusivePricing")}),cell:({row:s})=>{const i=!s.getCanSelect(),l=t[s.original.code];return e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(le,{disabled:i,checked:l??!1,onCheckedChange:a=>{n({...t,[s.original.code]:a})}})})}})],[c,m,t,n])},Ue=()=>{var x;const{store:t,isPending:n,isError:c,error:m}=O(),{price_preferences:s,isPending:i,isError:l,error:a}=U({attribute:"currency_code",value:(x=t==null?void 0:t.supported_currencies)==null?void 0:x.map(g=>g.currency_code)},{enabled:!!t}),d=!!t&&!n&&!!s&&!i;if(c)throw m;if(l)throw a;return e.jsx(h,{children:d&&e.jsx(me,{store:t,pricePreferences:s})})};export{Ue as Component};
