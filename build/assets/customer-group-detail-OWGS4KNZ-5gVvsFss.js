import{u as E,a as I,b as z}from"./chunk-DJPQV344-h2lsG9Cn.js";import{h as L,v as M,j as s,cj as Q,q as x,r as v,u as l,C,H as w,L as H,b as O,T as h,p as $,t as f}from"./index-7A3rjJyE.js";import{S as B}from"./chunk-FGHVNTU2-HfmduO2_.js";import"./chunk-3IW4HYUP-C89ww9p0.js";import{e as F,a as S,b as K}from"./chunk-YVTBRLIE-C161Iqr5.js";import{u as J}from"./chunk-RYVWLLZ2-BlkKIhzO.js";import{A as b}from"./chunk-WRXTMI2J-CygmDunM.js";import{u as Z,D as U}from"./chunk-MOFW5DA3-Byx5Qi5u.js";import"./lodash-8s6kkRaG.js";import"./chunk-7LAPOKHJ-BtMb3RyP.js";import"./chunk-M566SHKI-Cmdx6k9x.js";import{p as V}from"./chunk-YBHG7T6S-BleHOTgO.js";import{P as G}from"./pencil-square-mUSTT5rR.js";import{T}from"./trash-C_lucST6.js";import{u as d}from"./use-prompt-iL3FbEo4.js";import{B as W}from"./label-DDCdtDlT.js";import{C as y}from"./checkbox-BD385cy_.js";import{c as X}from"./index-DL2eSRCZ.js";import"./chunk-C76H5USB-qWdDTOoY.js";import"./chunk-B4FQDBC3-Plo6CPPz.js";import"./chunk-P3UUX2T6-Bigsa15J.js";import"./format-CkWRMO1y.js";import"./chunk-ADOCJB6L-3PFdxvdK.js";import"./arrow-up-right-on-box-CF7GLQ-o.js";import"./Trans-Cyi6soNY.js";import"./x-mark-mini-Di7jARRp.js";import"./triangle-down-mini-BHNqpDM0.js";import"./square-two-stack-Ao9P_yLE.js";import"./chunk-5FUV23JF-QRqJ2E8j.js";import"./chunk-RKBIB2RM-jqr0zPdv.js";import"./chunk-WX2SMNCD-D4nWbVrW.js";import"./plus-mini-BHxdUq8n.js";import"./command-bar-DBncXrlJ.js";import"./index-DFaNeppw.js";import"./chunk-QAF7PVQE-exoP4XGT.js";import"./_baseIsEqual-D9C7gzzJ.js";import"./date-picker-foikjjE_.js";import"./clsx-B-dksMZM.js";import"./chunk-DMYZ6SLX-BMyt3Z-P.js";import"./prompt-KZNvJYzq.js";import"./index-dBm6oMZZ.js";const Y={widgets:[]},ee={widgets:[]};var u=10,te=({group:o})=>{const[t,e]=v.useState({}),{t:r}=l(),a=d(),{searchParams:i,raw:n}=E({pageSize:u}),{customers:p,count:m,isLoading:P,isError:k,error:R}=J({...i,groups:o.id}),g=oe(),D=I(["groups"]),{table:A}=Z({data:p??[],columns:g,count:m,getRowId:c=>c.id,enablePagination:!0,enableRowSelection:!0,pageSize:u,rowSelection:{state:t,updater:e},meta:{customerGroupId:o.id}});if(k)throw R;const{mutateAsync:_}=S(o.id),q=async()=>{const c=Object.keys(t);await a({title:r("customerGroups.customers.remove.title",{count:c.length}),description:r("customerGroups.customers.remove.description",{count:c.length}),confirmText:r("actions.continue"),cancelText:r("actions.cancel")})&&await _({customer_ids:c.map(N=>({id:N}))},{onSuccess:()=>{e({})}})};return s.jsxs(C,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(w,{level:"h2",children:r("customers.domain")}),s.jsx(H,{to:`/customer-groups/${o.id}/add-customers`,children:s.jsx(W,{variant:"secondary",size:"small",children:r("general.add")})})]}),s.jsx(U,{table:A,columns:g,pageSize:u,isLoading:P,count:m,navigateTo:c=>`/customers/${c.id}`,filters:D,search:!0,pagination:!0,orderBy:["email","first_name","last_name","has_account","created_at","updated_at"],queryObject:n,commands:[{action:q,label:r("actions.remove"),shortcut:"r"}],noRecords:{message:r("customerGroups.customers.list.noRecordsMessage")}})]})},se=({customer:o,customerGroupId:t})=>{const{t:e}=l(),{mutateAsync:r}=S(t),a=d(),i=async()=>{await a({title:e("customerGroups.customers.remove.title",{count:1}),description:e("customerGroups.customers.remove.description",{count:1}),confirmText:e("actions.continue"),cancelText:e("actions.cancel")})&&await r({customer_ids:[{id:o.id}]})};return s.jsx(b,{groups:[{actions:[{icon:s.jsx(G,{}),label:e("actions.edit"),to:`/customers/${o.id}/edit`}]},{actions:[{icon:s.jsx(T,{}),label:e("actions.remove"),onClick:i}]}]})},j=X(),oe=()=>{const o=z();return v.useMemo(()=>[j.display({id:"select",header:({table:t})=>s.jsx(y,{checked:t.getIsSomePageRowsSelected()?"indeterminate":t.getIsAllPageRowsSelected(),onCheckedChange:e=>t.toggleAllPageRowsSelected(!!e)}),cell:({row:t})=>s.jsx(y,{checked:t.getIsSelected(),onCheckedChange:e=>t.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...o,j.display({id:"actions",cell:({row:t,table:e})=>{const{customerGroupId:r}=e.options.meta;return s.jsx(se,{customer:t.original,customerGroupId:r})}})],[o])},re=({group:o})=>{var n;const{t}=l(),e=d(),r=O(),{mutateAsync:a}=K(o.id),i=async()=>{await e({title:t("customerGroups.delete.title"),description:t("customerGroups.delete.description",{name:o.name}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await a(void 0,{onSuccess:()=>{f.success(t("customerGroups.delete.successToast",{name:o.name})),r("/customer-groups",{replace:!0})},onError:m=>{f.error(m.message)}})};return s.jsxs(C,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(w,{children:o.name}),s.jsx(b,{groups:[{actions:[{icon:s.jsx(G,{}),label:t("actions.edit"),to:`/customer-groups/${o.id}/edit`}]},{actions:[{icon:s.jsx(T,{}),label:t("actions.delete"),onClick:i}]}]})]}),s.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[s.jsx(h,{size:"small",leading:"compact",weight:"plus",children:t("customers.domain")}),s.jsx(h,{size:"small",leading:"compact",children:((n=o.customers)==null?void 0:n.length)||"-"})]})]})},Ze=()=>{const o=L(),{id:t}=M(),{customer_group:e,isLoading:r,isError:a,error:i}=F(t,{fields:"+customers.id"},{initialData:o});if(r||!e)return s.jsx(Q,{sections:2,showJSON:!0,showMetadata:!0});if(a)throw i;return s.jsxs(B,{widgets:{before:ee,after:Y},showJSON:!0,showMetadata:!0,data:e,children:[s.jsx(re,{group:e}),s.jsx(te,{group:e})]})},ae=o=>({queryKey:V.detail(o),queryFn:async()=>$.customerGroups.retrieve(o,{fields:"+customers.id"})}),Ue=async({params:o})=>{const t=o.id,e=ae(t);return x.getQueryData(e.queryKey)??await x.fetchQuery(e)};export{Ze as Component,Ue as loader};
